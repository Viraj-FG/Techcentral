import{j as e}from"./ui-vendor-CRu_cuPE.js";import{u as ae,r as a}from"./react-vendor-DwZQO67Z.js";import{u as se,a as re,K as ne,B,L as $,I as O,s as x,b as ie,c as ce}from"./index-D4bhw5kJ.js";import{A as X,m as y}from"./animation-vendor-C-lCNj7M.js";import{A as le}from"./AppShell-DVt8-4f8.js";import{u as de}from"./useSwipeNavigation-FVKdXjvo.js";import{P as he}from"./PageTransition-DTafOOMG.js";import{u as pe,O as ue}from"./OnboardingModuleSheet-B0myhNjX.js";import"./chart-vendor-BDCxrQ3h.js";import"./supabase-vendor-BS1x--yE.js";import"./scan-rfUsMt4r.js";import"./tabs-C9GQepe1.js";import"./UniversalShell-B176IQVx.js";import"./trending-down-D_vIl22O.js";import"./leaf-DXJ1a3o-.js";import"./chevron-left-DnN1sqg3.js";import"./select-BN0Wnciu.js";import"./switch-_hpo76TP.js";const me=[{name:"Food Scanner",color:"#2ECC71",category:"Food",shape:"hexagon",path:"/scanner?mode=food"},{name:"Pantry",color:"#2ECC71",category:"Food",shape:"hexagon",path:"/inventory?category=pantry"},{name:"Fridge",color:"#2ECC71",category:"Food",shape:"hexagon",path:"/inventory?category=fridge"},{name:"Recipe Finder",color:"#2ECC71",category:"Food",shape:"hexagon",path:"/recipes"},{name:"Grocery Shopping",color:"#2ECC71",category:"Food",shape:"hexagon",path:"/shop"},{name:"Meal Planner",color:"#2ECC71",category:"Food",shape:"hexagon",path:"/meal-planner"},{name:"Pet Profiles",color:"#FFD700",category:"Pets",shape:"diamond",path:"/pets"},{name:"Pet Supplies",color:"#FFD700",category:"Pets",shape:"diamond",path:"/inventory?category=pets"},{name:"Feeding Schedule",color:"#FFD700",category:"Pets",shape:"diamond",path:"/pets/feeding"},{name:"Vet Visits",color:"#FFD700",category:"Pets",shape:"diamond",path:"/pets/health"},{name:"Vaccinations",color:"#FFD700",category:"Pets",shape:"diamond",path:"/pets/health?tab=vaccinations"},{name:"Toxic Monitor",color:"#FFD700",category:"Pets",shape:"diamond",path:"/pets/safety"},{name:"Virtual Makeup",color:"#9B59B6",category:"Beauty",shape:"teardrop",path:"/beauty/virtual-try-on"},{name:"Shade Finder",color:"#9B59B6",category:"Beauty",shape:"teardrop",path:"/beauty/shade-finder"},{name:"Hair Color",color:"#9B59B6",category:"Beauty",shape:"teardrop",path:"/beauty/hair-color"},{name:"Skin Analysis",color:"#9B59B6",category:"Beauty",shape:"teardrop",path:"/beauty/skin-analysis"},{name:"BeautyGPT",color:"#9B59B6",category:"Beauty",shape:"teardrop",path:"/beauty/consultant"},{name:"Shop the Look",color:"#9B59B6",category:"Beauty",shape:"teardrop",path:"/beauty/shop"},{name:"Household Members",color:"#E74C3C",category:"Utilities",shape:"pill",path:"/household"},{name:"Invite Members",color:"#E74C3C",category:"Utilities",shape:"pill",path:"/household/invite"},{name:"User Settings",color:"#E74C3C",category:"Utilities",shape:"pill",path:"/settings"},{name:"Profile",color:"#E74C3C",category:"Utilities",shape:"pill",path:"/settings/profile"},{name:"Preferences",color:"#E74C3C",category:"Utilities",shape:"pill",path:"/settings/preferences"},{name:"Data & Privacy",color:"#E74C3C",category:"Utilities",shape:"pill",path:"/settings/data"},{name:"Christmas Cookies",color:"#FF6B35",category:"Experiences",shape:"flower",path:"/recipes?filter=christmas-cookies"},{name:"Holiday Cocktails",color:"#FF6B35",category:"Experiences",shape:"flower",path:"/recipes?filter=holiday-cocktails"},{name:"Christmas Dinner",color:"#FF6B35",category:"Experiences",shape:"flower",path:"/experiences/christmas-planner"},{name:"Recipe Generator",color:"#FF6B35",category:"Experiences",shape:"flower",path:"/recipes/generate"},{name:"Voice Assistant",color:"#FF6B35",category:"Experiences",shape:"flower",path:"modal:voice-assistant"},{name:"AI Insights",color:"#FF6B35",category:"Experiences",shape:"flower",path:"/insights"},{name:"Log Meal",color:"#4A90E2",category:"Logging",shape:"squircle",path:"modal:meal-log"},{name:"Log Water",color:"#4A90E2",category:"Logging",shape:"squircle",path:"/water-log"},{name:"Upload Photo",color:"#4A90E2",category:"Logging",shape:"squircle",path:"modal:camera"},{name:"Quick Scan",color:"#4A90E2",category:"Logging",shape:"squircle",path:"/scanner?mode=quick"},{name:"Voice Note",color:"#4A90E2",category:"Logging",shape:"squircle",path:"modal:voice-note"},{name:"Daily Check-in",color:"#4A90E2",category:"Logging",shape:"squircle",path:"modal:daily-checkin"}],v=40,Y=80,F=800,M=800,L=100,_=3,ge=()=>{const g=Y+_,u=(Y+_)*Math.sqrt(3)/2,w=[];for(let s=-4;s<=4;s++)for(let c=-5;c<=5;c++){const C=s%2===0?0:g/2,b=F+c*g+C-v,S=M+s*u-v,o=b+v,d=S+v,m=Math.sqrt(Math.pow(o-F,2)+Math.pow(d-M,2)),l=L+v+_;if(m>=l&&m<=350){const f=Math.atan2(d-M,o-F),n=f<0?f+2*Math.PI:f;w.push({x:b,y:S,distanceFromCenter:m,angle:n})}}w.sort((s,c)=>s.distanceFromCenter-c.distanceFromCenter);const r=w.slice(0,36);return r.sort((s,c)=>s.angle-c.angle),r.map(s=>({x:s.x,y:s.y}))},fe=(g,u)=>({borderRadius:"50%",clipPath:"none"}),ye=({userProfile:g})=>{const u=ae(),{openModal:w}=se(),[r,s]=a.useState(!1),[c,C]=a.useState(0),[b,S]=a.useState(0),[o,d]=a.useState(0),[m,l]=a.useState(0),[i,f]=a.useState({x:0,y:0}),n=a.useRef(null),[A,E]=a.useState(null),[D,R]=a.useState(new Set),H=a.useRef(new Map),I=a.useRef(null),[W,z]=a.useState(!1),V=ge();a.useEffect(()=>{if(n.current){const t=n.current;t.scrollLeft=F-t.clientWidth/2,t.scrollTop=M-t.clientHeight/2}},[]);const J=t=>{if(!r){if(t.path.startsWith("modal:")){const p=t.path.split(":")[1];w(p);return}z(!0),setTimeout(()=>{u(t.path)},300)}},G=t=>{n.current&&(s(!0),C(t.pageX-n.current.offsetLeft),S(t.pageY-n.current.offsetTop),d(n.current.scrollLeft),l(n.current.scrollTop))},K=()=>{s(!1)},Q=()=>{s(!1),E(null)},Z=t=>{if(!n.current)return;if(r){t.preventDefault();const N=t.pageX-n.current.offsetLeft,k=t.pageY-n.current.offsetTop,T=(N-c)*1,P=(k-b)*1;n.current.scrollLeft=o-T,n.current.scrollTop=m-P}if(I.current)return;I.current=setTimeout(()=>{I.current=null},16);const p=t.currentTarget.getBoundingClientRect(),h=n.current.scrollLeft,j=n.current.scrollTop;f({x:t.clientX-p.left+h,y:t.clientY-p.top+j})},ee=(t,p)=>{const h=t+v,j=p+v,N=Math.sqrt(Math.pow(i.x-h,2)+Math.pow(i.y-j,2)),k=150,T=1.4,P=1;if(N<k){const U=N/k;return P+(T-P)*(1-U)}return P},te=t=>{if(r)return;E(t);const p=setTimeout(()=>{R(h=>new Set([...h,t]))},500);H.current.set(t,p)},oe=t=>{E(null);const p=H.current.get(t);p&&(clearTimeout(p),H.current.delete(t)),R(h=>{const j=new Set(h);return j.delete(t),j})};return e.jsx("div",{className:"w-full h-screen overflow-hidden bg-black overscroll-none",children:e.jsx(X,{mode:"wait",children:!W&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,scale:.95,filter:"blur(10px)"},transition:{duration:.3},className:"h-full",children:e.jsx("div",{ref:n,className:`w-full h-full overflow-scroll scroll-smooth no-scrollbar ${r?"cursor-grabbing":"cursor-grab"}`,style:{WebkitOverflowScrolling:"touch",scrollbarWidth:"none",msOverflowStyle:"none",overscrollBehavior:"none"},onMouseDown:G,onMouseUp:K,onMouseLeave:Q,onMouseMove:Z,children:e.jsxs("div",{className:"relative",style:{width:"1600px",height:"1600px"},children:[e.jsx(y.div,{className:"absolute",style:{left:`${F-L}px`,top:`${M-L}px`,width:`${L*2}px`,height:`${L*2}px`},initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{delay:0,type:"spring",stiffness:200,damping:20},children:e.jsx("div",{className:"w-full h-full rounded-full bg-white/10 backdrop-blur-sm flex items-center justify-center",children:e.jsxs(y.div,{className:"text-center text-script",children:[e.jsx(y.h1,{className:"text-white/90 text-3xl tracking-wide overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{delay:.6,duration:.01},children:e.jsx(y.span,{className:"inline-block",initial:{clipPath:"inset(0 100% 0 0)",opacity:0},animate:{clipPath:"inset(0 0% 0 0)",opacity:1},transition:{delay:.6,duration:.8,ease:[.25,.1,.25,1]},children:"Welcome to"})}),e.jsx(y.h2,{className:"text-white text-4xl tracking-wider mt-1 overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{delay:1.3,duration:.01},children:e.jsx(y.span,{className:"inline-block",initial:{clipPath:"inset(0 100% 0 0)",opacity:0},animate:{clipPath:"inset(0 0% 0 0)",opacity:1},transition:{delay:1.4,duration:.6,ease:[.25,.1,.25,1]},children:"Kaeva"})})]})})}),me.map((t,p)=>{const h=V[p];if(!h)return null;const j=ee(h.x,h.y),N=F-v,k=M-v,U=1+Math.sqrt(Math.pow(h.x-(F-v),2)+Math.pow(h.y-(M-v),2))/400*.15;D.has(p);const q=fe(t.shape||"circle");return e.jsxs(y.button,{className:"absolute group",style:{left:`${h.x}px`,top:`${h.y}px`,willChange:"transform",contain:"layout style paint",...q},onClick:()=>J(t),initial:{opacity:0,scale:0,x:N-h.x,y:k-h.y},animate:{opacity:1,scale:j,x:0,y:0},transition:{delay:U,type:"spring",stiffness:260,damping:18,mass:.8},whileTap:{scale:j*.9},onMouseEnter:()=>te(p),onMouseLeave:()=>oe(p),"aria-label":t.name,children:[e.jsx(y.div,{className:"absolute inset-0 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none",style:{background:`radial-gradient(circle, ${t.color}80 0%, transparent 70%)`,filter:"blur(8px)",transform:"scale(1.5)",willChange:"opacity"}}),e.jsx(y.div,{className:"w-20 h-20 flex items-center justify-center relative shadow-lg transition-all duration-500 group-hover:shadow-2xl",style:{backgroundColor:t.color,...q},animate:q,transition:{duration:.5,ease:[.4,0,.2,1]},children:e.jsx("span",{className:"text-black/70 text-xs text-center px-2 leading-tight font-serif font-medium",children:t.name})})]},`${t.category}-${t.name}`)})]})})},"all-features")})})},xe=({onComplete:g})=>{const[u,w]=a.useState(""),[r,s]=a.useState(!1),[c,C]=a.useState("create"),[b,S]=a.useState(""),{toast:o}=re(),d=async l=>{s(!0);try{const{data:i,error:f}=await x.functions.invoke("accept-household-invite",{body:{invite_code:l}});if(f)throw f;i!=null&&i.success&&(o({title:"Joined household",description:`Welcome to ${i.household_name}!`}),g(i.household_id))}catch(i){console.error("Error joining household:",i),o({title:"Error",description:i.message||"Failed to join household. Please check the invite code.",variant:"destructive"})}finally{s(!1)}},m=async l=>{s(!0);try{const{data:{user:i}}=await x.auth.getUser();if(!i)throw new Error("No authenticated user");const{data:f}=await x.from("profiles").select("user_name").eq("id",i.id).single(),n=l||`${(f==null?void 0:f.user_name)||"My"} Household`,{data:A,error:E}=await x.from("households").insert({owner_id:i.id,name:n}).select().single();if(E)throw E;const{error:D}=await x.from("profiles").update({current_household_id:A.id}).eq("id",i.id);if(D)throw D;o({title:"Household created",description:`Welcome to ${n}!`}),g(A.id)}catch(i){console.error("Error creating household:",i),o({title:"Error",description:"Failed to create household. Please try again.",variant:"destructive"})}finally{s(!1)}};return e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-background flex items-center justify-center p-6",children:e.jsxs("div",{className:"w-full max-w-md space-y-8 overflow-hidden",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(ne,{size:"lg",state:"idle"})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"One More Thing..."}),e.jsx("p",{className:"text-muted-foreground",children:c==="create"?"Let's set up your household to organize your inventory and recipes.":"Enter your invite code to join an existing household."})]}),e.jsxs("div",{className:"flex gap-2 p-1 bg-muted rounded-lg",children:[e.jsx(B,{variant:c==="create"?"default":"ghost",className:"flex-1",onClick:()=>C("create"),children:"Create New"}),e.jsx(B,{variant:c==="join"?"default":"ghost",className:"flex-1",onClick:()=>C("join"),children:"Join Existing"})]}),c==="create"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"household-name",children:"Household Name"}),e.jsx(O,{id:"household-name",type:"text",placeholder:"e.g., Smith Family, My Home",value:u,onChange:l=>w(l.target.value),disabled:r})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(B,{onClick:()=>m(u),disabled:r,className:"w-full",children:r?"Creating...":"Create Household"}),e.jsx(B,{onClick:()=>m(""),disabled:r,variant:"ghost",className:"w-full",children:"Use Default Name"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"invite-code",children:"Invite Code"}),e.jsx(O,{id:"invite-code",type:"text",placeholder:"Paste your invite code here",value:b,onChange:l=>S(l.target.value),disabled:r})]}),e.jsx(B,{onClick:()=>d(b),disabled:r||!b.trim(),className:"w-full",children:r?"Joining...":"Join Household"})]}),e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:c==="create"?"You can invite family members and manage your household later from Settings.":"Ask a household member for an invite link to join their household."})]})})},He=()=>{const[g,u]=a.useState("loading"),[w,r]=a.useState(null),[s,c]=a.useState(!1);pe();const C=de({enabled:g==="dashboard"});ie(),a.useEffect(()=>{(async()=>{var d;try{const{data:{session:m}}=await x.auth.getSession();if(!(m!=null&&m.user))return;const{data:l}=await x.from("profiles").select("*").eq("id",m.user.id).single();l&&(r(l),l.onboarding_completed?u("dashboard"):!l.onboarding_modules||!((d=l.onboarding_modules)!=null&&d.core)?(u("core-onboarding"),c(!0)):l.current_household_id?u("dashboard"):u("household-setup"))}catch(m){console.error("Error fetching user profile:",m)}})()},[]);const b=a.useCallback(async()=>{c(!1);try{const{data:{session:o}}=await x.auth.getSession();if(!(o!=null&&o.user))return;const{data:d}=await x.from("profiles").select("*").eq("id",o.user.id).single();d!=null&&d.current_household_id?(r(d),u("dashboard")):(r(d),u("household-setup"))}catch(o){console.error("Error after core onboarding:",o)}},[]),S=a.useCallback(async()=>{try{const{data:{session:o}}=await x.auth.getSession();if(!(o!=null&&o.user))return;const{data:d}=await x.from("profiles").select("*").eq("id",o.user.id).single();r(d),u("dashboard")}catch(o){console.error("Error after household setup:",o)}},[]);return g==="loading"?e.jsx(ce,{}):e.jsxs(e.Fragment,{children:[e.jsxs(X,{mode:"wait",children:[g==="core-onboarding"&&e.jsx("div",{className:"fixed inset-0 bg-background"},"core-onboarding"),g==="household-setup"&&e.jsx(xe,{onComplete:S},"household-setup"),g==="dashboard"&&w&&e.jsx(le,{fullScreen:!0,onScan:()=>{},children:e.jsx(he,{swipeProgress:C.progress,swipeDirection:C.direction,children:e.jsx(ye,{userProfile:w})},"dashboard")})]}),e.jsx(ue,{open:s,module:"core",onClose:()=>{},onComplete:b})]})};export{He as default};

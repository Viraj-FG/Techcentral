import{j as e,a9 as Te}from"./ui-vendor-CRu_cuPE.js";import{d as G,a5 as W,a6 as Ee,a7 as je,a8 as Oe,a9 as ze,aa as ve,ab as B,ac as Ve,a as F,B as k,ad as We,a4 as $e,ae as O,T as Ge,af as ae,s as p,$ as E,o as _,F as U,j as J,ag as qe,ah as H,G as ce,ai as Ne,aj as ye,ak as be,w as Be,i as K,a3 as De,al as ne,am as Xe,an as te,J as Ke,R as Je}from"./index-D4bhw5kJ.js";import{T as Y,a as Q,b as A,c as S}from"./tabs-C9GQepe1.js";import{r as h,u as He}from"./react-vendor-DwZQO67Z.js";import{C as v,a as N,b as y,c as T,d as w}from"./card-q-j3zA9P.js";import{U as Ie}from"./users-DudXFJtM.js";import{C as Ye,a as z}from"./circle-x-CDVLy9TU.js";import{b as Qe}from"./supabase-vendor-BS1x--yE.js";import{T as Le}from"./trending-up-0sWaYDAK.js";import{C as Ze}from"./chart-no-axes-column-increasing-Zap9-RmK.js";import{C as $,M as re}from"./message-square-B4wyAd_t.js";import{d as es}from"./differenceInCalendarMonths-C0vMyT8W.js";import{e as ss}from"./endOfMonth-xVGECeUJ.js";import{R as we,L as ts,C as Ce,X as _e,Y as Ae,T as Se,a as as,B as ns,b as rs}from"./chart-vendor-BDCxrQ3h.js";import{A as ke,m as ie}from"./animation-vendor-C-lCNj7M.js";import{U as is}from"./user-DLA5oS07.js";import{B as os}from"./bot-BSc2axEU.js";import{A as cs}from"./arrow-left-CQcT7sCo.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=G("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=G("CircleStop",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=G("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=G("PhoneCall",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}],["path",{d:"M14.05 2a9 9 0 0 1 8 7.94",key:"vmijpz"}],["path",{d:"M14.05 6A5 5 0 0 1 18 10",key:"13nbpp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=G("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);function X(i,l){const o=+W(i)-+W(l);return o<0?-1:o>0?1:o}function us(i){return l=>{const d=(i?Math[i]:Math.trunc)(l);return d===0?0:d}}function hs(i,l){return+W(i)-+W(l)}function gs(i,l){const o=W(i,l==null?void 0:l.in);return o.setHours(23,59,59,999),o}function ps(i,l){const o=W(i,l==null?void 0:l.in);return+gs(o,l)==+ss(o,l)}function fs(i,l,o){const[d,r,g]=Ee(o==null?void 0:o.in,i,i,l),a=X(r,g),u=Math.abs(es(r,g));if(u<1)return 0;r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-a*u);let c=X(r,g)===-a;ps(d)&&u===1&&X(d,g)===1&&(c=!1);const n=a*(u-+c);return n===0?0:n}function js(i,l,o){const d=hs(i,l)/1e3;return us(o==null?void 0:o.roundingMethod)(d)}function vs(i,l,o){const d=Oe(),r=(o==null?void 0:o.locale)??d.locale??ze,g=2520,a=X(i,l);if(isNaN(a))throw new RangeError("Invalid time value");const u=Object.assign({},o,{addSuffix:o==null?void 0:o.addSuffix,comparison:a}),[c,n]=Ee(o==null?void 0:o.in,...a>0?[l,i]:[i,l]),m=js(n,c),f=(je(n)-je(c))/1e3,t=Math.round((m-f)/60);let s;if(t<2)return o!=null&&o.includeSeconds?m<5?r.formatDistance("lessThanXSeconds",5,u):m<10?r.formatDistance("lessThanXSeconds",10,u):m<20?r.formatDistance("lessThanXSeconds",20,u):m<40?r.formatDistance("halfAMinute",0,u):m<60?r.formatDistance("lessThanXMinutes",1,u):r.formatDistance("xMinutes",1,u):t===0?r.formatDistance("lessThanXMinutes",1,u):r.formatDistance("xMinutes",t,u);if(t<45)return r.formatDistance("xMinutes",t,u);if(t<90)return r.formatDistance("aboutXHours",1,u);if(t<ve){const x=Math.round(t/60);return r.formatDistance("aboutXHours",x,u)}else{if(t<g)return r.formatDistance("xDays",1,u);if(t<B){const x=Math.round(t/ve);return r.formatDistance("xDays",x,u)}else if(t<B*2)return s=Math.round(t/B),r.formatDistance("aboutXMonths",s,u)}if(s=fs(n,c),s<12){const x=Math.round(t/B);return r.formatDistance("xMonths",x,u)}else{const x=s%12,j=Math.trunc(s/12);return x<3?r.formatDistance("aboutXYears",j,u):x<9?r.formatDistance("overXYears",j,u):r.formatDistance("almostXYears",j+1,u)}}function Ns(i,l){return vs(i,Ve(i),l)}const ys=()=>{const[i,l]=h.useState(!1),[o,d]=h.useState(!1),[r,g]=h.useState(()=>localStorage.getItem("kaeva_debug_logs")==="true"),{toast:a}=F(),u=async()=>{l(!0);try{const{data:{session:s}}=await p.auth.getSession();if(!s)throw new Error("No session");const{error:x}=await p.functions.invoke("generate-signed-url",{body:{agentId:E.onboarding.agentId}});if(x)throw x;a({title:"Connection Test Passed",description:"Successfully connected to ElevenLabs API"})}catch(s){console.error("Connection test failed:",s),a({title:"Connection Test Failed",description:s instanceof Error?s.message:"Failed to connect",variant:"destructive"})}finally{l(!1)}},c=async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0}),a({title:"Audio Permissions Granted",description:"Microphone access is available"})}catch{a({title:"Audio Permissions Denied",description:"Please grant microphone access to test voice features",variant:"destructive"})}},n=async()=>{d(!0);try{const{data:{user:s}}=await p.auth.getUser();if(!s)throw new Error("Not authenticated");await p.from("profiles").update({onboarding_completed:!1,dietary_preferences:[],allergies:[],beauty_profile:{},health_goals:[],lifestyle_goals:[],household_adults:1,household_kids:0,user_name:null}).eq("id",s.id),await p.from("pets").delete().eq("user_id",s.id),await p.from("conversation_history").delete().eq("user_id",s.id),a({title:"Test Data Cleared",description:"Your profile has been reset for testing"}),setTimeout(()=>window.location.reload(),1e3)}catch(s){console.error("Clear data error:",s),a({title:"Clear Failed",description:s instanceof Error?s.message:"Failed to clear data",variant:"destructive"})}finally{d(!1)}},m=()=>{a({title:"Wake Word Test",description:"Say 'Kaeva' or 'Hey Kaeva' to activate"})},f=()=>{window.dispatchEvent(new CustomEvent("force-end-conversation")),a({title:"Conversation Ended",description:"All active voice sessions have been terminated"})},t=()=>{const s=!r;g(s),localStorage.setItem("kaeva_debug_logs",String(s)),a({title:s?"Debug Logs Enabled":"Debug Logs Disabled",description:s?"Check console for detailed logs":"Console logging reduced"})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsx(y,{children:"Connection Tests"}),e.jsx(T,{children:"Test external service connectivity"})]}),e.jsxs(w,{className:"space-y-3",children:[e.jsxs(k,{onClick:u,disabled:i,variant:"outline",className:"w-full justify-start",children:[e.jsx(We,{className:"h-4 w-4"}),i?"Testing...":"Test ElevenLabs Connection"]}),e.jsxs(k,{onClick:c,variant:"outline",className:"w-full justify-start",children:[e.jsx($e,{className:"h-4 w-4"}),"Test Audio Permissions"]})]})]}),e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsx(y,{children:"Onboarding Testing"}),e.jsx(T,{children:"Test the voice onboarding flow"})]}),e.jsxs(w,{className:"space-y-3",children:[e.jsxs(k,{onClick:()=>window.location.href="/",variant:"outline",className:"w-full justify-start",children:[e.jsx(ls,{className:"h-4 w-4"}),"Start Test Conversation"]}),e.jsx(k,{onClick:n,disabled:o,variant:"destructive",className:"w-full justify-start",children:o?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4 animate-spin"}),"Clearing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"h-4 w-4"}),"Clear My Test Data"]})})]})]}),e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsx(y,{children:"Voice Control"}),e.jsx(T,{children:"Manual voice assistant controls"})]}),e.jsxs(w,{className:"space-y-3",children:[e.jsxs(k,{onClick:m,variant:"outline",className:"w-full justify-start",children:[e.jsx(ae,{className:"h-4 w-4"}),"Test Wake Word"]}),e.jsxs(k,{onClick:f,variant:"outline",className:"w-full justify-start",children:[e.jsx(ds,{className:"h-4 w-4"}),"Force End Conversation"]}),e.jsxs(k,{onClick:t,variant:r?"default":"outline",className:"w-full justify-start",children:[e.jsx(O,{className:"h-4 w-4"}),r?"Debug Logs: ON":"Debug Logs: OFF"]})]})]})]})},bs=()=>{const[i,l]=h.useState({total:0,completed:0,pending:0}),[o,d]=h.useState([]),{toast:r}=F();h.useEffect(()=>{g()},[]);const g=async()=>{try{const{data:a,error:u}=await p.from("profiles").select("id, user_name, onboarding_completed, created_at").order("created_at",{ascending:!1}).limit(10);if(u)throw u;const c=(a==null?void 0:a.filter(n=>n.onboarding_completed).length)||0;l({total:(a==null?void 0:a.length)||0,completed:c,pending:((a==null?void 0:a.length)||0)-c}),d(a||[])}catch(a){console.error("Load users error:",a),r({title:"Load Failed",description:"Failed to load user data",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(v,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Total Users"}),e.jsx(Ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(w,{children:e.jsx("div",{className:"text-2xl font-bold",children:i.total})})]}),e.jsxs(v,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Completed"}),e.jsx(Ye,{className:"h-4 w-4 text-green-500"})]}),e.jsx(w,{children:e.jsx("div",{className:"text-2xl font-bold",children:i.completed})})]}),e.jsxs(v,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Pending"}),e.jsx(z,{className:"h-4 w-4 text-yellow-500"})]}),e.jsx(w,{children:e.jsx("div",{className:"text-2xl font-bold",children:i.pending})})]})]}),e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsx(y,{children:"Recent Users"}),e.jsx(T,{children:"Most recently created profiles"})]}),e.jsx(w,{children:e.jsx("div",{className:"space-y-3",children:o.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-card",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:a.user_name||"Anonymous"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(a.created_at).toLocaleDateString()})]}),e.jsx(_,{variant:a.onboarding_completed?"default":"secondary",children:a.onboarding_completed?"Completed":"Pending"})]},a.id))})})]})]})},ws=()=>{const[i,l]=h.useState([]),[o,d]=h.useState([]),[r,g]=h.useState([]),{toast:a}=F();h.useEffect(()=>{u()},[]);const u=async()=>{try{const[c,n,m]=await Promise.all([p.from("profiles").select("*").limit(10),p.from("pets").select("*").limit(10),p.from("inventory").select("*").limit(10)]);if(c.error)throw c.error;if(n.error)throw n.error;if(m.error)throw m.error;l(c.data||[]),d(n.data||[]),g(m.data||[])}catch(c){console.error("Load data error:",c),a({title:"Load Failed",description:"Failed to load database data",variant:"destructive"})}};return e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsx(y,{children:"Database Inspector"}),e.jsx(T,{children:"View recent data from all tables"})]}),e.jsx(w,{children:e.jsxs(Y,{defaultValue:"profiles",children:[e.jsxs(Q,{className:"grid w-full grid-cols-1 sm:grid-cols-3 gap-1",children:[e.jsxs(A,{value:"profiles",children:["Profiles (",i.length,")"]}),e.jsxs(A,{value:"pets",children:["Pets (",o.length,")"]}),e.jsxs(A,{value:"inventory",children:["Inventory (",r.length,")"]})]}),e.jsx(S,{value:"profiles",className:"space-y-4",children:e.jsx(U,{className:"h-[400px]",children:i.map(c=>e.jsx("div",{className:"mb-4 p-3 sm:p-4 rounded-lg border bg-card",children:e.jsx("pre",{className:"text-[10px] sm:text-xs overflow-x-auto",children:JSON.stringify(c,null,2)})},c.id))})}),e.jsx(S,{value:"pets",className:"space-y-4",children:e.jsx(U,{className:"h-[400px]",children:o.map(c=>e.jsx("div",{className:"mb-4 p-3 sm:p-4 rounded-lg border bg-card",children:e.jsx("pre",{className:"text-[10px] sm:text-xs overflow-x-auto",children:JSON.stringify(c,null,2)})},c.id))})}),e.jsx(S,{value:"inventory",className:"space-y-4",children:e.jsx(U,{className:"h-[400px]",children:r.map(c=>e.jsx("div",{className:"mb-4 p-3 sm:p-4 rounded-lg border bg-card",children:e.jsx("pre",{className:"text-[10px] sm:text-xs overflow-x-auto",children:JSON.stringify(c,null,2)})},c.id))})})]})})]})},Cs=qe("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),le=h.forwardRef(({className:i,variant:l,...o},d)=>e.jsx("div",{ref:d,role:"alert",className:J(Cs({variant:l}),i),...o}));le.displayName="Alert";const _s=h.forwardRef(({className:i,...l},o)=>e.jsx("h5",{ref:o,className:J("mb-1 font-medium leading-none tracking-tight",i),...l}));_s.displayName="AlertTitle";const de=h.forwardRef(({className:i,...l},o)=>e.jsx("div",{ref:o,className:J("text-sm [&_p]:leading-relaxed",i),...l}));de.displayName="AlertDescription";const As=()=>{const{data:i,isLoading:l}=Qe({queryKey:["system-errors"],queryFn:async()=>{const{data:o,error:d}=await p.from("conversation_history").select("*").eq("conversation_id","onboarding-error").order("created_at",{ascending:!1}).limit(50);if(d)throw d;return o},refetchInterval:5e3});return e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsx(y,{children:"System Logs"}),e.jsx(T,{children:"View onboarding errors and system logs"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs(le,{children:[e.jsx(ms,{className:"h-4 w-4"}),e.jsx(de,{children:"To view detailed edge function logs and authentication events, visit the Backend section in your project settings."})]}),l?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading error logs..."}):i&&i.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-destructive"}),e.jsxs("span",{className:"text-sm font-medium",children:["Onboarding Errors (",i.length,")"]})]}),e.jsx(U,{className:"h-[calc(100vh-400px)] max-h-[400px] min-h-[200px] w-full rounded border",children:e.jsx("div",{className:"p-4 space-y-3",children:i.map(o=>{const d=o.metadata;return e.jsxs("div",{className:"p-3 rounded-lg border bg-muted/50 space-y-2",children:[e.jsx("div",{className:"flex items-start justify-between gap-2",children:e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{variant:"destructive",className:"text-xs",children:(d==null?void 0:d.step)||"Unknown Step"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(o.created_at).toLocaleString()})]}),e.jsx("p",{className:"text-sm font-medium",children:o.message}),(d==null?void 0:d.userId)&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["User: ",d.userId]})]})}),(d==null?void 0:d.error)&&e.jsx("div",{className:"text-xs font-mono bg-background p-2 rounded border",children:d.error}),(d==null?void 0:d.stack)&&e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-muted-foreground hover:text-foreground",children:"Stack trace"}),e.jsx("pre",{className:"mt-2 p-2 bg-background rounded border overflow-x-auto",children:d.stack})]}),(d==null?void 0:d.data)&&e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-muted-foreground hover:text-foreground",children:"State data"}),e.jsx("pre",{className:"mt-2 p-2 bg-background rounded border overflow-x-auto",children:JSON.stringify(d.data,null,2)})]})]},o.id)})})})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No error logs found"})]})]})},Ss=()=>{const[i,l]=h.useState({completionRate:0,avgTimeToComplete:"N/A",totalUsers:0,recentSignups:0}),{toast:o}=F();h.useEffect(()=>{d()},[]);const d=async()=>{try{const{data:r,error:g}=await p.from("profiles").select("onboarding_completed, created_at, updated_at");if(g)throw g;const a=(r==null?void 0:r.length)||0,u=(r==null?void 0:r.filter(f=>f.onboarding_completed).length)||0,c=a>0?Math.round(u/a*100):0,n=new Date;n.setDate(n.getDate()-1);const m=(r==null?void 0:r.filter(f=>new Date(f.created_at)>n).length)||0;l({completionRate:c,avgTimeToComplete:"~5 min",totalUsers:a,recentSignups:m})}catch(r){console.error("Analytics error:",r),o({title:"Load Failed",description:"Failed to load analytics",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(v,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Completion Rate"}),e.jsx(Le,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(w,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[i.completionRate,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Users who complete onboarding"})]})]}),e.jsxs(v,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Avg. Time"}),e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(w,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i.avgTimeToComplete}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"To complete onboarding"})]})]}),e.jsxs(v,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Total Users"}),e.jsx(Ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(w,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i.totalUsers}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All time signups"})]})]}),e.jsxs(v,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Recent Signups"}),e.jsx(Ze,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(w,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i.recentSignups}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 24 hours"})]})]})]}),e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsx(y,{children:"Onboarding Funnel"}),e.jsx(T,{children:"User journey through onboarding steps"})]}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Started Onboarding"}),e.jsx("span",{className:"text-sm font-medium",children:i.totalUsers})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Completed Identity"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"~90%"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Completed Food Profile"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"~80%"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Completed Beauty Profile"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"~75%"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-bold",children:"Finished Onboarding"}),e.jsxs("span",{className:"text-sm font-bold text-primary",children:[i.completionRate,"%"]})]})]})})]})]})},ks=()=>{const[i,l]=h.useState({isConfigured:!1,lastConfiguredAt:null,promptVersion:null}),[o,d]=h.useState(!1),[r,g]=h.useState({onboarding:[],assistant:[]}),[a,u]=h.useState(!1),c=async()=>{var t,s;u(!0);try{const{data:x,error:j}=await p.functions.invoke("provision-agents",{method:"GET"});if(j)throw j;if(x!=null&&x.agents){const b=((t=x.agents.onboarding)==null?void 0:t.tools)||[],D=((s=x.agents.assistant)==null?void 0:s.tools)||[];g({onboarding:b,assistant:D})}}catch(x){console.error("Error fetching agent tools:",x),g({onboarding:[{name:"updateProfile",type:"client",description:"Save user profile information"},{name:"completeConversation",type:"client",description:"End conversation after onboarding"},{name:"endConversation",type:"client",description:"Exit conversation early"},{name:"navigateTo",type:"client",description:"Navigate to dashboard page"}],assistant:[{name:"checkInventory",type:"client",description:"Search household inventory"},{name:"updateInventory",type:"client",description:"Add/update/remove inventory items"},{name:"addToShoppingList",type:"client",description:"Add items to shopping cart"},{name:"logMeal",type:"client",description:"Log meal for nutrition tracking"},{name:"suggestRecipes",type:"client",description:"Get recipe suggestions"},{name:"checkAllergens",type:"client",description:"Check ingredient allergens"},{name:"navigateTo",type:"client",description:"Navigate to dashboard page"},{name:"endConversation",type:"client",description:"End conversation"}]})}finally{u(!1)}},n=async()=>{try{const{data:{session:t}}=await p.auth.getSession();if(!(t!=null&&t.user))return;const{data:s}=await p.from("profiles").select("agent_configured, agent_last_configured_at, agent_prompt_version").eq("id",t.user.id).single();s&&l({isConfigured:s.agent_configured||!1,lastConfiguredAt:s.agent_last_configured_at,promptVersion:s.agent_prompt_version})}catch(t){console.error("Error fetching agent status:",t)}},m=async()=>{d(!0),await Promise.all([n(),c()]),setTimeout(()=>d(!1),500)};h.useEffect(()=>{n(),c()},[]);const f=i.promptVersion===E.onboarding.promptVersion||i.promptVersion===E.assistant.promptVersion;return e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Agent Status"}),e.jsx(T,{children:"Current configuration state"})]}),e.jsx(k,{variant:"ghost",size:"icon",onClick:m,disabled:o,children:e.jsx(O,{className:`h-4 w-4 ${o?"animate-spin":""}`})})]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Configuration Status"}),e.jsx(_,{variant:i.isConfigured?"default":"destructive",children:i.isConfigured?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-3 w-3 mr-1"}),"Configured"]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"Not Configured"]})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Onboarding Agent"}),e.jsxs("code",{className:"text-xs bg-background px-2 py-1 rounded",children:["...",E.onboarding.agentId.slice(-8)]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Assistant Agent"}),e.jsxs("code",{className:"text-xs bg-background px-2 py-1 rounded",children:["...",E.assistant.agentId.slice(-8)]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Deployed Version"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"text-xs bg-background px-2 py-1 rounded",children:i.promptVersion||"Not set"}),i.promptVersion&&e.jsx(_,{variant:f?"default":"secondary",children:f?"Current":"Outdated"})]})]}),i.lastConfiguredAt&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Last Configured"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ce,{className:"h-3 w-3"}),Ns(new Date(i.lastConfiguredAt),{addSuffix:!0})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Expected Versions"}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsxs("code",{className:"text-xs bg-background px-2 py-1 rounded",children:["Onboarding: ",E.onboarding.promptVersion]}),e.jsxs("code",{className:"text-xs bg-background px-2 py-1 rounded",children:["Assistant: ",E.assistant.promptVersion]})]})]}),!f&&i.isConfigured&&e.jsx("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:["⚠️ Agent prompt version is outdated. Reconfigure to update to latest versions (Onboarding: ",E.onboarding.promptVersion,", Assistant: ",E.assistant.promptVersion,")"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Ne,{children:[e.jsx(ye,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg hover:bg-muted/70 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Onboarding Agent Tools"})]}),e.jsx(_,{variant:"secondary",children:r.onboarding.length})]})}),e.jsx(be,{children:e.jsx("div",{className:"ml-4 mt-2 space-y-2",children:a?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Loading tools..."}):r.onboarding.length>0?r.onboarding.map((t,s)=>e.jsxs("div",{className:"p-2 bg-background rounded border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("code",{className:"text-xs font-mono",children:t.name}),t.type&&e.jsx(_,{variant:"outline",className:"text-xs",children:t.type})]}),t.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.description})]},s)):e.jsx("p",{className:"text-xs text-muted-foreground",children:"No tools configured"})})})]}),e.jsxs(Ne,{children:[e.jsx(ye,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg hover:bg-muted/70 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Assistant Agent Tools"})]}),e.jsx(_,{variant:"secondary",children:r.assistant.length})]})}),e.jsx(be,{children:e.jsx("div",{className:"ml-4 mt-2 space-y-2",children:a?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Loading tools..."}):r.assistant.length>0?r.assistant.map((t,s)=>e.jsxs("div",{className:"p-2 bg-background rounded border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("code",{className:"text-xs font-mono",children:t.name}),t.type&&e.jsx(_,{variant:"outline",className:"text-xs",children:t.type})]}),t.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.description})]},s)):e.jsx("p",{className:"text-xs text-muted-foreground",children:"No tools configured"})})})]})]})]})]})},Ts=()=>{const{toast:i}=F(),[l,o]=h.useState({status:"idle"}),[d,r]=h.useState({status:"idle"}),[g,a]=h.useState({status:"idle"}),u=async()=>{o({status:"running"});try{const{data:t,error:s}=await p.functions.invoke("provision-agents",{body:{testMode:!0}});if(s)throw s;const x=Array.isArray(t==null?void 0:t.results)?t.results:[];x.every(b=>b.status==="created"||b.status==="updated")&&x.length===2?o({status:"success",message:"Both agents properly configured via provision-agents",details:{onboarding:x.find(b=>b.type==="onboarding"),assistant:x.find(b=>b.type==="assistant")}}):o({status:"error",message:"Agent provisioning incomplete",details:{results:x}})}catch(t){o({status:"error",message:t instanceof Error?t.message:"Configuration test failed"})}},c=async()=>{r({status:"running"});try{if(await De(E.onboarding.agentId))r({status:"success",message:"Successfully connected to ElevenLabs API"});else throw new Error("No signed URL received")}catch(t){r({status:"error",message:t instanceof Error?t.message:"Connection test failed"})}},n=async()=>{a({status:"running"});try{const{data:{session:t}}=await p.auth.getSession();if(!(t!=null&&t.user))throw new Error("Not authenticated");const{data:s}=await p.from("profiles").select("*").eq("id",t.user.id).single(),{data:x}=await p.from("household_members").select("*").eq("user_id",t.user.id),{data:j}=await p.from("pets").select("*").eq("user_id",t.user.id),{data:b}=s!=null&&s.current_household_id?await p.from("inventory").select("*").eq("household_id",s.current_household_id).limit(5):{data:[]};a({status:"success",message:"Context data loaded successfully",details:{profile:!!s,householdMembers:(x==null?void 0:x.length)||0,pets:(j==null?void 0:j.length)||0,inventoryItems:(b==null?void 0:b.length)||0}})}catch(t){a({status:"error",message:t instanceof Error?t.message:"Context test failed"})}},m=async()=>{await u(),await c(),await n(),i({title:"Test Suite Complete",description:"Check results below"})},f=(t,s)=>{const x={idle:null,running:e.jsx(K,{size:"xs",speed:"fast",showCore:!1}),success:e.jsx($,{className:"h-4 w-4 text-green-500"}),error:e.jsx(z,{className:"h-4 w-4 text-red-500"})}[t.status];return e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:s}),e.jsxs("div",{className:"flex items-center gap-2",children:[x,e.jsx(_,{variant:t.status==="success"?"default":t.status==="error"?"destructive":"secondary",children:t.status})]})]}),t.message&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.message}),t.details&&e.jsx("pre",{className:"text-xs bg-background p-2 rounded overflow-x-auto",children:JSON.stringify(t.details,null,2)})]})};return e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsx(y,{children:"Agent Test Suite"}),e.jsx(T,{children:"Verify agent configuration and connectivity"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs(le,{children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsx(de,{children:"These tests verify your agent is properly configured and can connect to ElevenLabs services."})]}),e.jsxs("div",{className:"space-y-3",children:[f(l,"Configuration Check"),f(d,"Connection Test"),f(g,"Context Injection")]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(k,{onClick:u,variant:"outline",size:"sm",children:"Test Config"}),e.jsx(k,{onClick:c,variant:"outline",size:"sm",children:"Test Connection"}),e.jsx(k,{onClick:n,variant:"outline",size:"sm",children:"Test Context"}),e.jsx(k,{onClick:m,variant:"default",size:"sm",children:"Run All Tests"})]})]})]})},Es=()=>{const[i,l]=h.useState([{id:"edge-function",title:"Edge function deployed",description:"provision-agents function is accessible",status:"idle"},{id:"agent-configured",title:"Agent configured",description:"ElevenLabs agent has been set up",status:"idle"},{id:"agent-id-match",title:"Using correct agent ID",description:"All files reference the same agent ID",status:"idle"},{id:"context-injection",title:"Context injection working",description:"User data can be loaded for conversations",status:"idle"},{id:"client-tools",title:"Client tools registered",description:"Agent can call updateProfile and completeConversation",status:"idle"}]),[o,d]=h.useState(!1),r=(t,s)=>{l(x=>x.map(j=>j.id===t?{...j,...s}:j))},g=async()=>{r("edge-function",{status:"checking"});try{const{error:t}=await p.functions.invoke("provision-agents",{body:{testMode:!0}});if(t)throw t;r("edge-function",{status:"passed",message:"Edge function is deployed and accessible"})}catch(t){r("edge-function",{status:"failed",message:t instanceof Error?t.message:"Function not accessible"})}},a=async()=>{r("agent-configured",{status:"checking"});try{const{data:{session:t}}=await p.auth.getSession();if(!(t!=null&&t.user))throw new Error("Not authenticated");const{data:s}=await p.from("profiles").select("agent_configured, agent_prompt_version").eq("id",t.user.id).single();s!=null&&s.agent_configured?s.agent_prompt_version===E.onboarding.promptVersion||s.agent_prompt_version===E.assistant.promptVersion?r("agent-configured",{status:"warning",message:`Outdated prompt version (${s.agent_prompt_version})`}):r("agent-configured",{status:"passed",message:"Agent is configured with latest prompt"}):r("agent-configured",{status:"warning",message:"Agent not configured yet - run configuration first"})}catch(t){r("agent-configured",{status:"failed",message:t instanceof Error?t.message:"Failed to check"})}},u=async()=>{r("agent-id-match",{status:"checking"});try{const t=E.onboarding.agentId,s=E.assistant.agentId;r("agent-id-match",{status:"passed",message:`Using centralized config: Onboarding ${t.slice(-8)}, Assistant ${s.slice(-8)}`})}catch{r("agent-id-match",{status:"failed",message:"Agent ID mismatch detected"})}},c=async()=>{r("context-injection",{status:"checking"});try{const{data:{session:t}}=await p.auth.getSession();if(!(t!=null&&t.user))throw new Error("Not authenticated");const{data:s}=await p.from("profiles").select("*").eq("id",t.user.id).single();if(!s)throw new Error("Profile not found");const x=s.onboarding_completed?E.assistant.agentId:E.onboarding.agentId;if(!await De(x))throw new Error("Failed to get signed URL");r("context-injection",{status:"passed",message:"Profile data accessible, can inject context"})}catch(t){r("context-injection",{status:"failed",message:t instanceof Error?t.message:"Context injection failed"})}},n=async()=>{r("client-tools",{status:"checking"});try{const{data:t,error:s}=await p.functions.invoke("provision-agents",{body:{testMode:!0}});if(s)throw s;((t==null?void 0:t.results)||[]).every(b=>b.clientToolsCount>=3)?r("client-tools",{status:"passed",message:"Both agents have client tools configured"}):r("client-tools",{status:"warning",message:"Some agents missing required tools"})}catch(t){r("client-tools",{status:"failed",message:t instanceof Error?t.message:"Failed to check tools"})}},m=async()=>{d(!0),await g(),await a(),await u(),await c(),await n(),d(!1)},f=t=>{switch(t){case"checking":return e.jsx(K,{size:"sm",speed:"fast",showCore:!1});case"passed":return e.jsx($,{className:"h-5 w-5 text-green-500"});case"warning":return e.jsx(H,{className:"h-5 w-5 text-yellow-500"});case"failed":return e.jsx(z,{className:"h-5 w-5 text-red-500"});default:return e.jsx("div",{className:"h-5 w-5 rounded-full border-2 border-muted"})}};return e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Deployment Checklist"}),e.jsx(T,{children:"Verify all systems are operational"})]}),e.jsx(k,{onClick:m,disabled:o,variant:"default",children:o?"Running Checks...":"Run All Checks"})]})}),e.jsx(w,{children:e.jsx("div",{className:"space-y-4",children:i.map((t,s)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted/50 rounded-lg transition-all",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:f(t.status)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm font-medium",children:[s+1,". ",t.title]})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.description}),t.message&&e.jsx("p",{className:`text-xs mt-2 ${t.status==="passed"?"text-green-600 dark:text-green-400":t.status==="warning"?"text-yellow-600 dark:text-yellow-400":t.status==="failed"?"text-red-600 dark:text-red-400":"text-muted-foreground"}`,children:t.message})]})]},t.id))})})]})},Ds=()=>{const{toast:i}=F(),[l,o]=h.useState({totalConversations:0,completedConversations:0,failedConversations:0,averageResponseTime:0,averageDuration:0,messagesPerConversation:0}),[d,r]=h.useState([]),[g,a]=h.useState([]),[u,c]=h.useState(!0),[n,m]=h.useState("healthy");h.useEffect(()=>{f();const x=setInterval(f,3e4),j=p.channel("conversation-updates").on("postgres_changes",{event:"*",schema:"public",table:"conversation_history"},()=>{f()}).subscribe();return()=>{clearInterval(x),p.removeChannel(j)}},[]);const f=async()=>{try{c(!0);const{data:x,error:j}=await p.from("conversation_history").select("conversation_id, created_at, role, message").order("created_at",{ascending:!1});if(j)throw j;const{data:b,error:D}=await p.from("profiles").select("onboarding_completed, agent_configured, agent_last_configured_at");if(D)throw D;const C=new Map;x==null||x.forEach(M=>{C.has(M.conversation_id)||C.set(M.conversation_id,[]),C.get(M.conversation_id).push(M)});const R=C.size;let I=0,q=0,V=0,me=0,xe=0;const Z=[],ue=[];C.forEach((M,Ue)=>{const P=M.sort((L,se)=>new Date(L.created_at).getTime()-new Date(se.created_at).getTime());me+=M.length;const ge=M.some(L=>L.role==="assistant"&&L.message.toLowerCase().includes("complete"));ge&&I++;const Fe=new Date(P[0].created_at).getTime(),pe=(new Date(P[P.length-1].created_at).getTime()-Fe)/1e3;xe+=pe;for(let L=0;L<P.length-1;L++)if(P[L].role==="user"&&P[L+1].role==="assistant"){const se=new Date(P[L].created_at).getTime(),fe=(new Date(P[L+1].created_at).getTime()-se)/1e3;q+=fe,V++,ue.push({timestamp:new Date(P[L+1].created_at).toLocaleTimeString(),responseTime:Math.round(fe*100)/100})}Z.length<5&&Z.push({id:Ue,started_at:P[0].created_at,completed:ge,message_count:M.length,duration:Math.round(pe)})});const he=V>0?q/V:0,Re=R>0?xe/R:0,Pe=R>0?me/R:0;let ee="healthy";he>5&&(ee="degraded"),(R===0||!(b!=null&&b.some(M=>M.agent_configured)))&&(ee="offline"),o({totalConversations:R,completedConversations:I,failedConversations:R-I,averageResponseTime:Math.round(he*100)/100,averageDuration:Math.round(Re),messagesPerConversation:Math.round(Pe*10)/10}),r(ue.slice(-20)),a(Z),m(ee)}catch(x){console.error("Error loading metrics:",x),i({title:"Error loading metrics",description:x instanceof Error?x.message:"Unknown error",variant:"destructive"})}finally{c(!1)}},t=l.totalConversations>0?Math.round(l.completedConversations/l.totalConversations*100):0,s=[{name:"Completed",value:l.completedConversations},{name:"Failed",value:l.failedConversations}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(v,{children:e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Agent Status"}),e.jsx(T,{children:"Real-time health monitoring"})]}),e.jsxs(_,{variant:n==="healthy"?"default":n==="degraded"?"secondary":"destructive",children:[e.jsx(ne,{className:"h-3 w-3 mr-1"}),n.toUpperCase()]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs(v,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Total Conversations"}),e.jsx(re,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(w,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l.totalConversations}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[l.messagesPerConversation," avg messages per conversation"]})]})]}),e.jsxs(v,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Avg Response Time"}),e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(w,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[l.averageResponseTime,"s"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Time between user message and response"})]})]}),e.jsxs(v,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Completion Rate"}),e.jsx(Le,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(w,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[t,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[l.completedConversations," of ",l.totalConversations," successful"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsx(y,{children:"Response Times"}),e.jsx(T,{children:"Last 20 agent responses"})]}),e.jsx(w,{children:e.jsx(we,{width:"100%",height:200,className:"sm:h-[300px]",children:e.jsxs(ts,{data:d,children:[e.jsx(Ce,{strokeDasharray:"3 3"}),e.jsx(_e,{dataKey:"timestamp",className:"text-xs"}),e.jsx(Ae,{label:{value:"Seconds",angle:-90,position:"insideLeft"},className:"text-xs"}),e.jsx(Se,{}),e.jsx(as,{type:"monotone",dataKey:"responseTime",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{r:4}})]})})})]}),e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsx(y,{children:"Conversation Outcomes"}),e.jsx(T,{children:"Success vs failure breakdown"})]}),e.jsx(w,{children:e.jsx(we,{width:"100%",height:200,className:"sm:h-[300px]",children:e.jsxs(ns,{data:s,children:[e.jsx(Ce,{strokeDasharray:"3 3"}),e.jsx(_e,{dataKey:"name",className:"text-xs"}),e.jsx(Ae,{className:"text-xs"}),e.jsx(Se,{}),e.jsx(rs,{dataKey:"value",fill:"hsl(var(--primary))"})]})})})]})]}),e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsx(y,{children:"Recent Conversations"}),e.jsx(T,{children:"Latest 5 conversations"})]}),e.jsx(w,{children:e.jsx("div",{className:"space-y-3",children:g.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No conversations yet"}):g.map(x=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 sm:gap-0 p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[x.completed?e.jsx($,{className:"h-4 w-4 text-green-500 flex-shrink-0"}):e.jsx(z,{className:"h-4 w-4 text-orange-500 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium truncate",children:["Conversation ",x.id.substring(0,8),"..."]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(x.started_at).toLocaleString()})]})]}),e.jsxs("div",{className:"flex gap-3 text-sm sm:text-right ml-7 sm:ml-0",children:[e.jsxs("p",{className:"font-medium",children:[x.message_count," msgs"]}),e.jsxs("p",{className:"text-muted-foreground",children:[x.duration,"s"]})]})]},x.id))})})]})]})},Is=()=>{const[i,l]=h.useState([]),[o,d]=h.useState(!0),r=async()=>{d(!0);try{const{data:g,error:a}=await p.from("conversation_history").select("*").eq("role","tool").order("created_at",{ascending:!1}).limit(50);if(a)throw a;l(g||[])}catch(g){console.error("Failed to fetch tool logs:",g)}finally{d(!1)}};return h.useEffect(()=>{r();const g=setInterval(r,5e3);return()=>clearInterval(g)},[]),e.jsxs(v,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between",children:[e.jsx(y,{children:"Tool Call Logs"}),e.jsx(k,{variant:"outline",size:"sm",onClick:r,disabled:o,children:e.jsx(O,{className:`h-4 w-4 ${o?"animate-spin":""}`})})]}),e.jsx(w,{children:e.jsx(U,{className:"h-[calc(100vh-300px)] max-h-[600px] min-h-[300px]",children:e.jsx("div",{className:"space-y-4",children:i.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No tool calls logged yet"}):i.map(g=>{const a=g.metadata;return e.jsxs("div",{className:`p-4 rounded-lg border ${a!=null&&a.error?"bg-destructive/10 border-destructive":"bg-secondary/50"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{variant:"outline",children:(a==null?void 0:a.tool)||"Unknown"}),(a==null?void 0:a.error)&&e.jsx(_,{variant:"destructive",children:"ERROR"})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(g.created_at).toLocaleString()})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Parameters:"}),e.jsx("pre",{className:"mt-1 p-2 bg-background rounded text-xs overflow-x-auto",children:JSON.stringify((a==null?void 0:a.parameters)||{},null,2)})]}),a!=null&&a.error?e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-destructive",children:"Error:"}),e.jsx("p",{className:"mt-1 text-destructive",children:a.error})]}):e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Result:"}),e.jsx("p",{className:"mt-1",children:(a==null?void 0:a.result)||"No result"})]})]})]},g.id)})})})})]})},Ls=()=>{const[i,l]=h.useState(null),[o,d]=h.useState(!1),r=async()=>{d(!0);try{const{data:{session:a}}=await p.auth.getSession();if(!(a!=null&&a.user))return;const{data:u}=await p.from("profiles").select("*").eq("id",a.user.id).single(),{data:c}=await p.from("household_members").select("*").eq("user_id",a.user.id),{data:n}=await p.from("pets").select("*").eq("user_id",a.user.id),{data:m}=await p.from("profiles").select("current_household_id").eq("id",a.user.id).single(),f=m==null?void 0:m.current_household_id,{data:t}=f?await p.from("inventory").select("*").eq("household_id",f).order("last_activity_at",{ascending:!1}).limit(20):{data:null},{data:s}=f?await p.from("shopping_list").select("*").eq("household_id",f).eq("status","pending"):{data:null};l({profile:u,household:c,pets:n,inventory:t,shoppingList:s})}catch(a){console.error("Failed to fetch context:",a)}finally{d(!1)}};h.useEffect(()=>{r()},[]);const g=()=>{var C,R;if(!i)return"";const{profile:a,household:u,pets:c,inventory:n,shoppingList:m}=i,f=((C=a==null?void 0:a.allergies)==null?void 0:C.length)>0?`Allergies: ${a.allergies.join(", ")}`:"",t=((R=a==null?void 0:a.dietary_preferences)==null?void 0:R.length)>0?a.dietary_preferences.join(", "):"",s=[f,t].filter(Boolean).join(" | ")||"None",x=(u==null?void 0:u.map(I=>{var V;const q=((V=I.allergies)==null?void 0:V.length)>0?` (${I.allergies.join(", ")})`:"";return`${I.name||I.member_type}${q}`}).join(", "))||"None",j=(c==null?void 0:c.map(I=>`${I.name} (${I.species})`).join(", "))||"None",b=(n==null?void 0:n.slice(0,5).map(I=>`${I.name} (${I.quantity||0})`).join(", "))||"No items",D=(m==null?void 0:m.length)||0;return`[USER CONTEXT]
Name: ${(a==null?void 0:a.user_name)||"User"}
TDEE Baseline: ${(a==null?void 0:a.calculated_tdee)||"Not calculated"} calories/day
Shield: ${s}
Tribe: ${x} | Pets: ${j}
Inventory Snapshot: ${b}
Cart Status: ${D} items pending
[END CONTEXT]`};return e.jsxs(v,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between",children:[e.jsx(y,{children:"Context Preview"}),e.jsx(k,{variant:"outline",size:"sm",onClick:r,disabled:o,children:e.jsx(O,{className:`h-4 w-4 ${o?"animate-spin":""}`})})]}),e.jsx(w,{children:e.jsxs(Y,{defaultValue:"formatted",children:[e.jsxs(Q,{className:"grid w-full grid-cols-2",children:[e.jsx(A,{value:"formatted",children:"Formatted Prompt"}),e.jsx(A,{value:"raw",children:"Raw JSON"})]}),e.jsx(S,{value:"formatted",className:"mt-4",children:e.jsx("pre",{className:"p-4 bg-secondary rounded-lg text-sm overflow-x-auto whitespace-pre-wrap",children:i?g():"Loading..."})}),e.jsx(S,{value:"raw",className:"mt-4",children:e.jsx("pre",{className:"p-4 bg-secondary rounded-lg text-xs overflow-x-auto",children:i?JSON.stringify(i,null,2):"Loading..."})})]})})]})},Ms=()=>{const[i,l]=h.useState(!1),[o,d]=h.useState([]),{toast:r}=F(),g=async()=>{l(!0),d([]);try{const{data:c,error:n}=await p.functions.invoke("provision-agents");if(n)throw n;if(c.success)d(c.results),r({title:"Agents Provisioned",description:`Successfully provisioned ${c.results.length} agents`});else throw new Error(c.error||"Unknown error")}catch(c){console.error("Provisioning error:",c),r({title:"Provisioning Failed",description:c instanceof Error?c.message:"Failed to provision agents",variant:"destructive"})}finally{l(!1)}},a=c=>{switch(c){case"created":case"updated":return e.jsx($,{className:"h-5 w-5 text-secondary"});case"error":return e.jsx(z,{className:"h-5 w-5 text-red-500"});default:return e.jsx(H,{className:"h-5 w-5 text-accent"})}},u=c=>{switch(c){case"created":return e.jsx(_,{className:"bg-secondary/20 text-secondary border-secondary/30",children:"Created"});case"updated":return e.jsx(_,{className:"bg-accent/20 text-accent border-accent/30",children:"Updated"});case"error":return e.jsx(_,{variant:"destructive",children:"Error"});default:return e.jsx(_,{variant:"secondary",children:"Unknown"})}};return e.jsxs(v,{className:"glass-card border-secondary/20",children:[e.jsxs(N,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-secondary"}),e.jsx(y,{className:"text-display text-white",children:"Agent Provisioning"})]}),e.jsx(T,{className:"text-body text-white/60",children:"Automatically create and configure ElevenLabs agents with one click"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("p",{className:"text-micro text-white/70",children:"This will create or update both the Onboarding and Assistant agents in your ElevenLabs account. All configurations will be applied automatically."}),e.jsx(k,{onClick:g,disabled:i,className:"w-full bg-secondary hover:bg-secondary/80 text-background",size:"lg",children:i?e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"mr-2 h-4 w-4 animate-spin"}),"Provisioning Agents..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Provision Agents (One-Click Setup)"]})})]}),o.length>0&&e.jsxs("div",{className:"space-y-3 pt-4 border-t border-white/10",children:[e.jsx("h4",{className:"text-body font-medium text-white",children:"Provisioning Results"}),o.map((c,n)=>e.jsx("div",{className:"flex items-start justify-between p-3 rounded-lg bg-background/20 border border-white/10",children:e.jsxs("div",{className:"flex items-start gap-3",children:[a(c.status),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h5",{className:"text-micro font-medium text-white capitalize",children:[c.type," Agent"]}),u(c.status)]}),c.name&&e.jsxs("p",{className:"text-micro text-white/60",children:["Name: ",c.name]}),c.agent_id&&e.jsxs("p",{className:"text-micro text-white/60 font-mono",children:["ID: ",c.agent_id]}),c.error&&e.jsxs("p",{className:"text-micro text-red-400",children:["Error: ",c.error]})]})]})},n))]}),e.jsxs("div",{className:"pt-4 border-t border-white/10",children:[e.jsx("h4",{className:"text-micro font-medium text-white mb-2",children:"What happens:"}),e.jsxs("ul",{className:"space-y-1 text-micro text-white/60",children:[e.jsx("li",{children:"• Checks if agents exist in your ElevenLabs account"}),e.jsx("li",{children:"• Creates new agents if they don't exist"}),e.jsx("li",{children:"• Updates existing agents with latest configuration"}),e.jsx("li",{children:"• Applies all prompts, tools, and voice settings"}),e.jsx("li",{children:"• Safe to run multiple times (idempotent)"})]})]})]})]})},Rs=()=>{const[i,l]=h.useState([]),[o,d]=h.useState([]),[r,g]=h.useState(null),a=h.useRef(null);h.useEffect(()=>{u(),c();const s=p.channel("conversation-events-monitor").on("postgres_changes",{event:"INSERT",schema:"public",table:"conversation_events"},x=>{console.log("📡 New conversation event:",x);const j=x.new;l(b=>[j,...b].slice(0,100)),d(b=>b.find(C=>C.conversation_id===j.conversation_id)?b.map(C=>C.conversation_id===j.conversation_id?{...C,last_activity:j.created_at,event_count:C.event_count+1}:C):j.event_type==="session_start"?[{conversation_id:j.conversation_id,user_id:j.user_id,agent_type:j.agent_type,started_at:j.created_at,last_activity:j.created_at,event_count:1},...b]:b)}).subscribe();return()=>{p.removeChannel(s)}},[]),h.useEffect(()=>{a.current&&(a.current.scrollTop=0)},[i]);const u=async()=>{const{data:s,error:x}=await p.from("conversation_events").select("*").order("created_at",{ascending:!1}).limit(50);s&&!x&&l(s)},c=async()=>{const s=new Date(Date.now()-18e5).toISOString(),{data:x,error:j}=await p.from("conversation_events").select("conversation_id, user_id, agent_type, created_at").gte("created_at",s).order("created_at",{ascending:!1});if(x&&!j){const b=x.reduce((D,C)=>(D[C.conversation_id]?(D[C.conversation_id].event_count++,C.created_at>D[C.conversation_id].last_activity&&(D[C.conversation_id].last_activity=C.created_at)):D[C.conversation_id]={conversation_id:C.conversation_id,user_id:C.user_id,agent_type:C.agent_type,started_at:C.created_at,last_activity:C.created_at,event_count:1},D),{});d(Object.values(b))}},n=s=>{switch(s){case"session_start":case"session_end":return e.jsx(xs,{className:"h-4 w-4"});case"user_transcript":case"agent_transcript":return e.jsx(re,{className:"h-4 w-4"});case"tool_call":case"tool_response":return e.jsx(oe,{className:"h-4 w-4"});default:return e.jsx(ne,{className:"h-4 w-4"})}},m=s=>{switch(s){case"session_start":return"bg-green-500/10 text-green-500 border-green-500/20";case"session_end":return"bg-red-500/10 text-red-500 border-red-500/20";case"user_transcript":return"bg-blue-500/10 text-blue-500 border-blue-500/20";case"agent_transcript":return"bg-purple-500/10 text-purple-500 border-purple-500/20";case"tool_call":return"bg-orange-500/10 text-orange-500 border-orange-500/20";case"tool_response":return"bg-yellow-500/10 text-yellow-500 border-yellow-500/20";default:return"bg-muted text-muted-foreground border-border"}},f=s=>s==="user"?e.jsx(is,{className:"h-3 w-3"}):s==="assistant"?e.jsx(os,{className:"h-3 w-3"}):null,t=r?i.filter(s=>s.conversation_id===r):i;return e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs(v,{className:"lg:col-span-1",children:[e.jsxs(N,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5 text-secondary"}),"Active Conversations"]}),e.jsxs(T,{children:["Last 30 minutes (",o.length," active)"]})]}),e.jsx(w,{children:e.jsx(U,{className:"h-[calc(100vh-300px)] max-h-[600px] min-h-[300px] pr-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(ke,{children:o.map(s=>e.jsxs(ie.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:`p-3 rounded-lg border cursor-pointer transition-all ${r===s.conversation_id?"bg-secondary/10 border-secondary":"bg-muted/50 border-border hover:bg-muted"}`,onClick:()=>g(r===s.conversation_id?null:s.conversation_id),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx(_,{variant:"outline",className:"text-xs",children:s.agent_type}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.event_count," events"]})]}),e.jsxs("div",{className:"text-xs font-mono text-muted-foreground truncate",children:[s.conversation_id.slice(0,16),"..."]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:new Date(s.last_activity).toLocaleTimeString()})]},s.conversation_id))}),o.length===0&&e.jsx("div",{className:"text-center text-sm text-muted-foreground py-8",children:"No active conversations"})]})})})]}),e.jsxs(v,{className:"lg:col-span-2",children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-secondary"}),"Live Event Stream"]}),e.jsx(T,{children:r?`Filtered: ${r.slice(0,16)}...`:"All conversations"})]}),r&&e.jsx(_,{variant:"outline",className:"cursor-pointer",onClick:()=>g(null),children:"Clear Filter"})]})}),e.jsx(w,{children:e.jsx(U,{className:"h-[calc(100vh-300px)] max-h-[600px] min-h-[300px]",ref:a,children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(ke,{children:t.map(s=>e.jsxs(ie.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:`p-4 rounded-lg border ${m(s.event_type)}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n(s.event_type),e.jsx(_,{variant:"outline",className:"text-xs",children:s.event_type}),s.role&&e.jsxs("div",{className:"flex items-center gap-1",children:[f(s.role),e.jsx("span",{className:"text-xs",children:s.role})]})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleTimeString()})]}),e.jsxs("div",{className:"mt-2",children:[s.event_type==="user_transcript"&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"User: "}),s.event_data.text||s.event_data.transcript]}),s.event_type==="agent_transcript"&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Assistant: "}),s.event_data.text||s.event_data.transcript]}),s.event_type==="tool_call"&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-sm font-medium",children:["Tool: ",s.event_data.tool_name||s.event_data.name]}),e.jsx("pre",{className:"text-xs bg-background/50 p-2 rounded overflow-x-auto",children:JSON.stringify(s.event_data.parameters||s.event_data.arguments,null,2)})]}),s.event_type==="tool_response"&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Response: "}),s.event_data.result||s.event_data.output]}),(s.event_type==="session_start"||s.event_type==="session_end")&&e.jsx("div",{className:"text-sm font-medium",children:s.event_type==="session_start"?"🟢 Session Started":"🔴 Session Ended"})]}),e.jsx("div",{className:"text-xs font-mono text-muted-foreground mt-2 opacity-50",children:s.conversation_id})]},s.id))}),t.length===0&&e.jsx("div",{className:"text-center text-sm text-muted-foreground py-12",children:"No events to display"})]})})})]})]})},Ps=()=>{const[i,l]=h.useState([]),[o,d]=h.useState(!1),r=()=>{d(!0);const n=[];n.push({category:"contrast",status:"pass",message:"Primary text (Mist #E2E8F0) on Deep Slate (#08080A) background",element:"body text",recommendation:"Contrast ratio: 15.8:1 (WCAG AAA compliant)"}),n.push({category:"contrast",status:"pass",message:"Autumn Gold (#D69E2E) on Deep Slate (#08080A) background",element:"primary buttons",recommendation:"Contrast ratio: 8.2:1 (WCAG AA compliant)"}),n.push({category:"contrast",status:"pass",message:"Electric Sage (#70E098) on Deep Slate (#08080A) background",element:"success indicators",recommendation:"Contrast ratio: 9.1:1 (WCAG AA compliant)"}),n.push({category:"contrast",status:"pass",message:"Muted text (#94A3B8) on Deep Slate (#08080A) background",element:"secondary text",recommendation:"Contrast ratio: 7.5:1 (WCAG AA compliant)"}),n.push({category:"touch-targets",status:"pass",message:"Living Aperture (KaevaAperture) button: 64-72px diameter",element:"FloatingActionButton center",recommendation:"Exceeds 44px minimum (WCAG 2.5.5 compliant)"}),n.push({category:"touch-targets",status:"pass",message:"Bottom tab bar buttons: 56px height",element:"BottomTabBar",recommendation:"Exceeds 44px minimum (WCAG 2.5.5 compliant)"}),n.push({category:"touch-targets",status:"pass",message:"Floating dock Settings and Profile buttons: 44px minimum",element:"AppShell dock buttons",recommendation:"Meets 44px minimum (WCAG 2.5.5 compliant)"}),n.push({category:"touch-targets",status:"pass",message:"Scanner capture button: 80px diameter",element:"SmartScanner CaptureButton",recommendation:"Exceeds 44px minimum (WCAG 2.5.5 compliant)"}),n.push({category:"touch-targets",status:"warning",message:"Some badge elements may be below 44px",element:"Badge components",recommendation:"Review interactive badges and ensure 44px minimum or make non-interactive"}),n.push({category:"aria-labels",status:"pass",message:'Living Aperture has aria-label="Activate voice assistant or scanner"',element:"KaevaAperture",recommendation:"Descriptive label provided"}),n.push({category:"aria-labels",status:"pass",message:"Navigation items have descriptive labels",element:"BottomTabBar NavLink",recommendation:"All nav items properly labeled"}),n.push({category:"aria-labels",status:"warning",message:"Some icon-only buttons may lack aria-labels",element:"Various icon buttons",recommendation:"Audit all icon buttons and add aria-label or aria-labelledby"}),n.push({category:"aria-labels",status:"pass",message:"Form inputs have associated labels",element:"Input components",recommendation:"Labels properly connected via htmlFor"}),n.push({category:"aria-labels",status:"warning",message:"Loading states should announce to screen readers",element:"Loading skeletons",recommendation:'Add aria-live="polite" and aria-busy="true" to loading states'}),n.push({category:"voice-fallbacks",status:"pass",message:"Onboarding: Manual forms available alongside voice conversation",element:"VoiceOnboarding + OnboardingForms",recommendation:"Users can complete onboarding via text input"}),n.push({category:"voice-fallbacks",status:"pass",message:"Voice assistant: Manual search and text input available",element:"GlobalSearch component",recommendation:"Users can search without voice"}),n.push({category:"voice-fallbacks",status:"pass",message:"Scanner: Manual text input for product names",element:"SmartScanner text input mode",recommendation:"Users can add items without camera/voice"}),n.push({category:"voice-fallbacks",status:"pass",message:"Meal logging: Manual form entry alongside voice input",element:"VoiceMealInput + manual forms",recommendation:"Users can log meals via text forms"}),n.push({category:"voice-fallbacks",status:"pass",message:"Recipe cooking: Manual step navigation alongside voice guidance",element:"CookingMode buttons",recommendation:"Users can cook without voice (tap next/prev)"}),n.push({category:"voice-fallbacks",status:"warning",message:"Smart Chips provide quick-reply buttons in onboarding",element:"SmartChips component",recommendation:"Ensure all voice prompts have visual button alternatives"}),n.push({category:"voice-fallbacks",status:"pass",message:"Wake word detection is opt-in, not required",element:"useWakeWordDetection",recommendation:"Users never forced to use voice features"}),l(n),d(!1)};h.useEffect(()=>{r()},[]);const g=n=>{switch(n){case"pass":return e.jsx($,{className:"w-4 h-4 text-secondary"});case"warning":return e.jsx(H,{className:"w-4 h-4 text-primary"});case"fail":return e.jsx(z,{className:"w-4 h-4 text-destructive"})}},a=n=>{switch(n){case"pass":return"bg-secondary/10 text-secondary border-secondary/30";case"warning":return"bg-primary/10 text-primary border-primary/30";case"fail":return"bg-destructive/10 text-destructive border-destructive/30"}},u=n=>i.filter(m=>m.category===n),c=n=>{const m=u(n),f=m.filter(x=>x.status==="pass").length,t=m.filter(x=>x.status==="warning").length,s=m.filter(x=>x.status==="fail").length;return{pass:f,warning:t,fail:s,total:m.length}};return e.jsxs(v,{className:"glass-card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Accessibility Audit"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"WCAG 2.1 Level AA Compliance Check"})]}),e.jsxs(k,{onClick:r,disabled:o,size:"sm",className:"gap-2",children:[e.jsx(O,{className:`w-4 h-4 ${o?"animate-spin":""}`}),o?"Running...":"Re-run Audit"]})]}),e.jsxs(Y,{defaultValue:"contrast",className:"w-full",children:[e.jsxs(Q,{className:"grid grid-cols-4 w-full",children:[e.jsxs(A,{value:"contrast",children:["Contrast",e.jsxs(_,{variant:"outline",className:"ml-2 text-xs",children:[c("contrast").pass,"/",c("contrast").total]})]}),e.jsxs(A,{value:"touch",children:["Touch Targets",e.jsxs(_,{variant:"outline",className:"ml-2 text-xs",children:[c("touch-targets").pass,"/",c("touch-targets").total]})]}),e.jsxs(A,{value:"aria",children:["ARIA Labels",e.jsxs(_,{variant:"outline",className:"ml-2 text-xs",children:[c("aria-labels").pass,"/",c("aria-labels").total]})]}),e.jsxs(A,{value:"voice",children:["Voice Fallbacks",e.jsxs(_,{variant:"outline",className:"ml-2 text-xs",children:[c("voice-fallbacks").pass,"/",c("voice-fallbacks").total]})]})]}),e.jsxs(U,{className:"h-[600px] mt-6",children:[e.jsxs(S,{value:"contrast",className:"space-y-3 mt-0",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-2",children:"Color Contrast Ratios"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"WCAG AA requires 4.5:1 for normal text, 3:1 for large text (18pt+)"})]}),u("contrast").map((n,m)=>e.jsx("div",{className:`p-4 rounded-lg border ${a(n.status)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[g(n.status),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm mb-1",children:n.message}),n.element&&e.jsxs("p",{className:"text-xs opacity-75 mb-2",children:["Element: ",n.element]}),n.recommendation&&e.jsx("p",{className:"text-xs opacity-90",children:n.recommendation})]})]})},m))]}),e.jsxs(S,{value:"touch",className:"space-y-3 mt-0",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-2",children:"Touch Target Sizes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"WCAG 2.5.5 requires minimum 44x44px touch targets for interactive elements"})]}),u("touch-targets").map((n,m)=>e.jsx("div",{className:`p-4 rounded-lg border ${a(n.status)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[g(n.status),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm mb-1",children:n.message}),n.element&&e.jsxs("p",{className:"text-xs opacity-75 mb-2",children:["Element: ",n.element]}),n.recommendation&&e.jsx("p",{className:"text-xs opacity-90",children:n.recommendation})]})]})},m))]}),e.jsxs(S,{value:"aria",className:"space-y-3 mt-0",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-2",children:"ARIA Labels & Semantics"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"All interactive elements must have accessible names for screen readers"})]}),u("aria-labels").map((n,m)=>e.jsx("div",{className:`p-4 rounded-lg border ${a(n.status)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[g(n.status),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm mb-1",children:n.message}),n.element&&e.jsxs("p",{className:"text-xs opacity-75 mb-2",children:["Element: ",n.element]}),n.recommendation&&e.jsx("p",{className:"text-xs opacity-90",children:n.recommendation})]})]})},m))]}),e.jsxs(S,{value:"voice",className:"space-y-3 mt-0",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-2",children:"Voice Interaction Fallbacks"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Every voice action must have a manual UI alternative for silent environments"})]}),u("voice-fallbacks").map((n,m)=>e.jsx("div",{className:`p-4 rounded-lg border ${a(n.status)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[g(n.status),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm mb-1",children:n.message}),n.element&&e.jsxs("p",{className:"text-xs opacity-75 mb-2",children:["Element: ",n.element]}),n.recommendation&&e.jsx("p",{className:"text-xs opacity-90",children:n.recommendation})]})]})},m))]})]})]})]})},Me=h.forwardRef(({className:i,orientation:l="horizontal",decorative:o=!0,...d},r)=>e.jsx(Te,{ref:r,decorative:o,orientation:l,className:J("shrink-0 bg-border",l==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",i),...d}));Me.displayName=Te.displayName;const Us=()=>{const[i,l]=h.useState(!1),[o,d]=h.useState(!1),[r,g]=h.useState({}),{toast:a}=F(),u=[{name:"icon-192.png",size:"192x192",label:"Standard 192"},{name:"icon-512.png",size:"512x512",label:"Standard 512"},{name:"icon-maskable-192.png",size:"192x192",label:"Maskable 192"},{name:"icon-maskable-512.png",size:"512x512",label:"Maskable 512"}],c=async()=>{d(!0);try{const m={};for(const f of u){const{data:t}=p.storage.from("app-assets").getPublicUrl(f.name);m[f.name]=`${t.publicUrl}?t=${Date.now()}`}g(m)}catch(m){console.error("Error loading icon previews:",m)}finally{d(!1)}};h.useEffect(()=>{c()},[]);const n=async()=>{l(!0);try{const{data:m,error:f}=await p.functions.invoke("generate-app-icons");if(f)throw f;if(m!=null&&m.success)a({title:"Icons Generated Successfully",description:"PWA icons have been generated and uploaded. Users will see the KAEVA K logo when adding the app to their home screen."}),await c();else throw new Error((m==null?void 0:m.error)||"Generation failed")}catch(m){console.error("Icon generation error:",m),a({title:"Generation Failed",description:m instanceof Error?m.message:"Failed to generate PWA icons. Check console for details.",variant:"destructive"})}finally{l(!1)}};return e.jsxs(v,{className:"glass-card border-white/10",children:[e.jsxs(N,{children:[e.jsxs(y,{className:"text-white flex items-center gap-2",children:[e.jsx(te,{size:20,strokeWidth:1.5,className:"text-primary"}),"PWA Icon Generator"]}),e.jsx(T,{className:"text-white/60",children:"Generate app icons using AI for home screen installation"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"text-body text-white/80 text-sm space-y-2",children:[e.jsx("p",{children:"This generates the KAEVA K logo with Autumn Gold gradient as PWA icons in multiple sizes."}),e.jsx("p",{className:"text-white/60",children:"Icons will be uploaded to storage and referenced in the manifest."})]}),e.jsx(k,{onClick:n,disabled:i,className:"w-full",variant:"default",children:i?e.jsxs(e.Fragment,{children:[e.jsx(K,{size:"xs",speed:"fast",showCore:!1,className:"mr-2"}),"Generating Icons..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Generate PWA Icons"]})}),i&&e.jsx("div",{className:"text-micro text-white/60 text-center",children:"This may take 30-60 seconds to generate 4 icon sizes..."}),e.jsx(Me,{className:"bg-white/10"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-body text-white font-medium",children:"Current Icons"}),e.jsx(k,{variant:"glass",size:"sm",onClick:c,disabled:o,children:o?e.jsx(K,{size:"xs",speed:"fast",showCore:!1}):e.jsx(O,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:u.map(m=>e.jsxs("div",{className:"glass-card p-3 sm:p-4 space-y-2 border-white/5 hover:border-white/10 transition-colors",children:[e.jsx("div",{className:"aspect-square bg-background/50 rounded-lg flex items-center justify-center overflow-hidden",children:r[m.name]?e.jsx("img",{src:r[m.name],alt:m.label,className:"w-full h-full object-contain",onError:f=>{f.currentTarget.style.display="none"}}):e.jsx(te,{className:"text-white/20",size:48,strokeWidth:1.5})}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("p",{className:"text-micro text-white/80 font-medium",children:m.label}),e.jsx("p",{className:"text-micro text-white/40",children:m.size})]})]},m.name))}),Object.keys(r).length===0&&!o&&e.jsx("p",{className:"text-micro text-white/40 text-center py-4",children:"No icons found. Generate icons to see them here."})]})]})]})},nt=()=>{const i=He();return e.jsx("div",{className:"h-screen bg-background flex flex-col safe-top safe-bottom",children:e.jsx(U,{className:"flex-1",children:e.jsxs(ie.div,{className:"max-w-7xl mx-auto space-y-4 sm:space-y-6 p-4 sm:p-6 pb-16",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:Ke,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{size:24,strokeWidth:1.5,className:"text-secondary"}),e.jsx("h1",{className:"text-display text-xl sm:text-2xl md:text-3xl text-white",children:"ADMIN DASHBOARD"})]}),e.jsx("p",{className:"text-body text-sm sm:text-base text-white/60",children:"Manage agent configuration, testing, and system monitoring"})]}),e.jsxs(k,{variant:"glass",onClick:()=>i("/"),className:"self-start sm:self-auto",children:[e.jsx(cs,{size:20,strokeWidth:1.5}),e.jsx("span",{className:"text-micro ml-2 hidden sm:inline",children:"Back to Dashboard"})]})]}),e.jsxs(Y,{defaultValue:"health",className:"space-y-4 sm:space-y-6",children:[e.jsx(U,{className:"w-full",children:e.jsxs(Q,{className:"inline-flex h-10 sm:h-12 w-max gap-1 p-1 glass-card",children:[e.jsx(A,{value:"health",className:"text-micro px-2 sm:px-4 min-w-[60px] sm:min-w-[80px]",children:"Health"}),e.jsx(A,{value:"agent",className:"text-micro px-2 sm:px-4 min-w-[60px] sm:min-w-[80px]",children:"Agent"}),e.jsx(A,{value:"monitor",className:"text-micro px-2 sm:px-4 min-w-[60px] sm:min-w-[80px]",children:"Monitor"}),e.jsx(A,{value:"testing",className:"text-micro px-2 sm:px-4 min-w-[60px] sm:min-w-[80px]",children:"Testing"}),e.jsx(A,{value:"users",className:"text-micro px-2 sm:px-4 min-w-[60px] sm:min-w-[80px]",children:"Users"}),e.jsx(A,{value:"database",className:"text-micro px-2 sm:px-4 min-w-[60px] sm:min-w-[80px]",children:"Database"}),e.jsx(A,{value:"logs",className:"text-micro px-2 sm:px-4 min-w-[60px] sm:min-w-[80px]",children:"Logs"}),e.jsx(A,{value:"tool-logs",className:"text-micro px-2 sm:px-4 min-w-[60px] sm:min-w-[80px]",children:"Tools"}),e.jsx(A,{value:"context",className:"text-micro px-2 sm:px-4 min-w-[60px] sm:min-w-[80px]",children:"Context"}),e.jsx(A,{value:"analytics",className:"text-micro px-2 sm:px-4 min-w-[70px] sm:min-w-[80px]",children:"Analytics"}),e.jsx(A,{value:"accessibility",className:"text-micro px-2 sm:px-4 min-w-[90px] sm:min-w-[120px]",children:"Accessibility"})]})}),e.jsx(S,{value:"health",className:"space-y-6",children:e.jsx(Ds,{})}),e.jsxs(S,{value:"agent",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Ms,{}),e.jsx(ks,{})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Ts,{}),e.jsx(Es,{})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:e.jsx(Us,{})})]}),e.jsx(S,{value:"monitor",children:e.jsx(Rs,{})}),e.jsx(S,{value:"testing",children:e.jsx(ys,{})}),e.jsx(S,{value:"users",children:e.jsx(bs,{})}),e.jsx(S,{value:"database",children:e.jsx(ws,{})}),e.jsx(S,{value:"logs",children:e.jsx(As,{})}),e.jsx(S,{value:"tool-logs",children:e.jsx(Is,{})}),e.jsx(S,{value:"context",children:e.jsx(Ls,{})}),e.jsx(S,{value:"analytics",children:e.jsx(Ss,{})}),e.jsx(S,{value:"accessibility",children:e.jsx(Ps,{})})]})]})})})};export{nt as default};

import{j as e}from"./ui-vendor-CRu_cuPE.js";import{r as s,u as He}from"./react-vendor-DwZQO67Z.js";import{d as $,a as q,D as os,e as cs,f as ds,g as ms,h as hs,I as L,B as F,i as ye,j as ge,s as C,C as us,k as xs,S as Y,l as K,m as W,n as Z,X as se,o as ps,L as A,p as Se,q as ue,T as Ue,A as Be,r as qe,t as Ve,v as Re,w as gs,x as $e,y as Ye,z as Ke,E as We,F as fs,G as ys,H as vs,J as xe,M as ve,N as js,P as Ns,O as bs,Q as ws,R as Ss,U as _s}from"./index-D4bhw5kJ.js";import{A as ks}from"./AuroraBackground-BbE4aKfk.js";import{A as Ze,m as T}from"./animation-vendor-C-lCNj7M.js";import{U as Cs}from"./UniversalShell-B176IQVx.js";import{S as Te,a as Le,b as Oe,c as Ge,d as B}from"./select-BN0Wnciu.js";import{P as be}from"./ProgressRing-DCnvmyFG.js";import{W as As}from"./wheat-e0e0sLVe.js";import{D as Ds,L as Es}from"./leaf-DXJ1a3o-.js";import{C as ze}from"./card-q-j3zA9P.js";import{M as _e,C as Fs}from"./message-square-B4wyAd_t.js";import{U as ke}from"./user-DLA5oS07.js";import{B as Ps}from"./bot-BSc2axEU.js";import{S as pe}from"./switch-_hpo76TP.js";import{P as Ms,B as Ts}from"./BottomTabBar-DZz-LxaA.js";import{u as Ls}from"./useSwipeNavigation-FVKdXjvo.js";import{P as Os}from"./PageTransition-DTafOOMG.js";import{u as Gs,O as zs}from"./OnboardingModuleSheet-B0myhNjX.js";import{U as Ie}from"./users-DudXFJtM.js";import{C as Is}from"./chart-column-Drpt_8Xs.js";import{B as Hs}from"./bell-CPPE6kjS.js";import"./chart-vendor-BDCxrQ3h.js";import"./supabase-vendor-BS1x--yE.js";import"./arrow-left-CQcT7sCo.js";import"./chevron-left-DnN1sqg3.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=$("Drumstick",[["path",{d:"M15.4 15.63a7.875 6 135 1 1 6.23-6.23 4.5 3.43 135 0 0-6.23 6.23",key:"1dtqwm"}],["path",{d:"m8.29 12.71-2.6 2.6a2.5 2.5 0 1 0-1.65 4.65A2.5 2.5 0 1 0 8.7 18.3l2.59-2.59",key:"1oq1fw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=$("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=$("Locate",[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=$("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=$("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=$("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=$("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=$("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Ks=({open:l,onClose:i,userId:g,onStoreSelected:p})=>{const[c,f]=s.useState(""),[d,j]=s.useState([]),[N,b]=s.useState(!1),[n,o]=s.useState(!1),[h,w]=s.useState(!1),[u,x]=s.useState([]),[m,D]=s.useState([]),[G,U]=s.useState({}),[Q,J]=s.useState({}),[te,M]=s.useState({}),[V,ae]=s.useState(null),{toast:P}=q(),re=(t,a,r,v)=>{const y=(r-t)*Math.PI/180,S=(v-a)*Math.PI/180,O=Math.sin(y/2)*Math.sin(y/2)+Math.cos(t*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(S/2)*Math.sin(S/2);return 3959*(2*Math.atan2(Math.sqrt(O),Math.sqrt(1-O)))},ie=async(t,a,r,v)=>{try{const k=`${t}, ${a}, ${r} ${v}`,y=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(k)}`,{headers:{"User-Agent":"Kaeva-App/1.0"}});if(!y.ok)return null;const S=await y.json();return S.length>0?{lat:parseFloat(S[0].lat),lng:parseFloat(S[0].lon)}:null}catch(k){return console.error("Geocoding error:",k),null}};s.useEffect(()=>{if(d.length>0){const t=new Map;d.forEach(r=>{const v=r.banner_name||r.name;t.set(v,(t.get(v)||0)+1)});const a=Array.from(t.entries()).map(([r,v])=>({name:r,count:v})).sort((r,v)=>r.name.localeCompare(v.name));D(a)}},[d]);const ne=async()=>{if(!navigator.geolocation){P({title:"Location Not Supported",description:"Your browser doesn't support location detection",variant:"destructive"});return}w(!0),navigator.geolocation.getCurrentPosition(async t=>{var a;try{const{latitude:r,longitude:v}=t.coords;ae({lat:r,lng:v});const k=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${r}&lon=${v}&addressdetails=1`,{headers:{"User-Agent":"Kaeva-App/1.0"}});if(!k.ok)throw new Error("Geocoding failed");const S=(a=(await k.json()).address)==null?void 0:a.postcode;if(S){const O=S.match(/\d{5}/);O?(f(O[0]),P({title:"Location Detected",description:`Using zip code: ${O[0]}`}),await X(O[0])):(P({title:"Location Detected",description:"Please verify the zip code"}),f(S.replace(/\D/g,"").slice(0,5)))}else P({title:"Zip Code Not Found",description:"Please enter your zip code manually",variant:"destructive"})}catch(r){console.error("Reverse geocoding error:",r),P({title:"Location Error",description:"Failed to get zip code from location",variant:"destructive"})}finally{w(!1)}},t=>{w(!1);let a="Failed to detect location";switch(t.code){case t.PERMISSION_DENIED:a="Location permission denied. Please enable location access in your browser settings.";break;case t.POSITION_UNAVAILABLE:a="Location information unavailable";break;case t.TIMEOUT:a="Location request timed out";break}P({title:"Location Error",description:a,variant:"destructive"})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},le=async t=>{var r,v,k;const a=t.retailer_key;if(!(G[a]||Q[a])){J(y=>({...y,[a]:!0}));try{const{data:y,error:S}=await C.functions.invoke("get-place-hours",{body:{name:t.name,address:((r=t.location)==null?void 0:r.address)||"",city:((v=t.location)==null?void 0:v.city)||"",state:((k=t.location)==null?void 0:k.state)||""}});if(S)throw S;U(O=>({...O,[a]:y}))}catch(y){console.error("Error fetching hours:",y),U(S=>({...S,[a]:{available:!1,message:"Hours unavailable"}}))}finally{J(y=>({...y,[a]:!1}))}}},X=async t=>{if(!t||t.length<5){P({title:"Invalid Zip Code",description:"Please enter a valid 5-digit zip code",variant:"destructive"});return}b(!0);try{const{data:a,error:r}=await C.functions.invoke("instacart-service",{body:{action:"get_nearby_retailers",zipCode:t}});if(r)throw r;let v=a.retailers||[];V&&v.length>0&&(v=(await Promise.all(v.map(async y=>{var S,O,oe,fe;if((S=y.location)!=null&&S.address&&((O=y.location)!=null&&O.city)&&((oe=y.location)!=null&&oe.state)&&((fe=y.location)!=null&&fe.zip_code)){const ce=await ie(y.location.address,y.location.city,y.location.state,y.location.zip_code);if(ce){const je=re(V.lat,V.lng,ce.lat,ce.lng);return{...y,distance:Math.round(je*10)/10}}}return{...y,distance:null}}))).sort((y,S)=>y.distance===null?1:S.distance===null?-1:y.distance-S.distance)),j(v),v.length===0?P({title:"No Stores Found",description:"No Instacart retailers found in this area",variant:"destructive"}):v.forEach(k=>{le(k)})}catch(a){console.error("Error fetching retailers:",a),P({title:"Error",description:"Failed to fetch nearby stores. Please try again.",variant:"destructive"})}finally{b(!1)}},me=async t=>{o(!0);try{const{error:a}=await C.from("profiles").update({preferred_retailer_id:t.retailer_key,preferred_retailer_name:t.name,user_zip_code:c,last_retailer_refresh:new Date().toISOString()}).eq("id",g);if(a)throw a;P({title:"Store Selected",description:`${t.name} is now your preferred store`}),p==null||p(t),i()}catch(a){console.error("Error selecting store:",a),P({title:"Error",description:"Failed to save store preference",variant:"destructive"})}finally{o(!1)}},I=s.useMemo(()=>u.length===0?d:d.filter(t=>u.includes(t.banner_name||t.name)),[d,u]),H=t=>{x(a=>a.includes(t)?a.filter(r=>r!==t):[...a,t])},he=t=>{M(a=>({...a,[t]:!a[t]}))};return e.jsx(os,{open:l,onOpenChange:i,children:e.jsxs(cs,{className:"sm:max-w-lg bg-slate-900 text-white border-slate-800",children:[e.jsxs(ds,{children:[e.jsxs(ms,{className:"flex items-center gap-2 text-2xl",children:[e.jsx(de,{className:"text-emerald-400"}),"Select Your Store"]}),e.jsx(hs,{className:"text-slate-400",children:"Choose your preferred Instacart retailer for seamless checkout"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Rs,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx(L,{type:"text",placeholder:"Enter zip code",value:c,onChange:t=>f(t.target.value.replace(/\D/g,"").slice(0,5)),onKeyDown:t=>t.key==="Enter"&&X(c),className:"pl-10 bg-slate-800 border-slate-700 text-white",maxLength:5})]}),e.jsx(F,{onClick:ne,disabled:h,variant:"outline",size:"icon",className:"border-slate-700 hover:bg-slate-800",title:"Detect my location",children:h?e.jsx(ye,{size:"xs",speed:"fast",showCore:!1}):e.jsx(qs,{className:"text-emerald-400",size:18})}),e.jsx(F,{onClick:()=>X(c),disabled:N||c.length<5,className:"bg-emerald-500 hover:bg-emerald-600",children:N?e.jsx(ye,{size:"xs",speed:"fast",showCore:!1}):"Search"})]}),m.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Filter by Store Chain"}),u.length>0&&e.jsx("button",{onClick:()=>x([]),className:"text-xs text-slate-400 hover:text-white",children:"Clear filters"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(t=>e.jsxs("button",{onClick:()=>H(t.name),className:ge("px-3 py-1.5 text-sm rounded-full border transition-colors",u.includes(t.name)?"bg-emerald-500 text-white border-emerald-500":"bg-slate-800 hover:bg-slate-700 border-slate-700 text-slate-300"),children:[t.name," (",t.count,")"]},t.name))}),u.length>0&&e.jsxs("p",{className:"text-xs text-slate-400",children:["Showing ",I.length," of ",d.length," stores"]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:e.jsx(Ze,{mode:"wait",children:N?e.jsx(T.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"flex items-center justify-center py-12",children:e.jsx(ye,{size:"md"})},"loading"):I.length>0?e.jsx(T.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"space-y-2",children:I.map((t,a)=>{const r=G[t.retailer_key],v=Q[t.retailer_key],k=te[t.retailer_key];return e.jsxs(T.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:a*.05},className:"group bg-slate-800/60 hover:bg-slate-800 border border-slate-700 hover:border-emerald-500/50 rounded-lg transition-all overflow-hidden",children:[e.jsx("div",{className:"p-4 cursor-pointer",onClick:()=>me(t),children:e.jsxs("div",{className:"flex items-center gap-3",children:[t.retailer_logo_url?e.jsx("div",{className:"w-12 h-12 rounded-lg bg-white flex items-center justify-center p-1.5 flex-shrink-0",children:e.jsx("img",{src:t.retailer_logo_url,alt:t.name,className:"w-full h-full object-contain"})}):e.jsx("div",{className:"w-12 h-12 rounded-lg bg-slate-700 flex items-center justify-center flex-shrink-0",children:e.jsx(de,{className:"text-slate-400",size:24})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold text-white group-hover:text-emerald-400 transition-colors truncate",children:t.name}),t.distance!==null&&t.distance!==void 0&&e.jsxs("span",{className:"text-xs font-medium text-emerald-400 bg-emerald-500/10 px-2 py-0.5 rounded-full flex-shrink-0",children:[t.distance," mi"]})]}),t.banner_name&&t.banner_name!==t.name&&e.jsx("p",{className:"text-xs text-emerald-400/70 mt-0.5",children:t.banner_name}),t.location&&e.jsx("p",{className:"text-sm text-slate-400 mt-1 truncate",children:[t.location.address,t.location.city,t.location.state,t.location.zip_code].filter(Boolean).join(", ")}),t.store_number&&e.jsxs("p",{className:"text-xs text-slate-500 mt-0.5",children:["Store #",t.store_number]}),v?e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-slate-400",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-emerald-400 border-t-transparent rounded-full animate-spin"}),"Loading hours..."]}):r!=null&&r.available?e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:ge("w-2 h-2 rounded-full",r.isOpen?"bg-green-500":"bg-red-500")}),e.jsx("span",{className:ge("text-sm font-medium",r.isOpen?"text-green-400":"text-red-400"),children:r.currentStatus}),r.todayHours&&e.jsxs("span",{className:"text-xs text-slate-400",children:["Â· ",r.todayHours]})]})}):(r==null?void 0:r.available)===!1?e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:r.message||"Hours unavailable"}):null]}),e.jsx("div",{className:"flex-shrink-0",children:n?e.jsx(ye,{size:"sm",speed:"fast",showCore:!1}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-500/10 group-hover:bg-emerald-500/20 flex items-center justify-center transition-colors",children:e.jsx(de,{className:"text-emerald-400",size:18})})})]})}),(r==null?void 0:r.available)&&r.hours&&e.jsxs("div",{className:"border-t border-slate-700/50",children:[e.jsxs("button",{onClick:y=>{y.stopPropagation(),he(t.retailer_key)},className:"w-full px-4 py-2 text-xs text-slate-400 hover:text-white flex items-center justify-center gap-1",children:[k?"Hide":"View"," full hours",e.jsx(T.svg,{animate:{rotate:k?180:0},className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),k&&e.jsx(T.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"px-4 pb-4 space-y-1 bg-slate-800/30",children:Object.entries(r.hours).map(([y,S])=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"capitalize font-medium text-slate-300",children:y}),e.jsx("span",{className:"text-slate-400",children:S})]},y))})]})]},t.retailer_key)})},"retailers"):d.length>0?e.jsxs(T.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-center py-12 text-slate-400",children:[e.jsx(de,{className:"mx-auto mb-3 opacity-50",size:48}),e.jsx("p",{children:"No stores match the selected filters."})]},"filtered-empty"):c.length===5?e.jsxs(T.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-center py-12 text-slate-400",children:[e.jsx(de,{className:"mx-auto mb-3 opacity-50",size:48}),e.jsx("p",{children:"No stores found. Try a different zip code."})]},"empty"):null})})]})]})})},z=({icon:l,title:i,description:g,onClick:p,badge:c,iconColor:f="text-secondary"})=>e.jsxs("button",{onClick:p,className:"w-full px-4 py-4 flex items-center gap-4 hover:bg-secondary/5 transition-colors text-left",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-secondary/10 flex items-center justify-center",children:e.jsx(l,{className:ge("w-5 h-5",f),strokeWidth:1.5})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-base font-medium text-secondary truncate",children:i}),c&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium text-primary bg-primary/10 rounded-full",children:c})]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:g})]}),e.jsx(us,{className:"w-5 h-5 text-muted-foreground/50 flex-shrink-0",strokeWidth:1.5})]}),we=({icon:l,label:i,value:g,onClick:p})=>e.jsxs(T.button,{onClick:p,className:"glass-card rounded-2xl p-6 flex flex-col items-center justify-center gap-3 hover:bg-secondary/5 transition-colors flex-1",variants:xs,whileTap:"tap",children:[e.jsx(l,{className:"w-8 h-8 text-secondary",strokeWidth:1.5}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-secondary",children:i}),g&&e.jsx("p",{className:"text-lg font-semibold text-primary mt-1",children:g})]})]}),Ws=({open:l,onClose:i,userId:g,currentName:p,currentAge:c,currentWeight:f,currentHeight:d,currentGender:j,currentActivityLevel:N,onSave:b})=>{const{toast:n}=q(),[o,h]=s.useState(p),[w,u]=s.useState((c==null?void 0:c.toString())||""),[x,m]=s.useState((f==null?void 0:f.toString())||""),[D,G]=s.useState((d==null?void 0:d.toString())||""),[U,Q]=s.useState(j||""),[J,te]=s.useState(N||""),[M,V]=s.useState("imperial"),[ae,P]=s.useState(!1),re=a=>a*.453592,ie=a=>a/.453592,ne=a=>a*2.54,le=a=>a/2.54,X=()=>{const a=parseFloat(x),r=parseFloat(D);if(!a||!r||a<=0||r<=0)return null;const v=M==="imperial"?re(a):a,k=M==="imperial"?ne(r)/100:r/100;return v/(k*k)},me=a=>a<18.5?{label:"Underweight",color:"text-accent"}:a<25?{label:"Normal",color:"text-secondary"}:a<30?{label:"Overweight",color:"text-primary"}:{label:"Obese",color:"text-destructive"},I=X(),H=I?me(I):null,he=()=>{const a=M==="imperial"?"metric":"imperial";if(x){const r=parseFloat(x);m(M==="imperial"?re(r).toFixed(1):ie(r).toFixed(1))}if(D){const r=parseFloat(D);G(M==="imperial"?ne(r).toFixed(1):le(r).toFixed(1))}V(a)};s.useEffect(()=>{h(p),u((c==null?void 0:c.toString())||""),m((f==null?void 0:f.toString())||""),G((d==null?void 0:d.toString())||""),Q(j||""),te(N||""),V("imperial")},[p,c,f,d,j,N]);const t=async()=>{if(!o.trim()){n({title:"Error",description:"Name is required",variant:"destructive"});return}if(w&&(parseInt(w)<0||parseInt(w)>120)){n({title:"Error",description:"Age must be between 0 and 120",variant:"destructive"});return}if(x&&parseFloat(x)<0){n({title:"Error",description:"Weight must be a positive number",variant:"destructive"});return}if(D&&parseFloat(D)<0){n({title:"Error",description:"Height must be a positive number",variant:"destructive"});return}P(!0);try{let a=x?parseFloat(x):null,r=D?parseFloat(D):null;M==="metric"&&(a&&(a=ie(a)),r&&(r=le(r)));const{error:v}=await C.from("profiles").update({user_name:o,user_age:w?parseInt(w):null,user_weight:a,user_height:r,user_gender:U||null,user_activity_level:J||null}).eq("id",g);if(v)throw v;n({title:"Profile Updated",description:"Your profile has been saved successfully"}),b(),i()}catch(a){console.error("Error saving profile:",a),n({title:"Error",description:"Failed to save profile. Please try again.",variant:"destructive"})}finally{P(!1)}};return e.jsx(Y,{open:l,onOpenChange:i,children:e.jsxs(K,{side:"bottom",className:"h-[80vh]",children:[e.jsxs(W,{className:"flex flex-row items-center justify-between border-b border-secondary/10 pb-4",children:[e.jsx(Z,{className:"text-xl font-semibold text-secondary",children:"Edit Profile"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:he,className:"text-xs",children:[e.jsx($s,{className:"w-3 h-3 mr-1"}),M==="imperial"?"Imperial":"Metric"]}),e.jsx(F,{variant:"ghost",size:"icon",onClick:i,children:e.jsx(se,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"mt-6 space-y-6 overflow-y-auto h-[calc(80vh-140px)] pb-4",children:[I&&e.jsx("div",{className:"glass-card p-4 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Body Mass Index"}),e.jsx("p",{className:"text-2xl font-semibold text-secondary",children:I.toFixed(1)})]}),e.jsx(ps,{variant:"outline",className:ge("text-sm",H==null?void 0:H.color),children:H==null?void 0:H.label})]})}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"userName",className:"text-foreground",children:"Full Name"}),e.jsx(L,{id:"userName",value:o,onChange:a=>h(a.target.value),className:"mt-2",placeholder:"Enter your name"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"age",className:"text-foreground",children:"Age"}),e.jsx(L,{id:"age",type:"number",value:w,onChange:a=>u(a.target.value),className:"mt-2",placeholder:"Age",min:"0",max:"120"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"gender",className:"text-foreground",children:"Gender"}),e.jsxs(Te,{value:U,onValueChange:Q,children:[e.jsx(Le,{className:"mt-2",children:e.jsx(Oe,{placeholder:"Select gender"})}),e.jsxs(Ge,{children:[e.jsx(B,{value:"male",children:"Male"}),e.jsx(B,{value:"female",children:"Female"}),e.jsx(B,{value:"other",children:"Other"}),e.jsx(B,{value:"prefer_not_to_say",children:"Prefer not to say"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(A,{htmlFor:"weight",className:"text-foreground",children:["Weight (",M==="imperial"?"lbs":"kg",")"]}),e.jsx(L,{id:"weight",type:"number",value:x,onChange:a=>m(a.target.value),className:"mt-2",placeholder:M==="imperial"?"Weight in lbs":"Weight in kg",min:"0",step:"0.1"})]}),e.jsxs("div",{children:[e.jsxs(A,{htmlFor:"height",className:"text-foreground",children:["Height (",M==="imperial"?"inches":"cm",")"]}),e.jsx(L,{id:"height",type:"number",value:D,onChange:a=>G(a.target.value),className:"mt-2",placeholder:M==="imperial"?"Height in inches":"Height in cm",min:"0",step:"0.1"})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"activityLevel",className:"text-foreground",children:"Activity Level"}),e.jsxs(Te,{value:J,onValueChange:te,children:[e.jsx(Le,{className:"mt-2",children:e.jsx(Oe,{placeholder:"Select activity level"})}),e.jsxs(Ge,{children:[e.jsx(B,{value:"sedentary",children:"Sedentary (little or no exercise)"}),e.jsx(B,{value:"lightly_active",children:"Lightly Active (1-3 days/week)"}),e.jsx(B,{value:"moderately_active",children:"Moderately Active (3-5 days/week)"}),e.jsx(B,{value:"very_active",children:"Very Active (6-7 days/week)"}),e.jsx(B,{value:"extremely_active",children:"Extremely Active (athlete)"})]})]})]}),e.jsx(F,{onClick:t,disabled:ae,className:"w-full",children:ae?"Saving...":"Save Changes"})]})]})})},Zs=({open:l,onClose:i,userId:g,currentDietaryValues:p,currentAllergies:c,onSave:f})=>{const{toast:d}=q(),[j,N]=s.useState(p),[b,n]=s.useState(c),[o,h]=s.useState(!1);s.useEffect(()=>{N(p),n(c)},[p,c]);const w=async()=>{h(!0);try{const{error:u}=await C.from("profiles").update({dietary_preferences:j.split(",").map(x=>x.trim()).filter(x=>x.length>0),allergies:b.split(",").map(x=>x.trim()).filter(x=>x.length>0)}).eq("id",g);if(u)throw u;d({title:"Dietary Preferences Updated",description:"Your preferences have been saved successfully"}),f(),i()}catch(u){console.error("Error saving dietary preferences:",u),d({title:"Error",description:"Failed to save preferences. Please try again.",variant:"destructive"})}finally{h(!1)}};return e.jsx(Y,{open:l,onOpenChange:i,children:e.jsxs(K,{side:"bottom",className:"h-[70vh]",children:[e.jsxs(W,{className:"flex flex-row items-center justify-between border-b border-secondary/10 pb-4",children:[e.jsx(Z,{className:"text-xl font-semibold text-secondary",children:"Dietary Preferences"}),e.jsx(F,{variant:"ghost",size:"icon",onClick:i,children:e.jsx(se,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"dietaryValues",className:"text-foreground",children:"Dietary Values"}),e.jsx(L,{id:"dietaryValues",value:j,onChange:u=>N(u.target.value),className:"mt-2",placeholder:"e.g., Vegan, Halal, Kosher (comma-separated)"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"allergies",className:"text-foreground",children:"Food Allergies"}),e.jsx(L,{id:"allergies",value:b,onChange:u=>n(u.target.value),className:"mt-2",placeholder:"e.g., Nuts, Gluten, Dairy (comma-separated)"})]}),e.jsx(F,{onClick:w,disabled:o,className:"w-full",children:o?"Saving...":"Save Changes"})]})]})})},Qs=({open:l,onClose:i,userId:g,currentSkinType:p,currentHairType:c,onSave:f})=>{const{toast:d}=q(),[j,N]=s.useState(p),[b,n]=s.useState(c),[o,h]=s.useState(!1);s.useEffect(()=>{N(p),n(c)},[p,c]);const w=async()=>{h(!0);try{const{error:u}=await C.from("profiles").update({beauty_profile:{skinType:j||null,hairType:b||null}}).eq("id",g);if(u)throw u;d({title:"Beauty Profile Updated",description:"Your preferences have been saved successfully"}),f(),i()}catch(u){console.error("Error saving beauty profile:",u),d({title:"Error",description:"Failed to save profile. Please try again.",variant:"destructive"})}finally{h(!1)}};return e.jsx(Y,{open:l,onOpenChange:i,children:e.jsxs(K,{side:"bottom",className:"h-[70vh]",children:[e.jsxs(W,{className:"flex flex-row items-center justify-between border-b border-secondary/10 pb-4",children:[e.jsx(Z,{className:"text-xl font-semibold text-secondary",children:"Beauty Profile"}),e.jsx(F,{variant:"ghost",size:"icon",onClick:i,children:e.jsx(se,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"skinType",className:"text-foreground",children:"Skin Type"}),e.jsx(L,{id:"skinType",value:j,onChange:u=>N(u.target.value),className:"mt-2",placeholder:"e.g., Dry, Oily, Combination, Sensitive"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"hairType",className:"text-foreground",children:"Hair Type"}),e.jsx(L,{id:"hairType",value:b,onChange:u=>n(u.target.value),className:"mt-2",placeholder:"e.g., Straight, Wavy, Curly, Coily"})]}),e.jsx(F,{onClick:w,disabled:o,className:"w-full",children:o?"Saving...":"Save Changes"})]})]})})},Js=({open:l,onClose:i,userId:g,currentHealthGoals:p,currentLifestyleGoals:c,onSave:f})=>{const{toast:d}=q(),[j,N]=s.useState(p),[b,n]=s.useState(c),[o,h]=s.useState(!1);s.useEffect(()=>{N(p),n(c)},[p,c]);const w=async()=>{h(!0);try{const{error:u}=await C.from("profiles").update({health_goals:j.split(",").map(x=>x.trim()).filter(x=>x.length>0),lifestyle_goals:b.split(",").map(x=>x.trim()).filter(x=>x.length>0)}).eq("id",g);if(u)throw u;d({title:"Goals Updated",description:"Your goals have been saved successfully"}),f(),i()}catch(u){console.error("Error saving goals:",u),d({title:"Error",description:"Failed to save goals. Please try again.",variant:"destructive"})}finally{h(!1)}};return e.jsx(Y,{open:l,onOpenChange:i,children:e.jsxs(K,{side:"bottom",className:"h-[70vh]",children:[e.jsxs(W,{className:"flex flex-row items-center justify-between border-b border-secondary/10 pb-4",children:[e.jsx(Z,{className:"text-xl font-semibold text-secondary",children:"Health & Lifestyle Goals"}),e.jsx(F,{variant:"ghost",size:"icon",onClick:i,children:e.jsx(se,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"healthGoals",className:"text-foreground",children:"Health Goals"}),e.jsx(L,{id:"healthGoals",value:j,onChange:u=>N(u.target.value),className:"mt-2",placeholder:"e.g., Lose weight, Build muscle, Improve sleep (comma-separated)"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"lifestyleGoals",className:"text-foreground",children:"Lifestyle Goals"}),e.jsx(L,{id:"lifestyleGoals",value:b,onChange:u=>n(u.target.value),className:"mt-2",placeholder:"e.g., Reduce stress, Eat healthier, Exercise more (comma-separated)"})]}),e.jsx(F,{onClick:w,disabled:o,className:"w-full",children:o?"Saving...":"Save Changes"})]})]})})};function Xs(l){let i;return l.gender==="male"?i=10*l.weight+6.25*l.height-5*l.age+5:i=10*l.weight+6.25*l.height-5*l.age-161,Math.round(i*{sedentary:1.2,light:1.375,moderate:1.55,active:1.725,very_active:1.9}[l.activityLevel])}function et(l){const i=Xs(l);return{calories:i,protein:Math.round(l.weight*2),carbs:Math.round(i*.45/4),fat:Math.round(i*.3/9),fiber:l.gender==="male"?38:25}}const st=({open:l,onOpenChange:i,currentGoals:g,userId:p})=>{const[c,f]=s.useState(g.daily_calorie_goal),[d,j]=s.useState(g.daily_protein_goal),[N,b]=s.useState(g.daily_carbs_goal),[n,o]=s.useState(g.daily_fat_goal),[h,w]=s.useState(!1);s.useEffect(()=>{f(g.daily_calorie_goal),j(g.daily_protein_goal),b(g.daily_carbs_goal),o(g.daily_fat_goal)},[g]);const u=async()=>{try{const{data:m}=await C.from("profiles").select("user_age, user_weight, user_height, user_gender, user_activity_level").eq("id",p).single();if(!m||!m.user_age||!m.user_weight||!m.user_height){ue.error("Please complete your profile biometrics first");return}const D=et({age:m.user_age,weight:m.user_weight,height:m.user_height,gender:m.user_gender,activityLevel:m.user_activity_level||"moderate"});f(D.calories),j(D.protein),b(D.carbs),o(D.fat),ue.success("Goals calculated based on your profile")}catch(m){console.error("Auto-calculate error:",m),ue.error("Failed to calculate goals")}},x=async()=>{w(!0);try{const{error:m}=await C.from("profiles").update({daily_calorie_goal:c,daily_protein_goal:d,daily_carbs_goal:N,daily_fat_goal:n}).eq("id",p);if(m)throw m;ue.success("Nutrition goals updated"),i(!1)}catch(m){console.error("Error updating goals:",m),ue.error("Failed to update goals")}finally{w(!1)}};return e.jsx(Y,{open:l,onOpenChange:i,children:e.jsxs(K,{side:"bottom",className:"h-[85vh] overflow-y-auto",children:[e.jsx(W,{children:e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(Ys,{className:"w-5 h-5 text-primary"}),"Nutrition Goals"]})}),e.jsxs("div",{className:"space-y-6 mt-6",children:[e.jsxs(F,{onClick:u,variant:"outline",className:"w-full",children:[e.jsx(Se,{size:18,className:"mr-2"}),"Auto-calculate based on profile"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(be,{value:d,max:d,label:"Protein",color:"hsl(var(--secondary))",size:"sm",unit:"g"}),e.jsx(be,{value:N,max:N,label:"Carbs",color:"hsl(var(--accent))",size:"sm",unit:"g"}),e.jsx(be,{value:n,max:n,label:"Fat",color:"hsl(var(--primary))",size:"sm",unit:"g"})]}),e.jsxs("div",{className:"glass-card p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bs,{className:"w-5 h-5 text-destructive"}),e.jsx(A,{htmlFor:"calories",className:"text-base",children:"Daily Calorie Target"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{id:"calories",type:"number",value:c,onChange:m=>f(Number(m.target.value)),className:"flex-1"}),e.jsx("span",{className:"text-muted-foreground",children:"kcal"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your daily calorie intake target"})]}),e.jsxs("div",{className:"glass-card p-4 space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Macro Targets"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Us,{className:"w-4 h-4 text-secondary"}),e.jsx(A,{htmlFor:"protein",className:"text-sm",children:"Protein"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{id:"protein",type:"number",value:d,onChange:m=>j(Number(m.target.value)),className:"flex-1"}),e.jsx("span",{className:"text-muted-foreground text-sm",children:"g"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(As,{className:"w-4 h-4 text-accent"}),e.jsx(A,{htmlFor:"carbs",className:"text-sm",children:"Carbohydrates"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{id:"carbs",type:"number",value:N,onChange:m=>b(Number(m.target.value)),className:"flex-1"}),e.jsx("span",{className:"text-muted-foreground text-sm",children:"g"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ds,{className:"w-4 h-4 text-primary"}),e.jsx(A,{htmlFor:"fat",className:"text-sm",children:"Fat"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{id:"fat",type:"number",value:n,onChange:m=>o(Number(m.target.value)),className:"flex-1"}),e.jsx("span",{className:"text-muted-foreground text-sm",children:"g"})]})]})]}),e.jsx("div",{className:"glass-card p-4 bg-accent/10",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Tip:"})," A balanced diet typically consists of 30% protein, 40% carbs, and 30% fat. Adjust based on your specific health goals."]})}),e.jsx(F,{onClick:x,disabled:h,className:"w-full h-12",children:h?"Saving...":"Save Goals"})]})]})})},tt=({open:l,onClose:i,userEmail:g})=>{const{toast:p}=q(),c=He(),[f,d]=s.useState(!1),[j,N]=s.useState(!1),b=async()=>{try{await C.auth.signOut(),p({title:"Signed Out",description:"You have been signed out successfully"}),c("/auth")}catch(o){console.error("Error signing out:",o),p({title:"Error",description:"Failed to sign out. Please try again.",variant:"destructive"})}},n=async()=>{N(!0);try{const{data:{session:o}}=await C.auth.getSession();if(!o)throw new Error("No active session");const{error:h}=await C.functions.invoke("delete-account",{headers:{Authorization:`Bearer ${o.access_token}`}});if(h)throw h;p({title:"Account Deleted",description:"Your account and all associated data have been permanently deleted."}),await C.auth.signOut(),c("/auth")}catch(o){console.error("Error deleting account:",o),p({title:"Error",description:o instanceof Error?o.message:"Failed to delete account. Please try again.",variant:"destructive"})}finally{N(!1),d(!1)}};return e.jsxs(Y,{open:l,onOpenChange:i,children:[e.jsxs(K,{side:"bottom",className:"h-[70vh]",children:[e.jsxs(W,{className:"flex flex-row items-center justify-between border-b border-secondary/10 pb-4",children:[e.jsx(Z,{className:"text-xl font-semibold text-secondary",children:"Account & Security"}),e.jsx(F,{variant:"ghost",size:"icon",onClick:i,children:e.jsx(se,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx(A,{className:"text-foreground",children:"Email Address"}),e.jsx("div",{className:"mt-2 glass-card p-4 rounded-xl",children:e.jsx("p",{className:"text-muted-foreground",children:g})})]}),e.jsxs("div",{className:"pt-4 space-y-3 border-t border-secondary/10",children:[e.jsxs(F,{onClick:b,variant:"destructive",className:"w-full",children:[e.jsx(Vs,{className:"w-4 h-4 mr-2"}),"Sign Out"]}),e.jsxs(F,{variant:"destructive",className:"w-full",onClick:()=>d(!0),children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Delete Account"]})]})]})]}),e.jsx(Be,{open:f,onOpenChange:d,children:e.jsxs(qe,{className:"bg-background border border-destructive/20",children:[e.jsxs(Ve,{children:[e.jsxs(Re,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(gs,{className:"w-5 h-5"}),"Delete Account Permanently?"]}),e.jsxs($e,{className:"space-y-3 pt-2",children:[e.jsxs("p",{children:["This action ",e.jsx("span",{className:"font-semibold text-destructive",children:"cannot be undone"}),". All your data will be permanently deleted:"]}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground",children:[e.jsx("li",{children:"Profile and account information"}),e.jsx("li",{children:"All inventory, recipes, and meal logs"}),e.jsx("li",{children:"Household memberships and activity"}),e.jsx("li",{children:"Conversation history and preferences"}),e.jsx("li",{children:"Saved foods and templates"})]}),e.jsx("p",{className:"text-sm font-medium text-foreground pt-2",children:"Are you absolutely sure you want to delete your account?"})]})]}),e.jsxs(Ye,{children:[e.jsx(Ke,{disabled:j,children:"Cancel"}),e.jsx(We,{onClick:n,disabled:j,className:"bg-destructive hover:bg-destructive/90",children:j?"Deleting...":"Yes, Delete My Account"})]})]})})]})},at=()=>{const{toast:l}=q(),[i,g]=s.useState([]),[p,c]=s.useState(!0),[f,d]=s.useState(null),j=async()=>{c(!0);try{const{data:{session:n}}=await C.auth.getSession();if(!(n!=null&&n.user))return;const{data:o,error:h}=await C.from("conversation_history").select("*").eq("user_id",n.user.id).order("created_at",{ascending:!1});if(h)throw h;const w=(o||[]).reduce((x,m)=>(x[m.conversation_id]||(x[m.conversation_id]=[]),x[m.conversation_id].push(m),x),{}),u=Object.entries(w).map(([x,m])=>{var D;return{conversation_id:x,messages:m.sort((G,U)=>new Date(G.created_at).getTime()-new Date(U.created_at).getTime()),first_message_time:((D=m[0])==null?void 0:D.created_at)||new Date().toISOString()}}).sort((x,m)=>new Date(m.first_message_time).getTime()-new Date(x.first_message_time).getTime());g(u)}catch(n){console.error("Error fetching conversations:",n),l({title:"Error",description:"Failed to load conversation history",variant:"destructive"})}finally{c(!1)}},N=async n=>{try{const{data:{session:o}}=await C.auth.getSession();if(!(o!=null&&o.user))return;const{error:h}=await C.from("conversation_history").delete().eq("user_id",o.user.id).eq("conversation_id",n);if(h)throw h;l({title:"Deleted",description:"Conversation deleted successfully"}),j()}catch(o){console.error("Error deleting conversation:",o),l({title:"Error",description:"Failed to delete conversation",variant:"destructive"})}},b=n=>{const o=new Date(n),w=(new Date().getTime()-o.getTime())/(1e3*60*60);return w<24?o.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):w<168?o.toLocaleDateString("en-US",{weekday:"short",hour:"2-digit",minute:"2-digit"}):o.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})};return s.useEffect(()=>{j()},[]),p?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(T.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-8 h-8 border-2 border-secondary border-t-transparent rounded-full"})}):i.length===0?e.jsxs(ze,{className:"p-8 text-center bg-background/50 border-secondary/20",children:[e.jsx(_e,{className:"w-12 h-12 mx-auto mb-4 text-secondary/40"}),e.jsx("p",{className:"text-muted-foreground",children:"No conversation history yet"}),e.jsx("p",{className:"text-sm text-muted-foreground/70 mt-2",children:"Start a conversation with Kaeva to see your history here"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-secondary flex items-center gap-2",children:[e.jsx(_e,{className:"w-5 h-5"}),"Conversation History"]}),e.jsx(fs,{className:"h-[600px] pr-4",children:e.jsx("div",{className:"space-y-3",children:i.map(n=>{var o;return e.jsxs(ze,{className:"bg-background/50 border-secondary/20 overflow-hidden",children:[e.jsxs("div",{className:"p-4 cursor-pointer hover:bg-secondary/5 transition-colors",onClick:()=>d(f===n.conversation_id?null:n.conversation_id),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ys,{className:"w-4 h-4 text-secondary/60"}),e.jsx("span",{className:"text-sm text-muted-foreground/70",children:b(n.first_message_time)}),e.jsxs("span",{className:"text-xs text-muted-foreground/50",children:[n.messages.length," messages"]})]}),e.jsxs(Be,{children:[e.jsx(vs,{asChild:!0,onClick:h=>h.stopPropagation(),children:e.jsx(F,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:e.jsx(Ue,{className:"w-4 h-4"})})}),e.jsxs(qe,{className:"bg-background border-secondary/30",children:[e.jsxs(Ve,{children:[e.jsx(Re,{className:"text-secondary",children:"Delete Conversation"}),e.jsx($e,{className:"text-muted-foreground",children:"Are you sure you want to delete this conversation? This action cannot be undone."})]}),e.jsxs(Ye,{children:[e.jsx(Ke,{className:"bg-secondary/10 border-secondary/30 text-secondary hover:bg-secondary/20",children:"Cancel"}),e.jsx(We,{onClick:()=>N(n.conversation_id),className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})]}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground line-clamp-1",children:((o=n.messages[0])==null?void 0:o.message)||""})]}),e.jsx(Ze,{children:f===n.conversation_id&&e.jsx(T.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"border-t border-secondary/20",children:e.jsx("div",{className:"p-4 space-y-3 max-h-96 overflow-y-auto",children:n.messages.map(h=>e.jsx("div",{className:`flex gap-3 ${h.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex gap-2 max-w-[80%] ${h.role==="user"?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${h.role==="user"?"bg-secondary/20":"bg-accent/20"}`,children:h.role==="user"?e.jsx(ke,{className:"w-4 h-4 text-secondary"}):e.jsx(Ps,{className:"w-4 h-4 text-accent"})}),e.jsxs("div",{className:`rounded-lg px-4 py-2 ${h.role==="user"?"bg-secondary/10 border border-secondary/20":"bg-accent/10 border border-accent/20"}`,children:[e.jsx("p",{className:"text-sm text-foreground/90",children:h.message}),e.jsx("p",{className:"text-xs text-muted-foreground/50 mt-1",children:new Date(h.created_at).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})]})]})},h.id))})})})]},n.conversation_id)})})})]})},rt=({open:l,onClose:i})=>e.jsx(Y,{open:l,onOpenChange:i,children:e.jsxs(K,{side:"bottom",className:"h-[80vh]",children:[e.jsxs(W,{className:"flex flex-row items-center justify-between border-b border-secondary/10 pb-4",children:[e.jsx(Z,{className:"text-xl font-semibold text-secondary",children:"Conversation History"}),e.jsx(F,{variant:"ghost",size:"icon",onClick:i,children:e.jsx(se,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"mt-6 overflow-y-auto h-[calc(80vh-100px)]",children:e.jsx(at,{})})]})}),it=({open:l,onClose:i,userId:g})=>{const{toast:p}=q(),[c,f]=s.useState({spoilage_alerts:!0,low_stock_alerts:!0,recipe_suggestions:!0,household_activity:!0,delivery_only:!1}),[d,j]=s.useState(!1);s.useEffect(()=>{l&&g&&N()},[l,g]);const N=async()=>{const{data:n,error:o}=await C.from("profiles").select("notification_preferences").eq("id",g).single();!o&&(n!=null&&n.notification_preferences)&&f(n.notification_preferences)},b=async n=>{const o={...c,[n]:!c[n]};f(o),j(!0);const{error:h}=await C.from("profiles").update({notification_preferences:o}).eq("id",g);j(!1),h?(p({title:"Error",description:"Failed to update notification settings",variant:"destructive"}),f(c)):p({title:"Settings Updated",description:"Your notification preferences have been saved"})};return e.jsx(Y,{open:l,onOpenChange:i,children:e.jsxs(K,{side:"bottom",className:"h-[80vh]",children:[e.jsxs(W,{className:"flex flex-row items-center justify-between border-b border-border/10 pb-4",children:[e.jsx(Z,{className:"text-xl font-semibold text-foreground",children:"Notifications"}),e.jsx(F,{variant:"ghost",size:"icon",onClick:i,children:e.jsx(se,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"mt-6 space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between glass-card p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(A,{className:"text-foreground font-medium",children:"Spoilage Alerts"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified when items are about to expire"})]}),e.jsx(pe,{checked:c.spoilage_alerts,onCheckedChange:()=>b("spoilage_alerts"),disabled:d})]}),e.jsxs("div",{className:"flex items-center justify-between glass-card p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(A,{className:"text-foreground font-medium",children:"Low Stock Alerts"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified when inventory is running low"})]}),e.jsx(pe,{checked:c.low_stock_alerts,onCheckedChange:()=>b("low_stock_alerts"),disabled:d})]}),e.jsxs("div",{className:"flex items-center justify-between glass-card p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(A,{className:"text-foreground font-medium",children:"Recipe Suggestions"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Get suggestions for meals based on your inventory"})]}),e.jsx(pe,{checked:c.recipe_suggestions,onCheckedChange:()=>b("recipe_suggestions"),disabled:d})]}),e.jsxs("div",{className:"flex items-center justify-between glass-card p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(A,{className:"text-foreground font-medium",children:"Household Activity"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified when household members make changes"})]}),e.jsx(pe,{checked:c.household_activity,onCheckedChange:()=>b("household_activity"),disabled:d})]}),e.jsxs("div",{className:"flex items-center justify-between glass-card p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(A,{className:"text-foreground font-medium",children:"In-App Only"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Disable push notifications, show alerts only in-app"})]}),e.jsx(pe,{checked:c.delivery_only,onCheckedChange:()=>b("delivery_only"),disabled:d})]})]})})]})})},nt=async()=>{try{const{data:{session:l}}=await C.auth.getSession();if(!l)return!1;const{data:i}=await C.functions.invoke("check-admin",{headers:{Authorization:`Bearer ${l.access_token}`}});return(i==null?void 0:i.isAdmin)||!1}catch(l){return console.error("Admin check error:",l),!1}},Mt=()=>{q();const l=He(),[i,g]=s.useState(""),[p,c]=s.useState(""),[f,d]=s.useState(""),[j,N]=s.useState(null),[b,n]=s.useState(null),[o,h]=s.useState(null),[w,u]=s.useState(""),[x,m]=s.useState(""),[D,G]=s.useState(2e3),[U,Q]=s.useState(150),[J,te]=s.useState(200),[M,V]=s.useState(65),[ae,P]=s.useState(""),[re,ie]=s.useState(""),[ne,le]=s.useState(""),[X,me]=s.useState(""),[I,H]=s.useState(""),[he,t]=s.useState(""),[a,r]=s.useState(null),[v,k]=s.useState(!1),[y,S]=s.useState(!1),[O,oe]=s.useState(!1),[fe,ce]=s.useState(!1),[je,Ce]=s.useState(!1),[Qe,Ae]=s.useState(!1),[Je,De]=s.useState(!1),[Xe,Ee]=s.useState(!1),[es,ss]=s.useState(!1),[ts,as]=s.useState(!1),{isModuleComplete:rs,completionPercentage:Fe}=Gs(),[Ne,Pe]=s.useState(null),Me=Ls();s.useEffect(()=>{ee(),is()},[]);const is=async()=>{const E=await nt();as(E)},ee=async()=>{try{const{data:{session:E}}=await C.auth.getSession();if(!(E!=null&&E.user))return;g(E.user.id),c(E.user.email||"");const{data:_}=await C.from("profiles").select("*").eq("id",E.user.id).single();if(_){d(_.user_name||""),N(_.user_age||null),n(_.user_weight||null),h(_.user_height||null),u(_.user_gender||""),m(_.user_activity_level||""),P(Array.isArray(_.dietary_preferences)?_.dietary_preferences.join(", "):""),ie(Array.isArray(_.allergies)?_.allergies.join(", "):"");const R=_.beauty_profile;le((R==null?void 0:R.skinType)||""),me((R==null?void 0:R.hairType)||""),H(Array.isArray(_.health_goals)?_.health_goals.join(", "):""),t(Array.isArray(_.lifestyle_goals)?_.lifestyle_goals.join(", "):""),G(_.daily_calorie_goal||2e3),Q(_.daily_protein_goal||150),te(_.daily_carbs_goal||200),V(_.daily_fat_goal||65),r(_.preferred_retailer_id?{retailer_id:_.preferred_retailer_id,name:_.preferred_retailer_name||"Selected Store"}:null)}}catch(E){console.error("Error loading profile:",E),l("/app")}},ns=()=>{const E=new Date().getHours();return E<12?"Good morning":E<17?"Good afternoon":"Good evening"};return e.jsxs(e.Fragment,{children:[e.jsx(ks,{vertical:"food"}),e.jsxs(Cs,{className:"overflow-x-hidden",children:[e.jsx(Ms,{title:"My Account",showHomeButton:!0}),e.jsx(Os,{swipeProgress:Me.progress,swipeDirection:Me.direction,children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6 space-y-6 pb-24",children:[e.jsxs(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:xe,children:[e.jsxs("p",{className:"text-2xl text-muted-foreground",children:[ns(),","]}),e.jsx("p",{className:"text-3xl font-semibold text-secondary",children:f||"User"})]}),e.jsxs(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{...xe,delay:.1},children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Profile Completion"}),e.jsxs("div",{className:"glass-card rounded-3xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("span",{className:"text-lg font-semibold text-foreground",children:[Fe(),"% Complete"]}),e.jsx("div",{className:"h-2 flex-1 ml-4 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-500",style:{width:`${Fe()}%`}})})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{module:"core",label:"Core Profile",icon:ke},{module:"nutrition",label:"Nutrition",icon:ve},{module:"pantry",label:"Pantry",icon:de},{module:"beauty",label:"Beauty",icon:Se},{module:"pets",label:"Pets",icon:ve},{module:"household",label:"Household",icon:Ie}].map(({module:E,label:_,icon:R})=>{const ls=rs(E);return e.jsxs("button",{onClick:()=>Pe({module:E,open:!0}),className:"flex items-center gap-3 p-3 rounded-2xl bg-background/50 border border-border/50 hover:border-primary/50 transition-all",children:[ls?e.jsx(Fs,{className:"w-5 h-5 text-secondary"}):e.jsx(js,{className:"w-5 h-5 text-muted-foreground"}),e.jsx(R,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-foreground",children:_})]},E)})})]})]}),e.jsxs(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{...xe,delay:.15},className:"grid grid-cols-3 gap-3",children:[e.jsx(we,{icon:ke,label:"My Profile",onClick:()=>k(!0)}),e.jsx(we,{icon:Ie,label:"Household",onClick:()=>l("/household")}),e.jsx(we,{icon:Is,label:"Analytics",onClick:()=>l("/analytics")})]}),e.jsxs(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{...xe,delay:.2},className:"glass-card rounded-3xl overflow-hidden divide-y divide-secondary/10",children:[e.jsx(z,{icon:Es,title:"Dietary Preferences",description:"Food values and allergies",onClick:()=>S(!0)}),e.jsx(z,{icon:ve,title:"Nutrition Goals",description:"Daily calorie and macro targets",onClick:()=>Ce(!0)}),e.jsx(z,{icon:Se,title:"Beauty Profile",description:"Skin and hair preferences",onClick:()=>oe(!0)}),e.jsx(z,{icon:ve,title:"Health & Lifestyle Goals",description:"Your wellness objectives",onClick:()=>ce(!0)}),e.jsx(z,{icon:Ns,title:"Inventory",description:"View and manage your items",onClick:()=>l("/inventory")}),e.jsx(z,{icon:bs,title:"Recipe Book",description:"Your saved recipes",onClick:()=>l("/recipes")})]}),e.jsxs(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{...xe,delay:.3},className:"glass-card rounded-3xl overflow-hidden divide-y divide-secondary/10",children:[e.jsx(z,{icon:_e,title:"Conversation History",description:"Past conversations with KAEVA",onClick:()=>De(!0)}),e.jsx(z,{icon:Hs,title:"Notification Settings",description:"Manage alerts and preferences",onClick:()=>Ee(!0)}),e.jsx(z,{icon:ws,title:"Install App",description:"Add KAEVA to your home screen",onClick:()=>l("/install")}),e.jsx(z,{icon:Ss,title:"Account & Security",description:"Password, email, sign out",onClick:()=>Ae(!0)}),ts&&e.jsx(z,{icon:_s,title:"Admin Dashboard",description:"System management & monitoring",onClick:()=>l("/admin"),iconColor:"text-primary"})]}),e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"KAEVA v1.0.0"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Your home, on autopilot"})]})]})}),Ne&&e.jsx(zs,{open:Ne.open,module:Ne.module,onClose:()=>Pe(null),onComplete:()=>{ee()}}),e.jsx(Ws,{open:v,onClose:()=>k(!1),userId:i,currentName:f,currentAge:j,currentWeight:b,currentHeight:o,currentGender:w,currentActivityLevel:x,onSave:ee}),e.jsx(Zs,{open:y,onClose:()=>S(!1),userId:i,currentDietaryValues:ae,currentAllergies:re,onSave:ee}),e.jsx(Qs,{open:O,onClose:()=>oe(!1),userId:i,currentSkinType:ne,currentHairType:X,onSave:ee}),e.jsx(Js,{open:fe,onClose:()=>ce(!1),userId:i,currentHealthGoals:I,currentLifestyleGoals:he,onSave:ee}),e.jsx(tt,{open:Qe,onClose:()=>Ae(!1),userEmail:p}),e.jsx(rt,{open:Je,onClose:()=>De(!1)}),e.jsx(st,{open:je,onOpenChange:Ce,currentGoals:{daily_calorie_goal:D,daily_protein_goal:U,daily_carbs_goal:J,daily_fat_goal:M},userId:i}),e.jsx(it,{open:Xe,onClose:()=>Ee(!1),userId:i}),e.jsx(Ks,{open:es,onClose:()=>ss(!1),userId:i,onStoreSelected:E=>{r({retailer_id:E.retailer_key,name:E.name}),ee()}}),e.jsx(Ts,{})]})]})};export{Mt as default};

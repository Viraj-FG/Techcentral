import{j as t}from"./ui-vendor-CRu_cuPE.js";import{r as c,u as Z}from"./react-vendor-DwZQO67Z.js";import{d as M,a4 as ue,aX as B,I as pe,B as me,X as fe,p as L,ah as q,bb as E,bc as R,b9 as W,M as Y,R as G,af as X,P as C,bd as $,G as J,j as H,F as he,S as ye,l as xe,m as ge,n as be,s as j,D as ve,e as ke,f as we,g as je,O as _e,q as Se,a as Ne}from"./index-D4bhw5kJ.js";import{A as ee,m as _}from"./animation-vendor-C-lCNj7M.js";import{S as De}from"./scan-rfUsMt4r.js";import{T as qe,a as Ce,b as F,c as P}from"./tabs-C9GQepe1.js";import{C as te,B as I,U as Ae}from"./UniversalShell-B176IQVx.js";import{T as z}from"./trending-down-D_vIl22O.js";import{D as ae,L as se}from"./leaf-DXJ1a3o-.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=M("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=M("Cat",[["path",{d:"M12 5c.67 0 1.35.09 2 .26 1.78-2 5.03-2.84 6.42-2.26 1.4.58-.42 7-.42 7 .57 1.07 1 2.24 1 3.44C21 17.9 16.97 21 12 21s-9-3-9-7.56c0-1.25.5-2.4 1-3.44 0 0-1.89-6.42-.5-7 1.39-.58 4.72.23 6.5 2.23A9.04 9.04 0 0 1 12 5Z",key:"x6xyqk"}],["path",{d:"M8 14v.5",key:"1nzgdb"}],["path",{d:"M16 14v.5",key:"1lajdz"}],["path",{d:"M11.25 16.25h1.5L12 17l-.75-.75Z",key:"12kq1m"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=M("Dog",[["path",{d:"M11.25 16.25h1.5L12 17z",key:"w7jh35"}],["path",{d:"M16 14v.5",key:"1lajdz"}],["path",{d:"M4.42 11.247A13.152 13.152 0 0 0 4 14.556C4 18.728 7.582 21 12 21s8-2.272 8-6.444a11.702 11.702 0 0 0-.493-3.309",key:"u7s9ue"}],["path",{d:"M8 14v.5",key:"1nzgdb"}],["path",{d:"M8.5 8.5c-.384 1.05-1.083 2.028-2.344 2.5-1.931.722-3.576-.297-3.656-1-.113-.994 1.177-6.53 4-7 1.923-.321 3.651.845 3.651 2.235A7.497 7.497 0 0 1 14 5.277c0-1.39 1.844-2.598 3.767-2.277 2.823.47 4.113 6.006 4 7-.08.703-1.725 1.722-3.656 1-1.261-.472-1.855-1.45-2.239-2.5",key:"v8hric"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=M("Dumbbell",[["path",{d:"M14.4 14.4 9.6 9.6",key:"ic80wn"}],["path",{d:"M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z",key:"nnl7wr"}],["path",{d:"m21.5 21.5-1.4-1.4",key:"1f1ice"}],["path",{d:"M3.9 3.9 2.5 2.5",key:"1evmna"}],["path",{d:"M6.404 12.768a2 2 0 1 1-2.829-2.829l1.768-1.767a2 2 0 1 1-2.828-2.829l2.828-2.828a2 2 0 1 1 2.829 2.828l1.767-1.768a2 2 0 1 1 2.829 2.829z",key:"yhosts"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=M("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=M("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=M("UtensilsCrossed",[["path",{d:"m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8",key:"n7qcjb"}],["path",{d:"M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7",key:"d0u48b"}],["path",{d:"m2.1 21.8 6.4-6.3",key:"yn04lh"}],["path",{d:"m19 5-7 7",key:"194lzd"}]]),Me=({open:a,onOpenChange:e,onVoiceActivate:s,onScanActivate:r})=>{const f=()=>{e(!1),s()},h=()=>{e(!1),r()};return t.jsx(ee,{children:a&&t.jsxs(t.Fragment,{children:[t.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>e(!1),className:"fixed inset-0 bg-black/40 z-40"}),t.jsx("div",{className:"fixed bottom-[calc(1.5rem+env(safe-area-inset-bottom))] inset-x-0 z-50 flex justify-center pointer-events-none",children:t.jsxs("div",{className:"relative w-full max-w-[320px] h-[72px]",children:[t.jsxs(_.button,{initial:{x:40,opacity:0,scale:.5},animate:{x:0,opacity:1,scale:1},exit:{x:40,opacity:0,scale:.5},transition:{type:"spring",stiffness:400,damping:25,delay:.05},onClick:f,className:"pointer-events-auto absolute left-0 -top-16 group","aria-label":"Start voice conversation with Kaeva",children:[t.jsx("div",{className:"absolute inset-0 rounded-full bg-secondary blur-lg opacity-40 group-hover:opacity-60 transition-opacity"}),t.jsx("div",{className:"relative w-14 h-14 rounded-full bg-secondary/20 border border-secondary/40 backdrop-blur-xl flex items-center justify-center group-hover:bg-secondary/30 group-hover:border-secondary/60 transition-all shadow-lg",children:t.jsx(ue,{size:22,className:"text-secondary"})}),t.jsx(_.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:.15},className:"absolute -top-8 left-1/2 -translate-x-1/2 whitespace-nowrap",children:t.jsx("span",{className:"text-xs font-medium text-secondary bg-background/80 backdrop-blur-sm px-2 py-1 rounded-full border border-secondary/20",children:"Voice"})})]}),t.jsxs(_.button,{initial:{x:-40,opacity:0,scale:.5},animate:{x:0,opacity:1,scale:1},exit:{x:-40,opacity:0,scale:.5},transition:{type:"spring",stiffness:400,damping:25,delay:.1},onClick:h,className:"pointer-events-auto absolute right-0 -top-16 group","aria-label":"Open camera scanner for product analysis",children:[t.jsx("div",{className:"absolute inset-0 rounded-full bg-accent blur-lg opacity-40 group-hover:opacity-60 transition-opacity"}),t.jsx("div",{className:"relative w-14 h-14 rounded-full bg-accent/20 border border-accent/40 backdrop-blur-xl flex items-center justify-center group-hover:bg-accent/30 group-hover:border-accent/60 transition-all shadow-lg",children:t.jsx(De,{size:22,className:"text-accent"})}),t.jsx(_.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:.2},className:"absolute -top-8 left-1/2 -translate-x-1/2 whitespace-nowrap",children:t.jsx("span",{className:"text-xs font-medium text-accent bg-background/80 backdrop-blur-sm px-2 py-1 rounded-full border border-accent/20",children:"Scan"})})]})]})})]})})},Re={nutrition:[{id:"all",label:"All Foods",icon:$},{id:"meals",label:"My Meals",icon:I},{id:"recent",label:"Recent",icon:J},{id:"bookmarked",label:"Saved",icon:R},{id:"high_protein",label:"High Protein",icon:ne},{id:"vegan",label:"Vegan",icon:se},{id:"allergen_free",label:"Allergen-Free",icon:E}],inventory:[{id:"all",label:"All Items",icon:C},{id:"expiring",label:"Expiring",icon:q},{id:"low_stock",label:"Low Stock",icon:z},{id:"fridge",label:"Fridge",icon:C},{id:"pantry",label:"Pantry",icon:C}],recipes:[{id:"all",label:"All Recipes",icon:I},{id:"my_recipes",label:"My Recipes",icon:L},{id:"bookmarked",label:"Saved",icon:R},{id:"ready",label:"Ready to Cook",icon:q},{id:"quick",label:"Quick (<30min)",icon:X}],pets:[{id:"all",label:"All Pets",icon:W},{id:"dogs",label:"Dogs",icon:le},{id:"cats",label:"Cats",icon:ie},{id:"senior",label:"Senior Pets",icon:Y},{id:"toxic_monitoring",label:"Toxic Monitoring",icon:G},{id:"supplies",label:"Pet Supplies",icon:re},{id:"low_stock_supplies",label:"Low Stock",icon:z},{id:"expiring_food",label:"Expiring Food",icon:q}],beauty:[{id:"all",label:"All Products",icon:L},{id:"expiring_soon",label:"Expiring Soon",icon:q},{id:"expired",label:"Expired",icon:te},{id:"low_stock",label:"Low Stock",icon:z},{id:"fresh",label:"Fresh",icon:ce},{id:"skincare",label:"Skincare",icon:ae},{id:"haircare",label:"Haircare",icon:L},{id:"makeup",label:"Makeup",icon:oe},{id:"allergen_free",label:"Allergen-Free",icon:E},{id:"repurchase",label:"Repurchase",icon:R}]},T=({domain:a,isOpen:e=!0,onClose:s=()=>{},onSelect:r,items:f,placeholder:h="Search...",filters:S,standalone:v=!0})=>{const[b,w]=c.useState(""),[y,g]=c.useState([]),m=Re[a],k=l=>{if(l==="all"){g([]);return}g(d=>d.includes(l)?d.filter(p=>p!==l):[...d,l])},N=c.useMemo(()=>{let l=f;if(b.trim()){const d=b.toLowerCase();l=l.filter(p=>{var u,i,o,n;return((u=p.name)==null?void 0:u.toLowerCase().includes(d))||((i=p.title)==null?void 0:i.toLowerCase().includes(d))||((o=p.item_name)==null?void 0:o.toLowerCase().includes(d))||((n=p.food_name)==null?void 0:n.toLowerCase().includes(d))})}return y.length>0&&S&&y.forEach(d=>{const p=S.find(u=>u.id===d);p&&(l=p.query(l))}),l},[f,b,y,S]),A=l=>{r(l),w(""),g([]),v&&s()},D=t.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[t.jsxs("div",{className:"relative flex-shrink-0",children:[t.jsx(B,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"}),t.jsx(pe,{value:b,onChange:l=>w(l.target.value),placeholder:h,className:"pl-10 pr-10",autoFocus:v}),b&&t.jsx(me,{variant:"ghost",size:"icon",onClick:()=>w(""),className:"absolute right-1 top-1/2 -translate-y-1/2",children:t.jsx(fe,{size:18})})]}),t.jsx("div",{className:"overflow-x-auto flex-shrink-0",children:t.jsxs("div",{className:"flex gap-2 pb-2",children:[t.jsxs("button",{onClick:()=>k("all"),className:H("flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all",y.length===0?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:[t.jsx(C,{size:14}),"All"]}),m.filter(l=>l.id!=="all").map(l=>{const d=l.icon,p=y.includes(l.id);return t.jsxs("button",{onClick:()=>k(l.id),className:H("flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all",p?"bg-primary text-primary-foreground shadow-glow":"bg-muted text-muted-foreground hover:bg-muted/80"),children:[t.jsx(d,{size:14}),l.label]},l.id)}),y.length>0&&t.jsxs("div",{className:"flex items-center px-3 py-1.5 rounded-full bg-accent/20 text-accent text-xs font-medium",children:[y.length," filter",y.length>1?"s":""," active"]})]})}),t.jsx(he,{className:"flex-1",children:t.jsx("div",{className:"space-y-2",children:N.length===0?t.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[t.jsx(B,{size:48,className:"text-muted-foreground/20 mb-4"}),t.jsx("p",{className:"text-muted-foreground",children:"No items found"})]}):N.map((l,d)=>{const p=l.name||l.title||l.item_name||l.food_name||"Unknown",u=l.quantity||l.servings||"",i=l.unit||"";return t.jsxs("button",{onClick:()=>A(l),className:H("w-full flex items-center justify-between p-4 rounded-xl","bg-background/40 backdrop-blur-xl border border-border/20","hover:border-primary/30 hover:bg-background/60","transition-all duration-200"),children:[t.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[t.jsxs("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center shrink-0",children:[a==="nutrition"&&t.jsx($,{size:20,className:"text-primary"}),a==="inventory"&&t.jsx(C,{size:20,className:"text-primary"}),a==="recipes"&&t.jsx(I,{size:20,className:"text-primary"}),a==="pets"&&t.jsx(W,{size:20,className:"text-primary"}),a==="beauty"&&t.jsx(L,{size:20,className:"text-primary"})]}),t.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[t.jsx("p",{className:"font-medium text-foreground truncate",children:p}),(u||i)&&t.jsxs("p",{className:"text-sm text-muted-foreground",children:[u," ",i]})]})]}),t.jsx("div",{className:"text-muted-foreground",children:"â€º"})]},l.id||d)})})})]});return v?t.jsx(ye,{open:e,onOpenChange:s,children:t.jsxs(xe,{side:"bottom",className:"h-[80vh]",children:[t.jsx(ge,{children:t.jsxs(be,{className:"flex items-center gap-2",children:[t.jsx(B,{size:20,className:"text-primary"}),"Search ",a.charAt(0).toUpperCase()+a.slice(1)]})}),t.jsx("div",{className:"mt-6 h-[calc(100%-80px)]",children:D})]})}):D},ze=["serum","moisturizer","cleanser","toner","sunscreen","eye cream","mask","retinol","cream","lotion","facial"],Fe=["shampoo","conditioner","hair oil","styling","treatment","hair mask","hair spray","gel","hair"],Pe=["lipstick","foundation","mascara","eyeshadow","blush","concealer","primer","makeup","cosmetic","eyeliner","lip"],K=(a,e)=>{const s=a.toLowerCase();return e.some(r=>s.includes(r))},Te=[{id:"meals",label:"My Meals",icon:I,query:a=>a.filter(e=>e.is_template===!0)},{id:"recent",label:"Recent",icon:J,query:a=>a.slice().sort((e,s)=>new Date(s.last_used_at||s.created_at).getTime()-new Date(e.last_used_at||e.created_at).getTime()).slice(0,20)},{id:"bookmarked",label:"Saved",icon:R,query:a=>a.filter(e=>e.is_bookmarked===!0)},{id:"high_protein",label:"High Protein",icon:ne,query:a=>a.filter(e=>{var r;return(((r=e.nutrition_data)==null?void 0:r.protein)||0)>15}).sort((e,s)=>{var r,f;return(((r=s.nutrition_data)==null?void 0:r.protein)||0)-(((f=e.nutrition_data)==null?void 0:f.protein)||0)})},{id:"vegan",label:"Vegan",icon:se,query:a=>a.filter(e=>{const s=e.dietary_flags||[],r=e.allergens||[];return s.includes("vegan")||s.includes("vegetarian")&&!r.some(f=>["milk","eggs","honey"].includes(f.toLowerCase()))})},{id:"allergen_free",label:"Allergen-Free",icon:E,query:a=>a.filter(e=>{const s=e.allergens||[],r=["milk","eggs","fish","shellfish","tree nuts","peanuts","wheat","soybeans"];return!s.some(f=>r.some(h=>f.toLowerCase().includes(h)))})}],Ee=[{id:"expiring",label:"Expiring",icon:q,query:a=>{const e=new Date;return e.setDate(e.getDate()+7),a.filter(s=>s.expiry_date&&new Date(s.expiry_date)<=e).sort((s,r)=>new Date(s.expiry_date).getTime()-new Date(r.expiry_date).getTime())}},{id:"low_stock",label:"Low Stock",icon:z,query:a=>a.filter(e=>e.fill_level!==null&&e.fill_level<=20).sort((e,s)=>(e.fill_level||0)-(s.fill_level||0))},{id:"fridge",label:"Fridge",icon:C,query:a=>a.filter(e=>e.category==="fridge")},{id:"pantry",label:"Pantry",icon:C,query:a=>a.filter(e=>e.category==="pantry")}],Ie=[{id:"my_recipes",label:"My Recipes",icon:L,query:a=>a.filter(e=>e.user_created===!0)},{id:"bookmarked",label:"Saved",icon:R,query:a=>a.filter(e=>e.is_bookmarked===!0)},{id:"ready",label:"Ready to Cook",icon:q,query:a=>a.filter(e=>e.match_score!==null&&e.match_score>=80).sort((e,s)=>(s.match_score||0)-(e.match_score||0))},{id:"quick",label:"Quick (<30min)",icon:X,query:a=>a.filter(e=>e.cooking_time!==null&&e.cooking_time<30).sort((e,s)=>(e.cooking_time||0)-(s.cooking_time||0))}],Ue=[{id:"dogs",label:"Dogs",icon:le,query:a=>a.filter(e=>{var s;return((s=e.species)==null?void 0:s.toLowerCase())==="dog"})},{id:"cats",label:"Cats",icon:ie,query:a=>a.filter(e=>{var s;return((s=e.species)==null?void 0:s.toLowerCase())==="cat"})},{id:"senior",label:"Senior Pets",icon:Y,query:a=>a.filter(e=>{var f;const s=(f=e.species)==null?void 0:f.toLowerCase(),r=e.age||0;return s==="dog"&&r>=7||s==="cat"&&r>=11})},{id:"toxic_monitoring",label:"Toxic Monitoring",icon:G,query:a=>a.filter(e=>e.toxic_flags_enabled===!0)},{id:"supplies",label:"Pet Supplies",icon:re,query:a=>a.filter(e=>e.category==="pets")},{id:"low_stock_supplies",label:"Low Stock",icon:z,query:a=>a.filter(e=>e.category==="pets"&&e.fill_level!==null&&e.fill_level<=20).sort((e,s)=>(e.fill_level||0)-(s.fill_level||0))},{id:"expiring_food",label:"Expiring Food",icon:q,query:a=>a.filter(e=>{if(!e.expiry_date||e.category!=="pets")return!1;const s=new Date(e.expiry_date),r=new Date;return r.setDate(r.getDate()+14),s<=r&&s>=new Date}).sort((e,s)=>new Date(e.expiry_date).getTime()-new Date(s.expiry_date).getTime())}],Be=[{id:"expiring_soon",label:"Expiring Soon",icon:q,query:a=>a.filter(e=>{if(!e.expiry_date)return!1;const s=new Date(e.expiry_date),r=new Date;return r.setDate(r.getDate()+30),s<=r&&s>=new Date}).sort((e,s)=>new Date(e.expiry_date).getTime()-new Date(s.expiry_date).getTime())},{id:"expired",label:"Expired",icon:te,query:a=>a.filter(e=>e.expiry_date?new Date(e.expiry_date)<new Date:!1).sort((e,s)=>new Date(s.expiry_date).getTime()-new Date(e.expiry_date).getTime())},{id:"low_stock",label:"Low Stock",icon:z,query:a=>a.filter(e=>e.fill_level!==null&&e.fill_level<=20).sort((e,s)=>(e.fill_level||0)-(s.fill_level||0))},{id:"fresh",label:"Fresh",icon:ce,query:a=>a.filter(e=>{if(!e.created_at)return!1;const s=new Date(e.created_at),r=new Date;return r.setDate(r.getDate()-14),s>=r}).sort((e,s)=>new Date(s.created_at).getTime()-new Date(e.created_at).getTime())},{id:"skincare",label:"Skincare",icon:ae,query:a=>a.filter(e=>K(e.name,ze))},{id:"haircare",label:"Haircare",icon:L,query:a=>a.filter(e=>K(e.name,Fe))},{id:"makeup",label:"Makeup",icon:oe,query:a=>a.filter(e=>K(e.name,Pe))},{id:"allergen_free",label:"Allergen-Free",icon:E,query:a=>a.filter(e=>{const s=e.allergens||[];return s.length===0||Array.isArray(s)&&s.every(r=>!r)})},{id:"repurchase",label:"Repurchase",icon:R,query:a=>a.filter(e=>e.is_bookmarked===!0)}],He=({open:a,onOpenChange:e})=>{const s=Z(),[r,f]=c.useState("nutrition"),[h,S]=c.useState([]),[v,b]=c.useState([]),[w,y]=c.useState([]),[g,m]=c.useState([]),[k,N]=c.useState([]);c.useEffect(()=>{a&&A()},[a]);const A=async()=>{const{data:{user:i}}=await j.auth.getUser();if(!i)return;const{data:o}=await j.from("profiles").select("current_household_id").eq("id",i.id).single(),n=o==null?void 0:o.current_household_id,[x,U,V,O,Q]=await Promise.all([j.from("saved_foods").select("*").eq("user_id",i.id),n?j.from("inventory").select("*").eq("household_id",n):Promise.resolve({data:[]}),n?j.from("recipes").select("*").eq("household_id",n):Promise.resolve({data:[]}),j.from("pets").select("*").eq("user_id",i.id),n?j.from("inventory").select("*").eq("household_id",n).eq("category","pets"):Promise.resolve({data:[]})]);x.data&&S(x.data),U.data&&(b(U.data),N(U.data.filter(de=>de.category==="beauty"))),V.data&&y(V.data),(O.data||Q.data)&&m([...O.data||[],...Q.data||[]])},D=i=>{Se.success(`Selected: ${i.food_name}`),e(!1)},l=i=>{s("/inventory",{state:{highlightItemId:i.id}}),e(!1)},d=i=>{s("/recipes",{state:{highlightRecipeId:i.id}}),e(!1)},p=i=>{s("/household"),e(!1)},u=i=>{s("/inventory",{state:{highlightItemId:i.id}}),e(!1)};return c.useEffect(()=>{const i=o=>{o.key==="k"&&(o.metaKey||o.ctrlKey)&&(o.preventDefault(),e(!a))};return document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[a,e]),t.jsx(ve,{open:a,onOpenChange:e,children:t.jsxs(ke,{className:"max-w-4xl h-[80vh] p-0 gap-0",children:[t.jsx(we,{className:"px-6 py-4 border-b border-border/50",children:t.jsx(je,{children:"Search Everything"})}),t.jsxs(qe,{value:r,onValueChange:i=>f(i),className:"flex-1 flex flex-col",children:[t.jsxs(Ce,{className:"w-full justify-start rounded-none border-b border-border/50 bg-transparent px-6",children:[t.jsxs(F,{value:"nutrition",className:"gap-2",children:[t.jsx(Le,{className:"w-4 h-4"}),"Nutrition"]}),t.jsxs(F,{value:"inventory",className:"gap-2",children:[t.jsx(C,{className:"w-4 h-4"}),"Inventory"]}),t.jsxs(F,{value:"recipes",className:"gap-2",children:[t.jsx(_e,{className:"w-4 h-4"}),"Recipes"]}),t.jsxs(F,{value:"pets",className:"gap-2",children:[t.jsx(W,{className:"w-4 h-4"}),"Pets"]}),t.jsxs(F,{value:"beauty",className:"gap-2",children:[t.jsx(L,{className:"w-4 h-4"}),"Beauty"]})]}),t.jsxs("div",{className:"flex-1 overflow-hidden",children:[t.jsx(P,{value:"nutrition",className:"h-full m-0 p-4",children:t.jsx(T,{domain:"nutrition",items:h,onSelect:D,placeholder:"Search foods...",filters:Te,standalone:!1})}),t.jsx(P,{value:"inventory",className:"h-full m-0 p-4",children:t.jsx(T,{domain:"inventory",items:v,onSelect:l,placeholder:"Search inventory...",filters:Ee,standalone:!1})}),t.jsx(P,{value:"recipes",className:"h-full m-0 p-4",children:t.jsx(T,{domain:"recipes",items:w,onSelect:d,placeholder:"Search recipes...",filters:Ie,standalone:!1})}),t.jsx(P,{value:"pets",className:"h-full m-0 p-4",children:t.jsx(T,{domain:"pets",items:g,onSelect:p,placeholder:"Search pet items...",filters:Ue,standalone:!1})}),t.jsx(P,{value:"beauty",className:"h-full m-0 p-4",children:t.jsx(T,{domain:"beauty",items:k,onSelect:u,placeholder:"Search beauty products...",filters:Be,standalone:!1})})]})]})]})})},Ke=({keywords:a=["kaeva","hey kaeva","hi kaeva","ok kaeva"],onActivated:e,enabled:s=!0,threshold:r=.7}={})=>{const[f,h]=c.useState(!1),[S,v]=c.useState(!1),[b,w]=c.useState(null),[y,g]=c.useState(null),m=c.useRef(null),k=c.useRef(0),N=3e3,A=(u,i)=>{const o=[];for(let n=0;n<=i.length;n++)o[n]=[n];for(let n=0;n<=u.length;n++)o[0][n]=n;for(let n=1;n<=i.length;n++)for(let x=1;x<=u.length;x++)i.charAt(n-1)===u.charAt(x-1)?o[n][x]=o[n-1][x-1]:o[n][x]=Math.min(o[n-1][x-1]+1,o[n][x-1]+1,o[n-1][x]+1);return o[i.length][u.length]},D=(u,i)=>{const o=A(u.toLowerCase(),i.toLowerCase()),n=Math.max(u.length,i.length);return 1-o/n},l=c.useCallback(u=>{if(Date.now()-k.current<N)return!1;const o=u.toLowerCase();for(const n of a)if(o.includes(n)||D(o,n)>=r)return!0;return!1},[a,r]),d=c.useCallback(()=>{if(!("webkitSpeechRecognition"in window||"SpeechRecognition"in window)){g("Speech recognition not supported");return}try{const u=window.SpeechRecognition||window.webkitSpeechRecognition;m.current=new u,m.current.continuous=!0,m.current.interimResults=!0,m.current.lang="en-US",m.current.onstart=()=>{h(!0),g(null)},m.current.onresult=i=>{const o=i.results.length-1,n=i.results[o][0].transcript;l(n)&&(v(!0),w(new Date),k.current=Date.now(),e&&e(),setTimeout(()=>v(!1),2e3))},m.current.onerror=i=>{i.error==="not-allowed"?(g("Microphone access denied"),h(!1)):i.error!=="no-speech"&&console.error("Speech recognition error:",i.error)},m.current.onend=()=>{h(!1),s&&setTimeout(()=>{if(m.current&&s)try{m.current.start()}catch(i){console.error("Failed to restart recognition:",i)}},100)},m.current.start()}catch(u){console.error("Error starting wake word detection:",u),g("Failed to start wake word detection")}},[s,l,e]),p=c.useCallback(()=>{m.current&&(m.current.stop(),m.current=null,h(!1))},[]);return c.useEffect(()=>(s?d():p(),()=>{p()}),[s,d,p]),{isListening:f,isActivated:S,lastDetectedAt:b,error:y,startListening:d,stopListening:p}},We=({isListening:a,isActivated:e})=>t.jsx(ee,{children:a&&t.jsx(_.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"fixed bottom-24 right-4 z-40",children:t.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-background/80 backdrop-blur border border-primary/20",children:[t.jsx(_.div,{animate:{scale:e?[1,1.5,1]:1,backgroundColor:"hsl(var(--primary))"},transition:{duration:.3},className:"w-2 h-2 rounded-full bg-primary",style:{animation:e?"none":"pulse 2s ease-in-out infinite"}}),t.jsx("span",{className:"text-xs text-muted-foreground",children:e?"Activated!":'Say "Kaeva"'})]})})}),et=({children:a,onScan:e,onVoiceActivate:s,fullScreen:r=!1})=>{Z(),Ne();const[f,h]=c.useState(null),[S,v]=c.useState(null),[b,w]=c.useState(!1),[y,g]=c.useState(!1),[m,k]=c.useState(!1),{isListening:N,isActivated:A}=Ke({enabled:!0,onActivated:()=>{s&&!m&&(s(),k(!0),setTimeout(()=>k(!1),2e3))}});c.useEffect(()=>{(async()=>{const{data:{user:d}}=await j.auth.getUser();if(d){h(d.id);const{data:p}=await j.from("profiles").select("*").eq("id",d.id).single();v(p)}})()},[]);const D=()=>{s&&s()};return t.jsxs(t.Fragment,{children:[t.jsx(_.div,{className:"fixed inset-0 bg-gradient-to-br from-background via-background to-primary/5 z-0",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.2}}),t.jsx(Ae,{className:r?"":"pt-6",fullScreen:r,children:a}),t.jsx(_.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3,type:"spring",stiffness:260,damping:20},className:"fixed bottom-[calc(1.5rem+env(safe-area-inset-bottom))] inset-x-0 z-50 flex justify-center pointer-events-none",children:t.jsx("div",{className:"relative w-[calc(100%-2rem)] max-w-[320px] h-[72px] pointer-events-auto"})}),t.jsx(Me,{open:b,onOpenChange:w,onVoiceActivate:D,onScanActivate:e}),t.jsx(He,{open:y,onOpenChange:g}),t.jsx(We,{isListening:N,isActivated:A})]})};export{et as A};

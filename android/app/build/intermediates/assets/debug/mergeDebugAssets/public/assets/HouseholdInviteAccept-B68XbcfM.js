import{j as e}from"./ui-vendor-CRu_cuPE.js";import{j as b,u as A,r as i}from"./react-vendor-DwZQO67Z.js";import{a as E,s as c,i as j,B as u}from"./index-D4bhw5kJ.js";import{C as R,a as U,b as V,c as $,d as z}from"./card-q-j3zA9P.js";import{A as y}from"./AuroraBackground-BbE4aKfk.js";import{m as N}from"./animation-vendor-C-lCNj7M.js";import{U as B}from"./users-DudXFJtM.js";import{a as H,C as D}from"./circle-x-CDVLy9TU.js";import"./chart-vendor-BDCxrQ3h.js";import"./supabase-vendor-BS1x--yE.js";function O(){const[C]=b(),s=A(),{toast:m}=E(),[h,p]=i.useState(!1),[_,x]=i.useState(!0),[I,S]=i.useState(!1),[d,k]=i.useState(""),[v,l]=i.useState(""),[L,f]=i.useState(!1),t=C.get("code");i.useEffect(()=>{(async()=>{if(!t){const r=sessionStorage.getItem("kaeva_pending_invite");if(r){sessionStorage.removeItem("kaeva_pending_invite"),s(`/household/join?code=${encodeURIComponent(r)}`,{replace:!0});return}l("No invite code provided"),x(!1);return}const{data:{session:n}}=await c.auth.getSession();if(!n){sessionStorage.setItem("kaeva_pending_invite",t),sessionStorage.setItem("kaeva_redirect_after_auth",`/household/join?code=${encodeURIComponent(t)}`),s("/auth",{replace:!0});return}f(!0),S(!0),x(!1)})();const{data:{subscription:a}}=c.auth.onAuthStateChange((n,r)=>{if(n==="SIGNED_IN"&&r){f(!0);const g=sessionStorage.getItem("kaeva_pending_invite");g&&!t&&(sessionStorage.removeItem("kaeva_pending_invite"),s(`/household/join?code=${encodeURIComponent(g)}`,{replace:!0}))}});return()=>a.unsubscribe()},[t,s]);const w=async()=>{if(t){p(!0),l("");try{const{data:{session:o}}=await c.auth.getSession();if(!o){sessionStorage.setItem("kaeva_pending_invite",t),sessionStorage.setItem("kaeva_redirect_after_auth",`/household/join?code=${encodeURIComponent(t)}`),s("/auth",{replace:!0});return}const{data:a,error:n}=await c.functions.invoke("accept-household-invite",{body:{invite_code:t}});if(n)throw n;a!=null&&a.success&&(k(a.household_name),sessionStorage.removeItem("kaeva_pending_invite"),m({title:"Joined household!",description:`You've successfully joined ${a.household_name}`}),setTimeout(()=>{s("/app",{replace:!0})},2e3))}catch(o){console.error("Error accepting invite:",o),l(o.message||"Failed to accept invite"),m({title:"Error",description:o.message||"Failed to accept invite",variant:"destructive"})}finally{p(!1)}}};return _?e.jsxs(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"min-h-screen flex items-center justify-center relative",children:[e.jsx(y,{}),e.jsx("div",{className:"relative z-10",children:e.jsx(j,{size:"lg"})})]}):e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative",children:[e.jsx(y,{}),e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full max-w-md relative z-10",children:e.jsxs(R,{children:[e.jsxs(U,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(B,{className:"h-6 w-6 text-primary"})}),e.jsx(V,{children:"Join Household"}),e.jsx($,{children:"You've been invited to join a household"})]}),e.jsx(z,{className:"space-y-4",children:v?e.jsxs("div",{className:"flex flex-col items-center space-y-4 py-4",children:[e.jsx(H,{className:"h-12 w-12 text-destructive"}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:v}),e.jsx(u,{onClick:()=>s("/"),variant:"outline",children:"Go to Dashboard"})]}):I&&!d?e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Click below to accept the invitation and join the household."}),e.jsxs(u,{onClick:w,disabled:h,className:"w-full",children:[h&&e.jsx(j,{size:"xs",speed:"fast",showCore:!1,className:"mr-2"}),"Accept Invitation"]}),e.jsx(u,{onClick:()=>s("/"),variant:"outline",className:"w-full",children:"Cancel"})]}):d?e.jsxs("div",{className:"flex flex-col items-center space-y-4 py-4",children:[e.jsx(D,{className:"h-12 w-12 text-primary"}),e.jsxs("p",{className:"text-sm text-muted-foreground text-center",children:["Successfully joined ",d,"!"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Redirecting to dashboard..."})]}):null})]})})]})}export{O as default};

import{j as e}from"./ui-vendor-CRu_cuPE.js";import{r as f,u as ue}from"./react-vendor-DwZQO67Z.js";import{d as ge,a6 as me,as as fe,aw as te,aA as S,j as O,a_ as pe,a$ as ye,b0 as je,b1 as be,s as P,al as H,o as ve,at as we,ay as B,ah as Ne,b2 as Me,a as ke,i as De,B as L,Q as Ce,J as _e,C as Se}from"./index-D4bhw5kJ.js";import{C as A,a as W,b as R,d as U}from"./card-q-j3zA9P.js";import{A as Te}from"./AuroraBackground-BbE4aKfk.js";import{m as I}from"./animation-vendor-C-lCNj7M.js";import{a as Y,s as re}from"./startOfMonth-BX_IpS4n.js";import{e as ne}from"./endOfMonth-xVGECeUJ.js";import{T as Ie,d as $e,R as V,B as Oe,C as oe,X as ie,Y as le,b as K,L as Ae,a as Be,e as Ee}from"./chart-vendor-BDCxrQ3h.js";import{T as q}from"./trending-up-0sWaYDAK.js";import{T as se}from"./trending-down-D_vIl22O.js";import{e as Le}from"./endOfWeek-K737SY6W.js";import{U as ae}from"./UniversalShell-B176IQVx.js";import{P as Pe,B as Fe}from"./BottomTabBar-DZz-LxaA.js";import{u as ze}from"./useSwipeNavigation-FVKdXjvo.js";import{P as He}from"./PageTransition-DTafOOMG.js";import{C as We}from"./chevron-left-DnN1sqg3.js";import"./supabase-vendor-BS1x--yE.js";import"./arrow-left-CQcT7sCo.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=ge("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);function Re(r,t){const[a,n]=me(r,t.start,t.end);return{start:a,end:n}}function Ue(r,t){const{start:a,end:n}=Re(t==null?void 0:t.in,r);let s=+a>+n;const o=s?+a:+n,l=s?n:a;l.setHours(0,0,0,0);let i=1;const g=[];for(;+l<=o;)g.push(fe(a,l)),l.setDate(l.getDate()+i),l.setHours(0,0,0,0);return s?g.reverse():g}function Ke(r,t,a){return Y(r,-1,a)}const Ye=({month:r,year:t,mealLogs:a,tdee:n,onDayClick:s})=>{const o=new Date(t,r,1),l=re(o),i=ne(o),g=Ue({start:l,end:i}),x=l.getDay(),c=Array(x).fill(null),N=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],k=p=>{const y=a.filter(h=>te(new Date(h.logged_at),p)),d=y.reduce((h,b)=>h+(b.calories||0),0),u=Math.abs(d-n)<n*.1;return{date:p,totalCalories:d,targetMet:u,meals:y}};return e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-2",children:N.map(p=>e.jsx("div",{className:"text-center text-muted-foreground text-xs font-semibold py-2",children:p},p))}),e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[c.map((p,y)=>e.jsx("div",{className:"aspect-square"},`padding-${y}`)),g.map(p=>{const y=k(p),d=y.meals.length>0,u=te(p,new Date);return e.jsxs(I.button,{onClick:()=>d&&s(y),disabled:!d,className:`aspect-square bg-white/5 rounded-lg relative flex items-center justify-center
                ${d?"cursor-pointer hover:bg-white/10":"cursor-default opacity-50"}
                ${u?"ring-2 ring-secondary":""}
                transition-colors`,whileHover:d?{scale:1.05}:{},whileTap:d?{scale:.95}:{},children:[e.jsx("span",{className:`text-sm ${u?"text-secondary font-bold":"text-foreground"}`,children:S(p,"d")}),d&&e.jsx("div",{className:`absolute bottom-1 right-1 w-2 h-2 rounded-full ${y.targetMet?"bg-green-500":"bg-yellow-500"}`})]},p.toISOString())})]})]})},qe={light:"",dark:".dark"},ce=f.createContext(null);function de(){const r=f.useContext(ce);if(!r)throw new Error("useChart must be used within a <ChartContainer />");return r}const X=f.forwardRef(({id:r,className:t,children:a,config:n,...s},o)=>{const l=f.useId(),i=`chart-${r||l.replace(/:/g,"")}`;return e.jsx(ce.Provider,{value:{config:n},children:e.jsxs("div",{"data-chart":i,ref:o,className:O("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",t),...s,children:[e.jsx(Ge,{id:i,config:n}),e.jsx(V,{children:a})]})})});X.displayName="Chart";const Ge=({id:r,config:t})=>{const a=Object.entries(t).filter(([n,s])=>s.theme||s.color);return a.length?e.jsx("style",{dangerouslySetInnerHTML:{__html:Object.entries(qe).map(([n,s])=>`
${s} [data-chart=${r}] {
${a.map(([o,l])=>{var g;const i=((g=l.theme)==null?void 0:g[n])||l.color;return i?`  --color-${o}: ${i};`:null}).join(`
`)}
}
`).join(`
`)}}):null},he=Ie,Q=f.forwardRef(({active:r,payload:t,className:a,indicator:n="dot",hideLabel:s=!1,hideIndicator:o=!1,label:l,labelFormatter:i,labelClassName:g,formatter:x,color:c,nameKey:N,labelKey:k},p)=>{const{config:y}=de(),d=f.useMemo(()=>{var $;if(s||!(t!=null&&t.length))return null;const[h]=t,b=`${k||h.dataKey||h.name||"value"}`,T=J(y,h,b),M=!k&&typeof l=="string"?(($=y[l])==null?void 0:$.label)||l:T==null?void 0:T.label;return i?e.jsx("div",{className:O("font-medium",g),children:i(M,t)}):M?e.jsx("div",{className:O("font-medium",g),children:M}):null},[l,i,t,s,g,y,k]);if(!r||!(t!=null&&t.length))return null;const u=t.length===1&&n!=="dot";return e.jsxs("div",{ref:p,className:O("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",a),children:[u?null:d,e.jsx("div",{className:"grid gap-1.5",children:t.map((h,b)=>{const T=`${N||h.name||h.dataKey||"value"}`,M=J(y,h,T),$=c||h.payload.fill||h.color;return e.jsx("div",{className:O("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",n==="dot"&&"items-center"),children:x&&(h==null?void 0:h.value)!==void 0&&h.name?x(h.value,h.name,h,b,h.payload):e.jsxs(e.Fragment,{children:[M!=null&&M.icon?e.jsx(M.icon,{}):!o&&e.jsx("div",{className:O("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":n==="dot","w-1":n==="line","w-0 border-[1.5px] border-dashed bg-transparent":n==="dashed","my-0.5":u&&n==="dashed"}),style:{"--color-bg":$,"--color-border":$}}),e.jsxs("div",{className:O("flex flex-1 justify-between leading-none",u?"items-end":"items-center"),children:[e.jsxs("div",{className:"grid gap-1.5",children:[u?d:null,e.jsx("span",{className:"text-muted-foreground",children:(M==null?void 0:M.label)||h.name})]}),h.value&&e.jsx("span",{className:"font-mono font-medium tabular-nums text-foreground",children:h.value.toLocaleString()})]})]})},h.dataKey)})})]})});Q.displayName="ChartTooltip";const xe=$e,Z=f.forwardRef(({className:r,hideIcon:t=!1,payload:a,verticalAlign:n="bottom",nameKey:s},o)=>{const{config:l}=de();return a!=null&&a.length?e.jsx("div",{ref:o,className:O("flex items-center justify-center gap-4",n==="top"?"pb-3":"pt-3",r),children:a.map(i=>{const g=`${s||i.dataKey||"value"}`,x=J(l,i,g);return e.jsxs("div",{className:O("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[x!=null&&x.icon&&!t?e.jsx(x.icon,{}):e.jsx("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:i.color}}),x==null?void 0:x.label]},i.value)})}):null});Z.displayName="ChartLegend";function J(r,t,a){if(typeof t!="object"||t===null)return;const n="payload"in t&&typeof t.payload=="object"&&t.payload!==null?t.payload:void 0;let s=a;return a in t&&typeof t[a]=="string"?s=t[a]:n&&a in n&&typeof n[a]=="string"&&(s=n[a]),s in r?r[s]:r[a]}const Je={protein:{label:"Protein",color:"hsl(0, 84%, 60%)"},carbs:{label:"Carbs",color:"hsl(217, 91%, 60%)"},fat:{label:"Fat",color:"hsl(48, 96%, 53%)"}},Ve=({data:r})=>r.length===0?e.jsx("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:e.jsx("p",{children:"No data available for the last 7 days"})}):e.jsx(X,{config:Je,className:"h-64",children:e.jsx(V,{width:"100%",height:"100%",children:e.jsxs(Oe,{data:r,children:[e.jsx(oe,{strokeDasharray:"3 3",stroke:"hsl(var(--border))",opacity:.2}),e.jsx(ie,{dataKey:"date",stroke:"hsl(var(--muted-foreground))",fontSize:12}),e.jsx(le,{stroke:"hsl(var(--muted-foreground))",fontSize:12,label:{value:"Grams",angle:-90,position:"insideLeft"}}),e.jsx(he,{content:e.jsx(Q,{})}),e.jsx(xe,{content:e.jsx(Z,{})}),e.jsx(K,{dataKey:"protein",stackId:"macros",fill:"var(--color-protein)",radius:[0,0,0,0]}),e.jsx(K,{dataKey:"carbs",stackId:"macros",fill:"var(--color-carbs)",radius:[0,0,0,0]}),e.jsx(K,{dataKey:"fat",stackId:"macros",fill:"var(--color-fat)",radius:[4,4,0,0]})]})})}),Xe={calories:{label:"Calories",color:"hsl(var(--secondary))"},tdee:{label:"Goal",color:"hsl(var(--muted-foreground))"}},Qe=({data:r,tdee:t})=>r.length===0?e.jsx("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:e.jsx("p",{children:"No data available for the last 7 days"})}):e.jsx(X,{config:Xe,className:"h-64",children:e.jsx(V,{width:"100%",height:"100%",children:e.jsxs(Ae,{data:r,children:[e.jsx(oe,{strokeDasharray:"3 3",stroke:"hsl(var(--border))",opacity:.2}),e.jsx(ie,{dataKey:"date",stroke:"hsl(var(--muted-foreground))",fontSize:12}),e.jsx(le,{stroke:"hsl(var(--muted-foreground))",fontSize:12}),e.jsx(he,{content:e.jsx(Q,{})}),e.jsx(xe,{content:e.jsx(Z,{})}),e.jsx(Be,{type:"monotone",dataKey:"calories",stroke:"var(--color-calories)",strokeWidth:2,dot:{r:4,fill:"var(--color-calories)"}}),e.jsx(Ee,{y:t,stroke:"var(--color-tdee)",strokeDasharray:"5 5",strokeWidth:2,label:{value:"Goal",fill:"hsl(var(--muted-foreground))"}})]})})}),Ze=({dayData:r,tdee:t,open:a,onClose:n})=>r?e.jsx(pe,{open:a,onOpenChange:n,children:e.jsxs(ye,{className:"bg-background border-white/10",children:[e.jsxs(je,{children:[e.jsx(be,{className:"text-white text-2xl",children:S(r.date,"EEEE, MMM d")}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("p",{className:"text-muted-foreground text-sm",children:[r.totalCalories," / ",t," cal"]}),e.jsx("div",{className:`w-2 h-2 rounded-full ${r.targetMet?"bg-green-500":"bg-yellow-500"}`})]})]}),e.jsx("div",{className:"space-y-4 p-4 max-h-[60vh] overflow-y-auto",children:r.meals.map((s,o)=>e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:o*.05},children:e.jsxs(A,{className:"bg-white/5 border-white/10 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-semibold capitalize",children:s.meal_type}),e.jsx("p",{className:"text-muted-foreground text-xs",children:S(new Date(s.logged_at),"h:mm a")})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-white font-bold",children:[s.calories||0," cal"]}),e.jsxs("p",{className:"text-muted-foreground text-xs",children:["P:",s.protein||0,"g C:",s.carbs||0,"g F:",s.fat||0,"g"]})]})]}),s.image_url&&e.jsx("img",{src:s.image_url,alt:s.meal_type,className:"w-full h-32 object-cover rounded-lg"})]})},s.id))})]})}):null,et=({userId:r})=>{const[t,a]=f.useState(null),[n,s]=f.useState(!0);f.useEffect(()=>{o()},[r]);const o=async()=>{try{const{data:c}=await P.from("profiles").select("user_weight, user_height").eq("id",r).single();if(c!=null&&c.user_weight&&(c!=null&&c.user_height)){const N=c.user_height/100,k=c.user_weight/(N*N);a(parseFloat(k.toFixed(1)))}}catch(c){console.error("Error fetching BMI:",c)}finally{s(!1)}},l=c=>c<18.5?{label:"Underweight",color:"text-accent"}:c<25?{label:"Healthy",color:"text-secondary"}:c<30?{label:"Overweight",color:"text-primary"}:{label:"Obese",color:"text-destructive"},i=c=>(Math.max(15,Math.min(35,c))-15)/20*100;if(n)return e.jsxs(A,{className:"glass-card",children:[e.jsx(W,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-accent"}),"Body Mass Index"]})}),e.jsx(U,{children:e.jsx("div",{className:"h-32 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]});if(!t)return e.jsxs(A,{className:"glass-card",children:[e.jsx(W,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-accent"}),"Body Mass Index"]})}),e.jsx(U,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add your weight and height in Settings to see your BMI"})})]});const g=l(t),x=i(t);return e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(A,{className:"glass-card",children:[e.jsx(W,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-accent"}),"Body Mass Index"]})}),e.jsxs(U,{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-4xl font-bold text-foreground",children:t}),e.jsx(ve,{variant:"outline",className:`mt-2 ${g.color}`,children:g.label})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative h-8 rounded-full overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0",style:{background:"linear-gradient(to right, hsl(var(--accent)), hsl(var(--secondary)), hsl(var(--primary)), hsl(var(--destructive)))"}}),e.jsx(I.div,{className:"absolute top-0 bottom-0 w-1 bg-foreground shadow-lg",style:{left:`${x}%`},initial:{left:"0%"},animate:{left:`${x}%`},transition:{duration:.8,ease:"easeOut"}})]}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"Underweight"}),e.jsx("span",{children:"Healthy"}),e.jsx("span",{children:"Overweight"}),e.jsx("span",{children:"Obese"})]})]})]})]})})},tt=({mealLogs:r,calorieGoal:t,proteinGoal:a,carbsGoal:n,fatGoal:s})=>{const o=f.useMemo(()=>{const l=new Date,i=we(l,{weekStartsOn:1}),g=Le(l,{weekStartsOn:1}),x=r.filter(v=>{const _=new Date(v.logged_at);return _>=i&&_<=g}),c=new Set(x.map(v=>S(new Date(v.logged_at),"yyyy-MM-dd"))).size,N=x.reduce((v,_)=>v+(_.calories||0),0),k=x.reduce((v,_)=>v+(_.protein||0),0),p=x.reduce((v,_)=>v+(_.carbs||0),0),y=x.reduce((v,_)=>v+(_.fat||0),0),d=c>0?N/c:0,u=c>0?k/c:0,h=c>0?p/c:0,b=c>0?y/c:0,T=(d-t)/t*100,M=(u-a)/a*100,$=(h-n)/n*100,E=(b-s)/s*100,F=Array.from(new Set(x.map(v=>S(new Date(v.logged_at),"yyyy-MM-dd")))).filter(v=>{const z=x.filter(j=>S(new Date(j.logged_at),"yyyy-MM-dd")===v).reduce((j,D)=>j+(D.calories||0),0);return Math.abs((z-t)/t)<=.1}).length;return{daysWithLogs:c,daysHitGoal:F,avgCalories:Math.round(d),avgProtein:Math.round(u),avgCarbs:Math.round(h),avgFat:Math.round(b),caloriesDiff:Math.round(T),proteinDiff:Math.round(M),carbsDiff:Math.round($),fatDiff:Math.round(E)}},[r,t,a,n,s]);return e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(A,{className:"backdrop-blur-xl bg-white/5 border-white/10 p-6",children:[e.jsxs("h2",{className:"text-xl text-white font-semibold mb-4 flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-primary"}),"Weekly Summary"]}),e.jsxs("div",{className:"mb-6 p-4 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Days tracked this week"}),e.jsxs("span",{className:"text-2xl font-bold text-foreground",children:[o.daysWithLogs,"/7"]})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"text-sm text-secondary",children:["âœ“ ",o.daysHitGoal," days hit calorie goal"]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Avg Calories"}),o.caloriesDiff!==0&&(o.caloriesDiff>0?e.jsx(q,{className:"w-4 h-4 text-destructive"}):e.jsx(se,{className:"w-4 h-4 text-secondary"}))]}),e.jsx("div",{className:"text-2xl font-bold text-foreground",children:o.avgCalories}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Goal: ",t," (",Math.abs(o.caloriesDiff),"% ",o.caloriesDiff>0?"over":"under",")"]})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Avg Protein"}),o.proteinDiff!==0&&(o.proteinDiff>0?e.jsx(q,{className:"w-4 h-4 text-secondary"}):e.jsx(se,{className:"w-4 h-4 text-destructive"}))]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[o.avgProtein,"g"]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Goal: ",a,"g (",Math.abs(o.proteinDiff),"% ",o.proteinDiff>0?"over":"under",")"]})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Avg Carbs"})}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[o.avgCarbs,"g"]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Goal: ",n,"g"]})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Avg Fat"})}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[o.avgFat,"g"]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Goal: ",s,"g"]})]})]})]})})},st=({mealLogs:r,calorieGoal:t,proteinGoal:a,fiberGoal:n=25})=>{const s=f.useMemo(()=>{const o=B(new Date,7),l=r.filter(d=>new Date(d.logged_at)>=o);if(l.length===0)return[];const i=[],g={};l.forEach(d=>{const u=S(new Date(d.logged_at),"yyyy-MM-dd");g[u]||(g[u]={protein:0,fiber:0,calories:0,mealsByType:{}}),g[u].protein+=d.protein||0,g[u].fiber+=d.fiber||0,g[u].calories+=d.calories||0;const h=d.meal_type;g[u].mealsByType[h]=(g[u].mealsByType[h]||0)+(d.calories||0)});const x=Object.values(g),c=x.length,N=x.filter(d=>d.protein>=a*.9).length;N>=5?i.push({icon:G,type:"success",message:`You hit your protein goal ${N} out of ${c} days! ðŸ’ª`}):N<3&&i.push({icon:Ne,type:"warning",message:`Only ${N}/${c} days hit protein goal. Try adding more lean proteins.`});const k=x.reduce((d,u)=>d+u.fiber,0)/c;if(k<n*.8){const d=Math.round((n-k)/n*100);i.push({icon:Me,type:"info",message:`Your fiber intake is ${d}% below goal. Add more veggies, fruits, and whole grains!`})}const p={};x.forEach(d=>{Object.entries(d.mealsByType).forEach(([u,h])=>{p[u]=(p[u]||0)+h})});const y=Object.entries(p).sort((d,u)=>u[1]-d[1])[0];if(y){const[d,u]=y,h=Math.round(u/x.reduce((b,T)=>b+T.calories,0)*100);h>40&&i.push({icon:q,type:"info",message:`Your ${d} meals are ${h}% of daily calories. Consider redistributing for better energy levels.`})}return c>=6&&i.push({icon:G,type:"success",message:`Amazing! You tracked ${c} out of 7 days this week. Consistency is key! ðŸŽ‰`}),i},[r,t,a,n]);return s.length===0?null:e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs(A,{className:"backdrop-blur-xl bg-white/5 border-white/10 p-6",children:[e.jsx("h2",{className:"text-xl text-white font-semibold mb-4",children:"AI Insights"}),e.jsx("div",{className:"space-y-3",children:s.map((o,l)=>{const i=o.icon,g={success:"bg-secondary/10 border-secondary/20",warning:"bg-destructive/10 border-destructive/20",info:"bg-accent/10 border-accent/20"}[o.type],x={success:"text-secondary",warning:"text-destructive",info:"text-accent"}[o.type];return e.jsx(I.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:l*.1},className:`p-4 rounded-lg border ${g}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(i,{className:`w-5 h-5 ${x} flex-shrink-0 mt-0.5`}),e.jsx("p",{className:"text-sm text-foreground flex-1",children:o.message})]})},l)})})]})})},at=r=>{const t=["Date","Time","Meal Type","Calories","Protein (g)","Carbs (g)","Fat (g)","Fiber (g)","Items"],a=r.map(i=>[S(new Date(i.logged_at),"yyyy-MM-dd"),S(new Date(i.logged_at),"HH:mm:ss"),i.meal_type,i.calories||0,i.protein||0,i.carbs||0,i.fat||0,i.fiber||0,JSON.stringify(i.items||[]).replace(/,/g,";")]),n=[t.join(","),...a.map(i=>i.join(","))].join(`
`),s=new Blob([n],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),l=URL.createObjectURL(s);o.setAttribute("href",l),o.setAttribute("download",`kaeva-meal-logs-${S(new Date,"yyyy-MM-dd")}.csv`),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(l)},Nt=()=>{const r=ue(),{toast:t}=ke(),[a,n]=f.useState(new Date),[s,o]=f.useState([]),[l,i]=f.useState(2e3),[g,x]=f.useState(!0),[c,N]=f.useState(null),[k,p]=f.useState(!1),[y,d]=f.useState(""),[u,h]=f.useState("thisWeek"),[b,T]=f.useState({calories:2e3,protein:150,carbs:200,fat:65}),M=ze();f.useEffect(()=>{$()},[a]);const $=async()=>{x(!0);try{const{data:{session:m}}=await P.auth.getSession();if(!(m!=null&&m.user))return;d(m.user.id);const{data:j}=await P.from("profiles").select("calculated_tdee, daily_calorie_goal, daily_protein_goal, daily_carbs_goal, daily_fat_goal").eq("id",m.user.id).single();j!=null&&j.calculated_tdee&&i(j.calculated_tdee),j!=null&&j.daily_calorie_goal&&T({calories:j.daily_calorie_goal,protein:j.daily_protein_goal||150,carbs:j.daily_carbs_goal||200,fat:j.daily_fat_goal||65});const D=re(a),w=ne(a),{data:C,error:ee}=await P.from("meal_logs").select("*").eq("user_id",m.user.id).gte("logged_at",D.toISOString()).lte("logged_at",w.toISOString()).order("logged_at",{ascending:!0});if(ee)throw ee;o(C||[])}catch(m){console.error("Error fetching analytics data:",m),t({title:"Error",description:"Failed to load analytics data",variant:"destructive"})}finally{x(!1)}},E=()=>{const m=new Date;switch(u){case"thisWeek":return B(m,6);case"lastWeek":return B(m,13);case"2weeksAgo":return B(m,20);case"3weeksAgo":return B(m,27);default:return B(m,6)}},F=f.useMemo(()=>{const m=E(),j=s.filter(w=>new Date(w.logged_at)>=m),D={};return j.forEach(w=>{const C=S(new Date(w.logged_at),"MMM dd");D[C]||(D[C]={protein:0,carbs:0,fat:0}),D[C].protein+=w.protein||0,D[C].carbs+=w.carbs||0,D[C].fat+=w.fat||0}),Object.entries(D).map(([w,C])=>({date:w,...C}))},[s,u]),v=f.useMemo(()=>{const m=E(),j=s.filter(w=>new Date(w.logged_at)>=m),D={};return j.forEach(w=>{const C=S(new Date(w.logged_at),"MMM dd");D[C]||(D[C]=0),D[C]+=w.calories||0}),Object.entries(D).map(([w,C])=>({date:w,calories:C}))},[s,u]),_=m=>{N(m),p(!0)},z=()=>{if(s.length===0){t({title:"No Data",description:"No meal logs to export",variant:"destructive"});return}try{at(s),t({title:"Export Successful",description:`Exported ${s.length} meal logs`})}catch{t({title:"Export Failed",description:"Failed to export data",variant:"destructive"})}};return g?e.jsx(ae,{children:e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"flex items-center justify-center h-full",children:e.jsx(De,{size:"lg"})})}):e.jsxs(ae,{children:[e.jsx(Te,{vertical:"food"}),e.jsx(Pe,{title:"Analytics",showHomeButton:!0,rightAction:e.jsxs(L,{onClick:z,variant:"outline",size:"sm",className:"gap-2",disabled:s.length===0,children:[e.jsx(Ce,{size:18}),"Export"]})}),e.jsx(He,{swipeProgress:M.progress,swipeDirection:M.direction,children:e.jsx("div",{className:"relative z-10 p-4 sm:p-8 pb-24",children:e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:_e,className:"max-w-6xl mx-auto space-y-6",children:[e.jsx("div",{children:e.jsx("p",{className:"text-body text-foreground/60",children:"Your quantified self"})}),y&&e.jsx(et,{userId:y}),e.jsx(tt,{mealLogs:s,calorieGoal:b.calories,proteinGoal:b.protein,carbsGoal:b.carbs,fatGoal:b.fat}),e.jsx(st,{mealLogs:s,calorieGoal:b.calories,proteinGoal:b.protein}),e.jsxs(A,{className:"backdrop-blur-xl bg-white/5 border-white/10 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl text-white font-semibold",children:"Monthly Overview"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(L,{variant:"glass",size:"icon",onClick:()=>n(Ke(a)),children:e.jsx(We,{size:20})}),e.jsx("span",{className:"text-white px-4 py-2 min-w-[150px] text-center",children:S(a,"MMMM yyyy")}),e.jsx(L,{variant:"glass",size:"icon",onClick:()=>n(Y(a,1)),disabled:Y(a,1)>new Date,children:e.jsx(Se,{size:20})})]})]}),e.jsx(Ye,{month:a.getMonth(),year:a.getFullYear(),mealLogs:s,tdee:l,onDayClick:_}),e.jsxs("div",{className:"flex gap-4 mt-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Hit Goal (Â±10%)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Missed Goal"})]})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[{id:"thisWeek",label:"This week"},{id:"lastWeek",label:"Last week"},{id:"2weeksAgo",label:"2 wks. ago"},{id:"3weeksAgo",label:"3 wks. ago"}].map(m=>e.jsx("button",{onClick:()=>h(m.id),className:`px-4 py-2 rounded-lg whitespace-nowrap transition-all ${u===m.id?"bg-primary text-background":"backdrop-blur-xl bg-white/5 border border-white/10 text-foreground hover:bg-white/10"}`,children:m.label},m.id))}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(A,{className:"backdrop-blur-xl bg-white/5 border-white/10 p-6",children:[e.jsx("h2",{className:"text-xl text-white font-semibold mb-4",children:"Macro Split"}),e.jsx(Ve,{data:F})]}),e.jsxs(A,{className:"backdrop-blur-xl bg-white/5 border-white/10 p-6",children:[e.jsx("h2",{className:"text-xl text-white font-semibold mb-4",children:"Calories vs Goal"}),e.jsx(Qe,{data:v,tdee:l})]})]}),s.length===0&&e.jsxs(I.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"No meal logs for this month. Start logging to see your trends!"}),e.jsx(L,{onClick:()=>r("/app"),variant:"default",children:"Go to Dashboard"})]})]})})}),e.jsx(Fe,{}),e.jsx(Ze,{dayData:c,tdee:l,open:k,onClose:()=>p(!1)})]})};export{Nt as default};

import{j as e}from"./ui-vendor-CRu_cuPE.js";import{r as o,u as he}from"./react-vendor-DwZQO67Z.js";import{d as xe,L as N,I as O,B as _,o as q,X as z,C as D,S as ae,l as re,m as le,n as ne,w as me,T as ue,a as ce,s as y,ao as ge,R as J,am as pe,D as V,e as K,f as W,g as Y,h as Q,ap as ye,aq as fe,ar as ee,A as je,r as ve,t as Ne,v as be,x as we,y as Ce,z as ke,E as Se}from"./index-D4bhw5kJ.js";import{S as U,a as I,b as $,c as P,d as m}from"./select-BN0Wnciu.js";import{U as Ae}from"./UniversalShell-B176IQVx.js";import{m as ie}from"./animation-vendor-C-lCNj7M.js";import{S as _e}from"./square-pen-UPLsKTmJ.js";import{S as se}from"./switch-_hpo76TP.js";import{B as Me}from"./bell-CPPE6kjS.js";import{S as Ee}from"./share-2-ChFTP5nb.js";import{U as oe}from"./users-DudXFJtM.js";import{P as Fe,B as He}from"./BottomTabBar-DZz-LxaA.js";import{u as Re}from"./useSwipeNavigation-FVKdXjvo.js";import{P as Le}from"./PageTransition-DTafOOMG.js";import"./chart-vendor-BDCxrQ3h.js";import"./supabase-vendor-BS1x--yE.js";import"./arrow-left-CQcT7sCo.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=xe("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),te=({initialData:s,onSubmit:d,onCancel:h})=>{var w,T,M,L,C,B,A;const[l,c]=o.useState({type:(s==null?void 0:s.type)||"adult",name:(s==null?void 0:s.name)||"",age:(s==null?void 0:s.age)||void 0,ageGroup:(s==null?void 0:s.ageGroup)||void 0,biometrics:(s==null?void 0:s.biometrics)||{},allergies:(s==null?void 0:s.allergies)||[],dietaryRestrictions:(s==null?void 0:s.dietaryRestrictions)||[],healthConditions:(s==null?void 0:s.healthConditions)||[]}),[i,p]=o.useState(""),[f,g]=o.useState(""),[v,j]=o.useState(""),b=(r,n)=>{if(!n.trim())return;const E=l[r]||[];E.includes(n.trim())||c(G=>({...G,[r]:[...E,n.trim()]}))},R=(r,n)=>{c(E=>({...E,[r]:(E[r]||[]).filter(G=>G!==n)}))},S=r=>{var n;if(r.preventDefault(),!((n=l.name)!=null&&n.trim())){alert("Please enter a name");return}d(l)};return e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-secondary",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"name",className:"text-secondary/70",children:"Name *"}),e.jsx(O,{id:"name",value:l.name,onChange:r=>c(n=>({...n,name:r.target.value})),placeholder:"e.g., Mom, Emma, Dad",className:"bg-background/50 border-secondary/20 text-secondary",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"type",className:"text-secondary/70",children:"Type *"}),e.jsxs(U,{value:l.type,onValueChange:r=>c(n=>({...n,type:r})),children:[e.jsx(I,{className:"bg-background/50 border-secondary/20 text-secondary",children:e.jsx($,{})}),e.jsxs(P,{className:"bg-background border-secondary/20",children:[e.jsx(m,{value:"adult",children:"Adult"}),e.jsx(m,{value:"elderly",children:"Elderly"}),e.jsx(m,{value:"child",children:"Child"}),e.jsx(m,{value:"toddler",children:"Toddler"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"age",className:"text-secondary/70",children:"Age"}),e.jsx(O,{id:"age",type:"number",value:l.age||"",onChange:r=>c(n=>({...n,age:parseInt(r.target.value)||void 0})),placeholder:"e.g., 8",className:"bg-background/50 border-secondary/20 text-secondary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"ageGroup",className:"text-secondary/70",children:"Age Group"}),e.jsxs(U,{value:l.ageGroup,onValueChange:r=>c(n=>({...n,ageGroup:r})),children:[e.jsx(I,{className:"bg-background/50 border-secondary/20 text-secondary",children:e.jsx($,{placeholder:"Select..."})}),e.jsxs(P,{className:"bg-background border-secondary/20",children:[e.jsx(m,{value:"infant",children:"Infant"}),e.jsx(m,{value:"toddler",children:"Toddler"}),e.jsx(m,{value:"child",children:"Child"}),e.jsx(m,{value:"teen",children:"Teen"}),e.jsx(m,{value:"adult",children:"Adult"}),e.jsx(m,{value:"elderly",children:"Elderly"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-secondary",children:"Biometrics (Optional)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"weight",className:"text-secondary/70",children:"Weight (kg)"}),e.jsx(O,{id:"weight",type:"number",value:((w=l.biometrics)==null?void 0:w.weight)||"",onChange:r=>c(n=>({...n,biometrics:{...n.biometrics,weight:parseFloat(r.target.value)||void 0}})),placeholder:"e.g., 65",className:"bg-background/50 border-secondary/20 text-secondary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"height",className:"text-secondary/70",children:"Height (cm)"}),e.jsx(O,{id:"height",type:"number",value:((T=l.biometrics)==null?void 0:T.height)||"",onChange:r=>c(n=>({...n,biometrics:{...n.biometrics,height:parseFloat(r.target.value)||void 0}})),placeholder:"e.g., 165",className:"bg-background/50 border-secondary/20 text-secondary"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"gender",className:"text-secondary/70",children:"Gender"}),e.jsxs(U,{value:(M=l.biometrics)==null?void 0:M.gender,onValueChange:r=>c(n=>({...n,biometrics:{...n.biometrics,gender:r}})),children:[e.jsx(I,{className:"bg-background/50 border-secondary/20 text-secondary",children:e.jsx($,{placeholder:"Select..."})}),e.jsxs(P,{className:"bg-background border-secondary/20",children:[e.jsx(m,{value:"male",children:"Male"}),e.jsx(m,{value:"female",children:"Female"}),e.jsx(m,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"activityLevel",className:"text-secondary/70",children:"Activity Level"}),e.jsxs(U,{value:(L=l.biometrics)==null?void 0:L.activityLevel,onValueChange:r=>c(n=>({...n,biometrics:{...n.biometrics,activityLevel:r}})),children:[e.jsx(I,{className:"bg-background/50 border-secondary/20 text-secondary",children:e.jsx($,{placeholder:"Select..."})}),e.jsxs(P,{className:"bg-background border-secondary/20",children:[e.jsx(m,{value:"sedentary",children:"Sedentary"}),e.jsx(m,{value:"light",children:"Lightly Active"}),e.jsx(m,{value:"moderate",children:"Moderately Active"}),e.jsx(m,{value:"active",children:"Very Active"}),e.jsx(m,{value:"very_active",children:"Extremely Active"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(N,{className:"text-secondary/70",children:"Allergies"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{value:i,onChange:r=>p(r.target.value),onKeyDown:r=>{r.key==="Enter"&&(r.preventDefault(),b("allergies",i),p(""))},placeholder:"e.g., Peanuts, Dairy...",className:"bg-background/50 border-secondary/20 text-secondary"}),e.jsx(_,{type:"button",onClick:()=>{b("allergies",i),p("")},variant:"outline",className:"border-secondary/20",children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(C=l.allergies)==null?void 0:C.map((r,n)=>e.jsxs(q,{variant:"destructive",className:"gap-1",children:[r,e.jsx("button",{type:"button",onClick:()=>R("allergies",r),className:"hover:bg-destructive/20 rounded-full",children:e.jsx(z,{className:"w-3 h-3"})})]},n))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(N,{className:"text-secondary/70",children:"Dietary Restrictions"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{value:f,onChange:r=>g(r.target.value),onKeyDown:r=>{r.key==="Enter"&&(r.preventDefault(),b("dietaryRestrictions",f),g(""))},placeholder:"e.g., Vegan, Low Sodium...",className:"bg-background/50 border-secondary/20 text-secondary"}),e.jsx(_,{type:"button",onClick:()=>{b("dietaryRestrictions",f),g("")},variant:"outline",className:"border-secondary/20",children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(B=l.dietaryRestrictions)==null?void 0:B.map((r,n)=>e.jsxs(q,{variant:"secondary",className:"gap-1",children:[r,e.jsx("button",{type:"button",onClick:()=>R("dietaryRestrictions",r),className:"hover:bg-secondary/20 rounded-full",children:e.jsx(z,{className:"w-3 h-3"})})]},n))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(N,{className:"text-secondary/70",children:"Health Conditions"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{value:v,onChange:r=>j(r.target.value),onKeyDown:r=>{r.key==="Enter"&&(r.preventDefault(),b("healthConditions",v),j(""))},placeholder:"e.g., Diabetes, Hypertension...",className:"bg-background/50 border-secondary/20 text-secondary"}),e.jsx(_,{type:"button",onClick:()=>{b("healthConditions",v),j("")},variant:"outline",className:"border-secondary/20",children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(A=l.healthConditions)==null?void 0:A.map((r,n)=>e.jsxs(q,{className:"gap-1 bg-accent/20 text-accent hover:bg-accent/30",children:[r,e.jsx("button",{type:"button",onClick:()=>R("healthConditions",r),className:"hover:bg-accent/20 rounded-full",children:e.jsx(z,{className:"w-3 h-3"})})]},n))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(_,{type:"button",variant:"outline",onClick:h,className:"border-secondary/20 text-secondary hover:bg-secondary/10",children:"Cancel"}),e.jsx(_,{type:"submit",className:"bg-accent hover:bg-accent/90 text-background",children:s?"Update Member":"Add Member"})]})]})},Te=()=>e.jsx(ie.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative overflow-hidden rounded-3xl bg-gradient-to-br from-background via-primary/5 to-secondary/10 p-8 lg:p-12",children:e.jsxs("div",{className:"relative z-10 flex flex-col lg:flex-row items-center justify-between gap-8",children:[e.jsxs("div",{className:"flex-1 space-y-3 text-center lg:text-left",children:[e.jsx("h2",{className:"text-3xl lg:text-4xl font-light text-secondary",children:"Managing your household"}),e.jsx("p",{className:"text-base text-muted-foreground max-w-md",children:"Track members, preferences, and safety settings in one place"})]}),e.jsx("div",{className:"relative w-48 h-48 lg:w-56 lg:h-56 flex-shrink-0",children:e.jsxs("svg",{viewBox:"0 0 200 200",className:"w-full h-full",children:[e.jsx("circle",{cx:"70",cy:"100",r:"45",fill:"url(#gradient-primary)",opacity:"0.9"}),e.jsx("circle",{cx:"130",cy:"100",r:"42",fill:"url(#gradient-secondary)",opacity:"0.85"}),e.jsx("circle",{cx:"100",cy:"140",r:"28",fill:"url(#gradient-accent)",opacity:"0.8"}),e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"gradient-primary",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"hsl(var(--primary))"}),e.jsx("stop",{offset:"100%",stopColor:"hsl(var(--primary))",stopOpacity:"0.6"})]}),e.jsxs("linearGradient",{id:"gradient-secondary",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"hsl(var(--secondary))"}),e.jsx("stop",{offset:"100%",stopColor:"hsl(var(--secondary))",stopOpacity:"0.6"})]}),e.jsxs("linearGradient",{id:"gradient-accent",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"hsl(var(--accent))"}),e.jsx("stop",{offset:"100%",stopColor:"hsl(var(--accent))",stopOpacity:"0.6"})]})]})]})})]})});function Ge(s){const d=s.split("").reduce((p,f)=>p+f.charCodeAt(0),0),h=[["#D69E2E","#70E098"],["#70E098","#38BDF8"],["#38BDF8","#D97757"],["#D97757","#D69E2E"]],l=h[d%h.length],c=["gradient","circles","waves","triangles"],i=c[Math.floor(d/10)%c.length];return{colors:l,pattern:i}}const de=({name:s,size:d="md"})=>{const h={sm:"w-10 h-10 text-sm",md:"w-14 h-14 text-base",lg:"w-18 h-18 text-xl"},l=o.useMemo(()=>Ge(s||"User"),[s]),c=(s||"U").charAt(0).toUpperCase();return e.jsxs("div",{className:`${h[d]} rounded-full overflow-hidden flex items-center justify-center relative flex-shrink-0`,children:[e.jsxs("svg",{viewBox:"0 0 100 100",className:"w-full h-full absolute inset-0",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:`grad-${s}-${l.pattern}`,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:l.colors[0]}),e.jsx("stop",{offset:"100%",stopColor:l.colors[1]})]})}),l.pattern==="gradient"&&e.jsx("rect",{width:"100",height:"100",fill:`url(#grad-${s}-${l.pattern})`}),l.pattern==="circles"&&e.jsxs(e.Fragment,{children:[e.jsx("rect",{width:"100",height:"100",fill:l.colors[0]}),e.jsx("circle",{cx:"30",cy:"30",r:"25",fill:l.colors[1],opacity:"0.6"}),e.jsx("circle",{cx:"70",cy:"70",r:"25",fill:l.colors[1],opacity:"0.4"})]}),l.pattern==="waves"&&e.jsxs(e.Fragment,{children:[e.jsx("rect",{width:"100",height:"100",fill:l.colors[0]}),e.jsx("path",{d:"M0,50 Q25,30 50,50 T100,50 L100,100 L0,100 Z",fill:l.colors[1],opacity:"0.5"})]}),l.pattern==="triangles"&&e.jsxs(e.Fragment,{children:[e.jsx("rect",{width:"100",height:"100",fill:l.colors[0]}),e.jsx("polygon",{points:"50,10 90,90 10,90",fill:l.colors[1],opacity:"0.5"})]})]}),e.jsx("span",{className:"relative z-10 font-medium text-background mix-blend-difference",children:c})]})},Be=({member:s,onClick:d})=>{var f,g,v;const h=((f=s.allergies)==null?void 0:f.length)||0,l=((g=s.dietaryRestrictions)==null?void 0:g.length)||0,c=((v=s.healthConditions)==null?void 0:v.length)||0,i=[];h>0&&i.push(`${h} ${h===1?"allergy":"allergies"}`),l>0&&i.push(`${l} ${l===1?"restriction":"restrictions"}`),c>0&&i.push(`${c} ${c===1?"condition":"conditions"}`);const p=i.length>0?i.join(" • "):"No dietary restrictions";return e.jsxs("button",{onClick:d,className:"w-full px-6 py-4 flex items-center gap-4 hover:bg-secondary/5 transition-colors text-left",children:[e.jsx(de,{name:s.name||"Unknown",size:"md"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-base font-medium text-secondary truncate",children:s.name||"Unknown Member"}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:p})]}),e.jsx(D,{className:"w-5 h-5 text-muted-foreground flex-shrink-0"})]})},Ue=({member:s,open:d,onClose:h,onEdit:l,onDelete:c})=>s?e.jsx(ae,{open:d,onOpenChange:i=>!i&&h(),children:e.jsxs(re,{side:"bottom",className:"h-[85vh] sm:h-auto sm:max-w-[500px] bg-background border-secondary/20 overflow-y-auto",children:[e.jsx(le,{className:"space-y-4 pb-6 border-b border-secondary/10",children:e.jsxs("div",{className:"flex flex-col items-center gap-4 pt-4",children:[e.jsx(de,{name:s.name||"Unknown",size:"lg"}),e.jsxs("div",{className:"text-center",children:[e.jsx(ne,{className:"text-2xl text-secondary",children:s.name||"Unknown Member"}),s.age&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Age ",s.age]})]})]})}),e.jsxs("div",{className:"space-y-6 py-6",children:[s.biometrics&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Biometrics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.biometrics.weight&&e.jsxs("div",{className:"glass-card p-3 rounded-xl",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Weight"}),e.jsxs("p",{className:"text-base font-medium text-secondary",children:[s.biometrics.weight," lbs"]})]}),s.biometrics.height&&e.jsxs("div",{className:"glass-card p-3 rounded-xl",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Height"}),e.jsxs("p",{className:"text-base font-medium text-secondary",children:[s.biometrics.height," in"]})]}),s.biometrics.gender&&e.jsxs("div",{className:"glass-card p-3 rounded-xl",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gender"}),e.jsx("p",{className:"text-base font-medium text-secondary capitalize",children:s.biometrics.gender})]}),s.biometrics.activityLevel&&e.jsxs("div",{className:"glass-card p-3 rounded-xl",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Activity"}),e.jsx("p",{className:"text-base font-medium text-secondary capitalize",children:s.biometrics.activityLevel})]})]})]}),s.dietaryRestrictions&&s.dietaryRestrictions.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Dietary Restrictions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.dietaryRestrictions.map((i,p)=>e.jsx("span",{className:"px-3 py-1 text-sm rounded-full bg-secondary/10 text-secondary",children:i},p))})]}),s.allergies&&s.allergies.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Allergies"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.allergies.map((i,p)=>e.jsxs("span",{className:"px-3 py-1 text-sm rounded-full bg-destructive/20 text-destructive flex items-center gap-1",children:[e.jsx(me,{className:"w-3 h-3"}),i]},p))})]}),s.healthConditions&&s.healthConditions.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Health Conditions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.healthConditions.map((i,p)=>e.jsx("span",{className:"px-3 py-1 text-sm rounded-full bg-accent/20 text-accent",children:i},p))})]})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t border-secondary/10",children:[e.jsxs(_,{variant:"outline",className:"flex-1 gap-2 border-secondary/20 hover:bg-accent/10",onClick:()=>{l(s),h()},children:[e.jsx(_e,{className:"w-4 h-4"}),"Edit Member"]}),e.jsxs(_,{variant:"outline",className:"flex-1 gap-2 border-destructive/20 hover:bg-destructive/10 text-destructive",onClick:()=>{c(s),h()},children:[e.jsx(ue,{className:"w-4 h-4"}),"Delete"]})]})]})}):null,Ie=({householdId:s,onGenerateInvite:d,isCreatingInvite:h=!1})=>{const{toast:l}=ce(),[c,i]=o.useState(""),[p,f]=o.useState(!1),[g,v]=o.useState(!0),[j,b]=o.useState(!0),[R,S]=o.useState(!1),[w,T]=o.useState(!1),[M,L]=o.useState(""),[C,B]=o.useState([]),[A,r]=o.useState(!1);o.useEffect(()=>{s&&(n(),E())},[s]);const n=async()=>{if(!s)return;const{data:t}=await y.from("households").select("name, owner_id").eq("id",s).single();if(t){i(t.name),L(t.name);const{data:{user:x}}=await y.auth.getUser();f(t.owner_id===(x==null?void 0:x.id))}},E=async()=>{if(!s)return;const{data:t}=await y.from("household_memberships").select(`
        id,
        user_id,
        role,
        profiles:user_id (
          user_name
        )
      `).eq("household_id",s);t&&B(t)},G=async()=>{if(!s||!M.trim())return;r(!0);const{error:t}=await y.from("households").update({name:M.trim()}).eq("id",s);t?l({title:"Error",description:"Failed to update household name",variant:"destructive"}):(i(M.trim()),S(!1),l({title:"Success",description:"Household name updated"})),r(!1)},a=async(t,x)=>{const{error:H}=await y.from("household_memberships").update({role:x}).eq("id",t);H?l({title:"Error",description:"Failed to update member role",variant:"destructive"}):(l({title:"Success",description:"Member role updated"}),E())},u=async t=>{v(t),l({title:t?"Notifications Enabled":"Notifications Disabled",description:t?"You'll receive household updates":"Household notifications muted"})},k=async t=>{b(t),l({title:t?"Safety Alerts On":"Safety Alerts Off",description:t?"You'll be alerted about allergens and toxins":"Safety alerts disabled"})},F=t=>{switch(t){case"owner":return"bg-primary/20 text-primary border-primary/30";case"admin":return"bg-accent/20 text-accent border-accent/30";default:return"bg-secondary/20 text-secondary border-secondary/30"}};return e.jsxs("section",{children:[e.jsx("h2",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider mb-3",children:"Preferences"}),e.jsxs("div",{className:"glass-card rounded-3xl overflow-hidden divide-y divide-secondary/10",children:[e.jsxs("button",{onClick:()=>S(!0),className:"w-full px-6 py-4 flex items-center gap-4 hover:bg-secondary/5 transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-secondary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(ge,{className:"w-5 h-5 text-secondary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-base font-medium text-secondary",children:"Household Name"}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:c||"Not set"})]}),e.jsx(D,{className:"w-5 h-5 text-muted-foreground flex-shrink-0"})]}),p&&e.jsxs("button",{onClick:()=>T(!0),className:"w-full px-6 py-4 flex items-center gap-4 hover:bg-secondary/5 transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-accent/10 flex items-center justify-center flex-shrink-0",children:e.jsx(J,{className:"w-5 h-5 text-accent"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-base font-medium text-secondary",children:"Member Roles"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Manage permissions for ",C.length," ",C.length===1?"member":"members"]})]}),e.jsx(D,{className:"w-5 h-5 text-muted-foreground flex-shrink-0"})]}),e.jsxs("div",{className:"w-full px-6 py-4 flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-secondary/10 flex items-center justify-center flex-shrink-0",children:g?e.jsx(Me,{className:"w-5 h-5 text-secondary"}):e.jsx(Oe,{className:"w-5 h-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-base font-medium text-secondary",children:"Household Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:g?"Get updates on household activity":"Notifications muted"})]}),e.jsx(se,{checked:g,onCheckedChange:u,className:"flex-shrink-0"})]}),e.jsxs("div",{className:"w-full px-6 py-4 flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-destructive/10 flex items-center justify-center flex-shrink-0",children:e.jsx(J,{className:"w-5 h-5 text-destructive"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-base font-medium text-secondary",children:"Safety Alerts"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:j?"Alert on allergens and toxins":"Safety alerts off"})]}),e.jsx(se,{checked:j,onCheckedChange:k,className:"flex-shrink-0"})]}),e.jsxs("div",{className:"px-6 py-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex -space-x-2",children:[C.slice(0,3).map((t,x)=>{var H,X,Z;return e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-primary to-secondary border-2 border-background flex items-center justify-center text-xs font-bold text-background",children:((Z=(X=(H=t.profiles)==null?void 0:H.user_name)==null?void 0:X[0])==null?void 0:Z.toUpperCase())||"?"},t.id)}),C.length>3&&e.jsxs("div",{className:"w-8 h-8 rounded-full bg-muted border-2 border-background flex items-center justify-center text-xs text-muted-foreground",children:["+",C.length-3]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-base font-medium text-secondary",children:"Invite Members"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Share household access"})]})]}),e.jsx(_,{onClick:d,disabled:!s||h,className:"w-full gap-2",variant:"default",children:h?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-4 h-4 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"w-4 h-4"}),"Generate Invite Link"]})}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-secondary/10",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"How it works"}),e.jsxs("div",{className:"space-y-1.5 text-xs text-muted-foreground",children:[e.jsx("p",{children:"• Share inventory across devices"}),e.jsx("p",{children:"• Coordinate shopping lists"}),e.jsx("p",{children:"• Sync dietary restrictions"})]})]})]})]}),e.jsx(V,{open:R,onOpenChange:S,children:e.jsxs(K,{className:"bg-background border-secondary/20",children:[e.jsxs(W,{children:[e.jsx(Y,{className:"text-secondary",children:"Edit Household Name"}),e.jsx(Q,{className:"text-muted-foreground",children:"Give your household a memorable name"})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"household-name",className:"text-secondary",children:"Household Name"}),e.jsx(O,{id:"household-name",value:M,onChange:t=>L(t.target.value),placeholder:"e.g., The Smith Family",className:"border-secondary/20"})]})}),e.jsxs(ye,{children:[e.jsx(_,{variant:"outline",onClick:()=>S(!1),className:"border-secondary/20",children:"Cancel"}),e.jsx(_,{onClick:G,disabled:A||!M.trim(),className:"bg-primary hover:bg-primary/90",children:A?"Saving...":"Save"})]})]})}),e.jsx(ae,{open:w,onOpenChange:T,children:e.jsxs(re,{className:"bg-background border-secondary/20 w-full sm:max-w-lg overflow-y-auto",children:[e.jsxs(le,{children:[e.jsx(ne,{className:"text-secondary",children:"Member Roles"}),e.jsx(fe,{className:"text-muted-foreground",children:"Manage permissions for household members"})]}),e.jsx("div",{className:"mt-6 space-y-4",children:C.map(t=>{var x;return e.jsxs("div",{className:"glass-card p-4 rounded-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-secondary/10 flex items-center justify-center",children:e.jsx(oe,{className:"w-5 h-5 text-secondary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-base font-medium text-secondary",children:((x=t.profiles)==null?void 0:x.user_name)||"Unknown User"}),e.jsx(q,{variant:"outline",className:`text-xs ${F(t.role)}`,children:t.role})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{className:"text-sm text-muted-foreground",children:"Role"}),e.jsxs(U,{value:t.role,onValueChange:H=>a(t.id,H),children:[e.jsx(I,{className:"border-secondary/20",children:e.jsx($,{})}),e.jsxs(P,{children:[e.jsx(m,{value:"member",children:"Member"}),e.jsx(m,{value:"admin",children:"Admin"}),e.jsx(m,{value:"owner",children:"Owner"})]})]})]}),e.jsxs("div",{className:"mt-3 text-xs text-muted-foreground",children:[t.role==="owner"&&"Full control over household",t.role==="admin"&&"Can manage members and settings",t.role==="member"&&"Can view and edit household data"]})]},t.id)})})]})})]})},rs=()=>{const s=he(),{toast:d}=ce(),[h,l]=o.useState([]),[c,i]=o.useState(!0),[p,f]=o.useState(!1),[g,v]=o.useState(null),[j,b]=o.useState(null),[R,S]=o.useState(null),[w,T]=o.useState(null),[M,L]=o.useState(!1),C=Re();o.useEffect(()=>{A(),B();const a=y.channel("household-members-changes").on("postgres_changes",{event:"*",schema:"public",table:"household_members"},()=>{A()}).subscribe();return()=>{y.removeChannel(a)}},[]);const B=async()=>{const{data:{session:a}}=await y.auth.getSession();if(!(a!=null&&a.user))return;const{data:u}=await y.from("profiles").select("*").eq("id",a.user.id).single();T(u)},A=async()=>{i(!0);const{data:{session:a}}=await y.auth.getSession();if(!(a!=null&&a.user)){s("/auth");return}const{data:u,error:k}=await y.from("household_members").select("*").eq("user_id",a.user.id).order("created_at",{ascending:!0});if(k)console.error("Error fetching household members:",k),d({title:"Error",description:"Failed to load household members",variant:"destructive"});else{const F=(u||[]).map(t=>({id:t.id,user_id:t.user_id,type:t.member_type,name:t.name||void 0,ageGroup:t.age_group,age:t.age||void 0,biometrics:{weight:t.weight||void 0,height:t.height||void 0,gender:t.gender||void 0,activityLevel:t.activity_level||void 0},allergies:Array.isArray(t.allergies)?t.allergies.map(x=>String(x)):[],dietaryRestrictions:Array.isArray(t.dietary_restrictions)?t.dietary_restrictions.map(x=>String(x)):[],healthConditions:Array.isArray(t.health_conditions)?t.health_conditions.map(x=>String(x)):[],created_at:t.created_at,updated_at:t.updated_at}));l(F)}i(!1)},r=async a=>{var F,t,x,H;const{data:{session:u}}=await y.auth.getSession();if(!(u!=null&&u.user))return;const{error:k}=await y.from("household_members").insert({user_id:u.user.id,member_type:a.type,name:a.name||null,age:a.age||null,age_group:a.ageGroup||null,weight:((F=a.biometrics)==null?void 0:F.weight)||null,height:((t=a.biometrics)==null?void 0:t.height)||null,gender:((x=a.biometrics)==null?void 0:x.gender)||null,activity_level:((H=a.biometrics)==null?void 0:H.activityLevel)||null,dietary_restrictions:a.dietaryRestrictions||[],allergies:a.allergies||[],health_conditions:a.healthConditions||[]});k?d({title:"Error",description:"Failed to add household member",variant:"destructive"}):(d({title:"Success",description:`${a.name||"Member"} added to your household`}),f(!1),A())},n=async a=>{var k,F,t,x;if(!g)return;const{error:u}=await y.from("household_members").update({member_type:a.type,name:a.name||null,age:a.age||null,age_group:a.ageGroup||null,weight:((k=a.biometrics)==null?void 0:k.weight)||null,height:((F=a.biometrics)==null?void 0:F.height)||null,gender:((t=a.biometrics)==null?void 0:t.gender)||null,activity_level:((x=a.biometrics)==null?void 0:x.activityLevel)||null,dietary_restrictions:a.dietaryRestrictions||[],allergies:a.allergies||[],health_conditions:a.healthConditions||[]}).eq("id",g.id);u?d({title:"Error",description:"Failed to update household member",variant:"destructive"}):(d({title:"Success",description:`${a.name||"Member"} updated successfully`}),v(null),A())},E=async()=>{if(!j)return;const{error:a}=await y.from("household_members").delete().eq("id",j.id);a?d({title:"Error",description:"Failed to delete household member",variant:"destructive"}):(d({title:"Success",description:`${j.name||"Member"} removed from household`}),b(null),A())},G=async()=>{const{data:{session:a}}=await y.auth.getSession();if(a!=null&&a.user){if(!(w!=null&&w.current_household_id)){d({title:"Error",description:"No household found. Please create a household first.",variant:"destructive"});return}L(!0);try{const{data:u,error:k}=await y.functions.invoke("create-household-invite",{body:{household_id:w.current_household_id,expires_in_hours:24,max_uses:5}});if(k)throw k;u!=null&&u.invite_url&&(await navigator.clipboard.writeText(u.invite_url),d({title:"Invite Link Created",description:"Link copied to clipboard. Share it with household members!"}))}catch(u){console.error("Error creating invite:",u),d({title:"Error",description:u.message||"Failed to create invite link",variant:"destructive"})}finally{L(!1)}}};return e.jsxs(Ae,{children:[e.jsx(Fe,{title:"Household",showHomeButton:!0}),e.jsx(Le,{swipeProgress:C.progress,swipeDirection:C.direction,children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6 space-y-6 pb-24",children:[e.jsx(Te,{}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider mb-3",children:"Members"}),c?e.jsx("div",{className:"glass-card rounded-3xl p-12 text-center",children:e.jsx("div",{className:"text-secondary/50 animate-pulse",children:"Loading members..."})}):e.jsx("div",{className:"glass-card rounded-3xl overflow-hidden divide-y divide-secondary/10",children:h.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(oe,{className:"w-12 h-12 text-secondary/30 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"No household members yet"}),e.jsxs(_,{onClick:()=>f(!0),variant:"outline",size:"sm",className:"gap-2 border-secondary/20",children:[e.jsx(ee,{className:"w-4 h-4"}),"Add First Member"]})]}):e.jsxs(e.Fragment,{children:[h.map(a=>e.jsx(Be,{member:a,onClick:()=>S(a)},a.id)),e.jsxs("button",{onClick:()=>f(!0),className:"w-full px-6 py-4 flex items-center gap-4 hover:bg-secondary/5 transition-colors",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(ee,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"text-base font-medium text-primary",children:"Add New Member"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["You have ",h.length," ",h.length===1?"member":"members"]})]})]})]})})]}),e.jsx(Ie,{householdId:w==null?void 0:w.current_household_id,onGenerateInvite:G,isCreatingInvite:M}),e.jsxs(ie.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"glass-card p-6 rounded-3xl border border-accent/20",children:[e.jsx("h3",{className:"text-lg font-medium text-secondary mb-2",children:"Why add household members?"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-accent mt-0.5",children:"•"}),e.jsx("span",{children:"Get personalized safety alerts for each family member's allergies and conditions"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-accent mt-0.5",children:"•"}),e.jsx("span",{children:"Filter products and recipes based on everyone's dietary needs"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-accent mt-0.5",children:"•"}),e.jsx("span",{children:"Track nutrition goals customized for each person's activity level and health"})]})]})]})]})}),e.jsx(He,{}),e.jsx(Ue,{member:R,open:!!R,onClose:()=>S(null),onEdit:a=>{v(a),S(null)},onDelete:a=>{b(a),S(null)}}),e.jsx(V,{open:p,onOpenChange:f,children:e.jsxs(K,{className:"sm:max-w-2xl bg-background border-secondary/20 max-h-[90vh] overflow-y-auto",children:[e.jsxs(W,{children:[e.jsx(Y,{className:"text-secondary",children:"Add Household Member"}),e.jsx(Q,{className:"text-secondary/70",children:"Create a detailed profile for your family member"})]}),e.jsx(te,{onSubmit:r,onCancel:()=>f(!1)})]})}),e.jsx(V,{open:!!g,onOpenChange:a=>!a&&v(null),children:e.jsxs(K,{className:"sm:max-w-2xl bg-background border-secondary/20 max-h-[90vh] overflow-y-auto",children:[e.jsxs(W,{children:[e.jsx(Y,{className:"text-secondary",children:"Edit Household Member"}),e.jsxs(Q,{className:"text-secondary/70",children:["Update ",(g==null?void 0:g.name)||"this member","'s profile"]})]}),g&&e.jsx(te,{initialData:g,onSubmit:n,onCancel:()=>v(null)})]})}),e.jsx(je,{open:!!j,onOpenChange:a=>!a&&b(null),children:e.jsxs(ve,{className:"bg-background border-secondary/20",children:[e.jsxs(Ne,{children:[e.jsx(be,{className:"text-secondary",children:"Delete Household Member"}),e.jsxs(we,{className:"text-secondary/70",children:["Are you sure you want to remove ",(j==null?void 0:j.name)||"this member"," from your household? This action cannot be undone."]})]}),e.jsxs(Ce,{children:[e.jsx(ke,{className:"border-secondary/20",children:"Cancel"}),e.jsx(Se,{onClick:E,className:"bg-destructive hover:bg-destructive/90 text-background",children:"Delete"})]})]})})]})};export{rs as default};

import{j as e}from"./ui-vendor-CRu_cuPE.js";import{r as c,u as be}from"./react-vendor-DwZQO67Z.js";import{A as we}from"./AppShell-DVt8-4f8.js";import{d as V,a as ne,S as re,l as oe,m as le,n as ce,B as x,X as ke,L as ae,I as Se,aQ as Z,s as w,O as H,o as S,j as P,G as O,aR as ie,q as L,a4 as Ce,aS as _e,aT as Te,aU as G,i as Re,D as qe,e as Le,f as Me,g as Ae,aN as ze,T as Pe,aV as Ie,ar as Ve}from"./index-D4bhw5kJ.js";import{S as $e}from"./switch-_hpo76TP.js";import{S as J}from"./share-2-ChFTP5nb.js";import{m as I,A as Fe}from"./animation-vendor-C-lCNj7M.js";import{T as de}from"./trending-up-0sWaYDAK.js";import{U as me}from"./users-DudXFJtM.js";import{C as De}from"./checkbox-CEYRQozO.js";import{u as Ee,E as he}from"./VoiceAssistantContext-C3VUdkqs.js";import{C as B}from"./card-q-j3zA9P.js";import{P as Ue}from"./ProgressRing-DCnvmyFG.js";import{A as W}from"./arrow-left-CQcT7sCo.js";import{T as He,a as Oe,b as K,c as Be}from"./tabs-C9GQepe1.js";import{u as Qe}from"./useSwipeNavigation-FVKdXjvo.js";import{P as Ye}from"./PageTransition-DTafOOMG.js";import"./scan-rfUsMt4r.js";import"./UniversalShell-B176IQVx.js";import"./trending-down-D_vIl22O.js";import"./leaf-DXJ1a3o-.js";import"./chart-vendor-BDCxrQ3h.js";import"./supabase-vendor-BS1x--yE.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=V("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=V("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=V("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=V("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=V("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=V("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=V("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=V("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),xe=({open:s,onClose:m,recipeId:p,recipeName:o,isPublic:t,shareToken:h})=>{const{toast:i}=ne(),[l,v]=c.useState(t),[N,r]=c.useState(h),[d,k]=c.useState(!1),[g,n]=c.useState(!1),C=()=>`recipe_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,T=async y=>{n(!0);const _=y&&!N?C():N,{error:b}=await w.from("recipes").update({is_public:y,share_token:_,shared_at:y?new Date().toISOString():null}).eq("id",p);n(!1),b?i({title:"Error",description:"Failed to update recipe sharing settings",variant:"destructive"}):(v(y),r(_),i({title:y?"Recipe Published":"Recipe Unpublished",description:y?"Your recipe is now publicly accessible":"Your recipe is now private"}))},R=N?`${window.location.origin}/recipe/${N}`:"",u=async()=>{R&&(await navigator.clipboard.writeText(R),k(!0),i({title:"Link Copied",description:"Recipe link copied to clipboard"}),setTimeout(()=>k(!1),2e3))},f=async()=>{if(navigator.share&&R)try{await navigator.share({title:o,text:`Check out this recipe: ${o}`,url:R})}catch(y){console.log("Share cancelled or failed:",y)}};return e.jsx(re,{open:s,onOpenChange:m,children:e.jsxs(oe,{side:"bottom",className:"h-[60vh]",children:[e.jsxs(le,{className:"flex flex-row items-center justify-between border-b border-border/10 pb-4",children:[e.jsx(ce,{className:"text-xl font-semibold text-foreground",children:"Share Recipe"}),e.jsx(x,{variant:"ghost",size:"icon",onClick:m,children:e.jsx(ke,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsx("div",{className:"glass-card p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ae,{className:"text-foreground font-medium",children:"Make Public"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow anyone with the link to view this recipe"})]}),e.jsx($e,{checked:l,onCheckedChange:T,disabled:g})]})}),l&&R&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(ae,{className:"text-sm text-muted-foreground",children:"Share Link"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Se,{value:R,readOnly:!0,className:"flex-1 bg-muted/50"}),e.jsx(x,{onClick:u,variant:"outline",size:"icon",children:d?e.jsx(Z,{className:"w-4 h-4 text-secondary"}):e.jsx(Ge,{className:"w-4 h-4"})})]})]}),navigator.share&&e.jsxs(x,{onClick:f,className:"w-full",variant:"outline",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Share via..."]}),e.jsx("div",{className:"glass-card p-4 bg-accent/5",children:e.jsx("p",{className:"text-xs text-muted-foreground",children:"Anyone with this link can view the recipe, but they won't be able to edit or delete it."})})]})]})]})})},es=({recipe:s,onClick:m})=>{const[p,o]=c.useState(!1),t=s.match_score||0,h=l=>l>=80?"bg-secondary/10 text-secondary border-secondary/20":l>=50?"bg-primary/10 text-primary border-primary/20":"bg-destructive/10 text-destructive border-destructive/20",i=l=>{switch(l==null?void 0:l.toLowerCase()){case"easy":return"bg-secondary/10 text-secondary";case"medium":return"bg-primary/10 text-primary";case"hard":return"bg-destructive/10 text-destructive";default:return"bg-muted text-muted-foreground"}};return e.jsxs(I.div,{variants:{hidden:{opacity:0,y:20},show:{opacity:1,y:0}},whileHover:{y:-4},whileTap:{scale:.98},onClick:m,className:"bg-card/50 backdrop-blur-sm border border-border/50 rounded-xl p-6 hover:bg-card/70 transition-all cursor-pointer group",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2 group-hover:text-primary transition-colors",children:s.name})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:l=>{l.stopPropagation(),o(!0)},className:"opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(J,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(H,{className:"w-6 h-6 text-primary"})})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs(S,{variant:"outline",className:P("text-sm font-medium",h(t)),children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),t,"% Match"]})}),s.explanation&&e.jsx("div",{className:"mb-4 p-3 rounded-lg bg-background/30 border border-border/30",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-semibold text-foreground",children:"Why this recipe: "}),s.explanation]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[s.cooking_time&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.cooking_time,"m"]})]}),s.servings&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{children:s.servings})]}),s.estimated_calories&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.estimated_calories," cal"]})]}),s.difficulty&&e.jsx(S,{variant:"outline",className:P("capitalize",i(s.difficulty)),children:s.difficulty}),p&&e.jsx(xe,{open:p,onClose:()=>o(!1),recipeId:s.id,recipeName:s.name,isPublic:!1,shareToken:null})]})},ss=({onNext:s,onPrevious:m,onRepeat:p,onTimer:o})=>{const[t,h]=c.useState(!1),i=c.useRef(null),l=c.useRef(null);c.useEffect(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const g=window.webkitSpeechRecognition||window.SpeechRecognition;i.current=new g,i.current.continuous=!0,i.current.interimResults=!1,i.current.lang="en-US",i.current.onresult=n=>{const C=n.results.length-1,T=n.results[C][0].transcript.toLowerCase().trim();console.log("Voice command:",T),v(T)},i.current.onerror=n=>{console.error("Speech recognition error:",n.error),n.error==="no-speech"&&t&&i.current&&i.current.start()},i.current.onend=()=>{if(t&&i.current)try{i.current.start()}catch(n){console.error("Error restarting recognition:",n)}}}return"speechSynthesis"in window&&(l.current=window.speechSynthesis),()=>{i.current&&i.current.stop(),l.current&&l.current.cancel()}},[]);const v=g=>{if(g.includes("next")||g.includes("continue")){s();return}if(g.includes("previous")||g.includes("back")||g.includes("go back")){m();return}if(g.includes("repeat")||g.includes("again")||g.includes("say that again")){p();return}const n=g.match(/timer\s+(\d+)/i)||g.match(/set\s+timer\s+(\d+)/i)||g.match(/(\d+)\s+minute/i);if(n&&n[1]){const C=parseInt(n[1],10);!isNaN(C)&&C>0&&C<=120&&o(C);return}},N=c.useCallback(()=>{if(i.current&&!t)try{i.current.start(),h(!0)}catch(g){console.error("Error starting recognition:",g)}},[t]),r=c.useCallback(()=>{i.current&&t&&(i.current.stop(),h(!1))},[t]),d=c.useCallback(g=>{if(l.current){l.current.cancel();const n=new SpeechSynthesisUtterance(g);n.rate=.9,n.pitch=1,n.volume=1,l.current.speak(n)}},[]),k=c.useCallback(()=>{l.current&&l.current.cancel()},[]);return{isListening:t,startListening:N,stopListening:r,speak:d,stopSpeaking:k}},ts=({minutes:s,onSetTimer:m})=>e.jsxs(x,{variant:"outline",size:"sm",onClick:p=>{p.stopPropagation(),m()},className:"gap-2 h-8 text-xs",children:[e.jsx(O,{className:"w-3 h-3"}),s," min timer"]}),as=({stepNumber:s,instruction:m,isCompleted:p,isActive:o,onSetTimer:t,onClick:h})=>{const i=m.match(/(\d+)\s*(?:minute|min|minutes)/i),l=i?parseInt(i[1]):null,v=N=>N.replace(/(\d+(?:\.\d+)?)\s*(Â°[CF]|degrees|cups?|tbsp|tsp|oz|lb|g|kg|ml|L)/gi,'<strong class="text-accent font-semibold">$1$2</strong>');return e.jsx(B,{onClick:h,className:P("p-4 cursor-pointer transition-all",o&&"border-primary bg-primary/5",p&&"opacity-60"),children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:P("flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center font-bold",p?"bg-secondary text-secondary-foreground":o?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"),children:p?e.jsx(Z,{className:"w-5 h-5"}):s}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("p",{className:P("text-base leading-relaxed",o?"text-foreground font-medium":"text-muted-foreground"),dangerouslySetInnerHTML:{__html:v(m)}}),p&&e.jsx(S,{variant:"outline",className:"bg-secondary/20",children:"Done"})]}),l&&t&&!p&&e.jsx(ts,{minutes:l,onSetTimer:()=>t(l)})]})]})})},is=({open:s,onOpenChange:m,recipeName:p,onTakePhoto:o,onAskQuestion:t,relatedRecipes:h=[]})=>e.jsx(re,{open:s,onOpenChange:m,children:e.jsxs(oe,{side:"bottom",className:"h-[80vh]",children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-primary"}),"Great job cooking ",p,"!"]})}),e.jsxs("div",{className:"space-y-6 mt-6",children:[e.jsx(B,{className:"p-6 bg-card/50",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"mx-auto w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(ie,{className:"w-8 h-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"How did it turn out?"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Share a photo of your creation"}),e.jsxs(x,{onClick:o,className:"gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Take Photo"]})]})]})}),e.jsx(B,{className:"p-4 bg-card/50",children:e.jsxs("button",{onClick:t,className:"w-full flex items-center gap-3 p-3 rounded-lg hover:bg-accent/50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-accent/20 flex items-center justify-center",children:e.jsx(ue,{className:"w-5 h-5 text-accent"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"font-medium text-sm",children:"Ask Kaeva anything"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Get tips, substitutions, or cooking advice"})]})]})}),h.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold mb-3 text-muted-foreground",children:"Similar Recipes"}),e.jsx("div",{className:"space-y-2",children:h.slice(0,3).map(i=>e.jsx(B,{className:"p-3 bg-card/50 hover:bg-card/70 cursor-pointer transition-colors",children:e.jsx("p",{className:"text-sm font-medium",children:i.name})},i.id))})]})]})]})}),ns=({recipe:s,onComplete:m,onBack:p})=>{const o=Array.isArray(s.instructions)?s.instructions:[],[t,h]=c.useState(0),[i,l]=c.useState(new Set),[v,N]=c.useState(null),[r,d]=c.useState(!1),[k,g]=c.useState(!1),[n,C]=c.useState(!1),[T,R]=c.useState("single"),[u,f]=c.useState(!1),{startConversation:y}=Ee(),{startListening:_,stopListening:b,speak:$,stopSpeaking:pe}=ss({onNext:ee,onPrevious:se,onRepeat:te,onTimer:Q});c.useEffect(()=>{let a;return r&&v!==null&&v>0&&(a=setInterval(()=>{N(j=>j===null||j<=1?(d(!1),L.success("Timer completed!",{duration:5e3}),n&&$("Timer is done!"),0):j-1)},1e3)),()=>clearInterval(a)},[r,v,n]),c.useEffect(()=>{if(n&&o[t]){const a=o[t].instruction||o[t].text||"";$(`Step ${t+1}. ${a}`)}},[t,n]);function ee(){t<o.length-1&&(l(a=>new Set([...a,t])),h(a=>a+1))}function se(){t>0&&h(a=>a-1)}function te(){if(o[t]){const a=o[t].instruction||o[t].text||"";$(`Step ${t+1}. ${a}`)}}function Q(a){N(a*60),d(!0),L.success(`Timer set for ${a} minute${a!==1?"s":""}`),n&&$(`Timer set for ${a} minute${a!==1?"s":""}`)}const ge=async()=>{f(!0);const{data:{user:a}}=await w.auth.getUser();if(!a)return;const{data:j}=await w.from("profiles").select("current_household_id").eq("id",a.id).single();if(!(j!=null&&j.current_household_id))return;const M=Array.isArray(s.ingredients)?s.ingredients:[];for(const A of M){const D=A.item||A.name||"",E=parseFloat(A.quantity||A.amount||"0");if(!D||E<=0)continue;const{data:F}=await w.from("inventory").select("*").eq("household_id",j.current_household_id).ilike("name",`%${D}%`);if(F&&F.length>0){const z=F[0],U=Math.max(0,(z.quantity||0)-E),Y=z.original_quantity?Math.round(U/z.original_quantity*100):50;await w.from("inventory").update({quantity:U,fill_level:Y,updated_at:new Date().toISOString()}).eq("id",z.id)}}f(!0)},fe=async()=>{const{data:{user:a}}=await w.auth.getUser();if(!a)return;const{data:j}=await w.from("profiles").select("current_household_id").eq("id",a.id).single();if(!(j!=null&&j.current_household_id))return;const M=Array.isArray(s.ingredients)?s.ingredients:[];for(const A of M){const D=A.item||A.name||"",E=parseFloat(A.quantity||A.amount||"0");if(!D||E<=0)continue;const{data:F}=await w.from("inventory").select("*").eq("household_id",j.current_household_id).ilike("name",`%${D}%`);if(F&&F.length>0){const z=F[0],U=Math.max(0,(z.quantity||0)-E),Y=z.original_quantity?Math.round(U/z.original_quantity*100):50;await w.from("inventory").update({quantity:U,fill_level:Y,updated_at:new Date().toISOString()}).eq("id",z.id)}}L.success("Recipe completed!"),m()},je=()=>{k?(b(),g(!1)):(_(),g(!0))},ve=()=>{n?(pe(),C(!1)):(C(!0),te())},ye=()=>{const a=o[t],j=(a==null?void 0:a.instruction)||(a==null?void 0:a.text)||"",M=`I'm cooking ${s.name}. I'm on step ${t+1}: ${j}`;y(M)},Ne=a=>{const j=Math.floor(a/60),M=a%60;return`${j}:${M.toString().padStart(2,"0")}`},q=o[t];return e.jsxs("div",{className:"fixed inset-0 z-50 bg-background",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-card/95 backdrop-blur-xl border-b border-border px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between max-w-6xl mx-auto",children:[e.jsxs(x,{variant:"ghost",onClick:p,className:"gap-2",children:[e.jsx(W,{className:"w-5 h-5"}),"Exit"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:ye,className:"gap-2 bg-primary/10 hover:bg-primary/20 border-primary/30",children:[e.jsx(ue,{className:"w-4 h-4"}),"Ask Kaeva"]}),e.jsxs(x,{variant:T==="list"?"default":"outline",size:"sm",onClick:()=>R(T==="single"?"list":"single"),className:"gap-2",children:[T==="list"?e.jsx(he,{className:"w-4 h-4"}):e.jsx(We,{className:"w-4 h-4"}),T==="list"?"Single Step":"All Steps"]}),e.jsxs(x,{variant:n?"default":"outline",size:"sm",onClick:ve,className:"gap-2",children:[n?e.jsx(Ze,{className:"w-4 h-4"}):e.jsx(Je,{className:"w-4 h-4"}),n?"Speech On":"Speech Off"]}),e.jsxs(x,{variant:k?"default":"outline",size:"sm",onClick:je,className:"gap-2",children:[k?e.jsx(Ce,{className:"w-4 h-4"}):e.jsx(_e,{className:"w-4 h-4"}),k?"Listening":"Voice Control"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Ue,{value:i.size,max:o.length,label:"Steps",size:"sm"})})]})]})}),e.jsx("div",{className:"h-[calc(100vh-80px)] overflow-y-auto",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-6 py-12",children:[v!==null&&e.jsx(I.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8 p-6 bg-card rounded-xl border border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Xe,{className:P("w-6 h-6",r&&"animate-pulse text-primary")}),e.jsx("span",{className:"text-3xl font-bold font-mono",children:Ne(v)})]}),e.jsx(x,{variant:r?"outline":"default",onClick:()=>d(!r),children:r?"Pause":"Start"})]})}),T==="single"?e.jsx(Fe,{mode:"wait",children:e.jsxs(I.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"mb-12",children:[e.jsxs(S,{variant:"outline",className:"mb-6 text-lg px-4 py-2",children:["Step ",t+1]}),e.jsx("p",{className:"text-5xl md:text-6xl font-bold leading-tight text-foreground mb-8",children:(q==null?void 0:q.instruction)||(q==null?void 0:q.text)||q}),(q==null?void 0:q.duration)&&e.jsxs(x,{variant:"outline",onClick:()=>Q(parseInt(q.duration)),className:"gap-2 mb-6",children:[e.jsx(O,{className:"w-4 h-4"}),"Set Timer: ",q.duration," min"]})]},t)}):e.jsx("div",{className:"space-y-3 mb-12",children:o.map((a,j)=>{const M=(a==null?void 0:a.instruction)||(a==null?void 0:a.text)||a||"";return e.jsx(as,{stepNumber:j+1,instruction:M,isCompleted:i.has(j),isActive:t===j,onSetTimer:Q,onClick:()=>h(j)},j)})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(x,{variant:"outline",size:"lg",onClick:se,disabled:t===0,className:"flex-1 gap-2 text-lg py-8",children:[e.jsx(W,{className:"w-5 h-5"}),"Previous"]}),t===o.length-1?e.jsxs(x,{size:"lg",onClick:ge,className:"flex-1 gap-2 text-lg py-8",children:[e.jsx(Z,{className:"w-5 h-5"}),"Finish Cooking"]}):e.jsxs(x,{size:"lg",onClick:ee,className:"flex-1 gap-2 text-lg py-8",children:["Next Step",e.jsx(Te,{className:"w-5 h-5"})]})]}),k&&e.jsxs(I.div,{initial:{opacity:0},animate:{opacity:1},className:"mt-8 p-4 bg-card rounded-lg border border-border",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2 font-medium",children:"Voice Commands:"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm",children:[e.jsx(S,{variant:"outline",children:'"Next"'}),e.jsx(S,{variant:"outline",children:'"Previous" or "Back"'}),e.jsx(S,{variant:"outline",children:'"Repeat"'}),e.jsx(S,{variant:"outline",children:'"Timer [minutes]"'})]})]})]})}),e.jsx(is,{open:u,onOpenChange:a=>{a||fe(),f(a)},recipeName:s.name,onTakePhoto:()=>{L.info("Camera feature coming soon!")},onAskQuestion:()=>{f(!1),L.info("Voice assistant coming soon!")},relatedRecipes:[]})]})},rs=({recipeName:s})=>{const[m,p]=c.useState([]),[o,t]=c.useState(!1),[h,i]=c.useState(!1),{toast:l}=ne(),v=async()=>{t(!0),i(!0);try{const{data:r,error:d}=await w.functions.invoke("search-recipe-videos",{body:{recipeName:s,maxResults:3}});if(d)throw d;r!=null&&r.videos&&p(r.videos)}catch(r){console.error("Error fetching videos:",r),l({title:"Failed to load videos",description:"Unable to fetch video tutorials",variant:"destructive"})}finally{t(!1)}},N=r=>{window.open(`https://www.youtube.com/watch?v=${r}`,"_blank")};return!h&&!o?e.jsx("div",{className:"backdrop-blur-xl bg-white/5 border border-white/10 rounded-xl p-6 overflow-hidden",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-destructive/10 flex items-center justify-center",children:e.jsx(G,{className:"w-5 h-5 text-destructive"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Video Tutorials"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Watch step-by-step guides"})]})]}),e.jsxs(x,{size:"sm",variant:"outline",onClick:v,className:"gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Find Videos"]})]})}):o?e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"backdrop-blur-xl bg-white/5 border border-white/10 rounded-xl p-6 overflow-hidden",children:e.jsxs("div",{className:"flex items-center justify-center gap-3 text-muted-foreground",children:[e.jsx(Re,{size:"sm"}),e.jsx("span",{className:"text-sm",children:"Searching for video tutorials..."})]})}):m.length===0&&h?e.jsx("div",{className:"backdrop-blur-xl bg-white/5 border border-white/10 rounded-xl p-6 overflow-hidden",children:e.jsxs("div",{className:"text-center",children:[e.jsx(G,{className:"w-10 h-10 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"No video tutorials found"}),e.jsx(x,{size:"sm",variant:"outline",onClick:v,children:"Try Again"})]})}):e.jsxs(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-destructive"}),e.jsx("h3",{className:"text-xs font-bold tracking-widest text-slate-500 uppercase",children:"Video Tutorials"})]}),e.jsx(x,{variant:"ghost",size:"sm",onClick:v,className:"text-xs text-muted-foreground hover:text-foreground",children:"Refresh"})]}),e.jsx("div",{className:"space-y-3",children:m.map((r,d)=>e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:d*.1},onClick:()=>N(r.videoId),className:"backdrop-blur-xl bg-white/5 border border-white/10 rounded-xl p-4 overflow-hidden cursor-pointer hover:bg-white/10 transition-all group",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative flex-shrink-0 w-32 h-20 rounded-lg overflow-hidden bg-background/50",children:[e.jsx("img",{src:r.thumbnail,alt:r.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(X,{className:"w-8 h-8 text-white",fill:"white"})}),e.jsx("div",{className:"absolute bottom-1 right-1 bg-black/80 text-white text-xs px-1.5 py-0.5 rounded",children:r.duration})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-semibold text-foreground mb-1 line-clamp-2 group-hover:text-destructive transition-colors",children:r.title}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2 truncate",children:r.channelTitle}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"}),e.jsx("span",{children:r.viewCount})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"w-3 h-3"}),e.jsx("span",{children:r.duration})]})]})]})]})},r.videoId))})]})},os=({recipe:s,open:m,onClose:p,onRecipeDeleted:o})=>{const[t,h]=c.useState(!1),[i,l]=c.useState(!1),[v,N]=c.useState(new Set),[r,d]=c.useState([]);c.useEffect(()=>{m&&k()},[m]);const k=async()=>{const{data:{user:u}}=await w.auth.getUser();if(!u)return;const{data:f}=await w.from("profiles").select("current_household_id").eq("id",u.id).single();if(!(f!=null&&f.current_household_id))return;const{data:y}=await w.from("inventory").select("*").eq("household_id",f.current_household_id);y&&d(y)},g=Array.isArray(s.ingredients)?s.ingredients:[],n=g.filter(u=>!r.some(y=>{var _,b;return y.name.toLowerCase().includes(((_=u.item)==null?void 0:_.toLowerCase())||((b=u.name)==null?void 0:b.toLowerCase())||"")})),C=async()=>{if(n.length===0){L.info("All ingredients are in your inventory!");return}const{data:{user:u}}=await w.auth.getUser();if(!u)return;const{data:f}=await w.from("profiles").select("current_household_id").eq("id",u.id).single();if(!(f!=null&&f.current_household_id)){L.error("No household found");return}const y=n.map(b=>({household_id:f.current_household_id,item_name:b.item||b.name||"Unknown",quantity:parseFloat(b.quantity)||1,unit:b.unit||"",source:"recipe",priority:"normal",status:"pending"})),{error:_}=await w.from("shopping_list").insert(y);_?L.error("Failed to add items to cart"):L.success(`${n.length} items added to shopping list`)},T=async()=>{if(!confirm(`Delete "${s.name}"?`))return;const{error:u}=await w.from("recipes").delete().eq("id",s.id);u?L.error("Failed to delete recipe"):(L.success("Recipe deleted"),o())},R=s.match_score||0;return t?e.jsx(ns,{recipe:s,onComplete:()=>{h(!1),p()},onBack:()=>h(!1)}):e.jsxs(qe,{open:m,onOpenChange:p,children:[e.jsxs(Le,{className:"max-w-4xl max-h-[90vh] overflow-y-auto overflow-hidden",children:[e.jsx(Me,{children:e.jsxs(Ae,{className:"text-3xl font-bold flex items-center gap-3 truncate",children:[e.jsx(H,{className:"w-8 h-8 text-primary flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.name})]})}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs(S,{variant:"outline",className:P("text-sm",R>=80?"bg-emerald-500/10 text-emerald-600 border-emerald-500/20":R>=50?"bg-amber-500/10 text-amber-600 border-amber-500/20":"bg-destructive/10 text-destructive border-destructive/20"),children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),R,"% Match"]}),s.cooking_time&&e.jsxs(S,{variant:"outline",className:"gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),s.cooking_time," min"]}),s.servings&&e.jsxs(S,{variant:"outline",className:"gap-2",children:[e.jsx(me,{className:"w-4 h-4"}),s.servings," servings"]}),s.difficulty&&e.jsx(S,{variant:"outline",className:"capitalize",children:s.difficulty}),s.estimated_calories&&e.jsxs(S,{variant:"outline",children:[s.estimated_calories," cal"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Ingredients"}),n.length>0&&e.jsxs(x,{variant:"outline",size:"sm",onClick:C,className:"gap-2",children:[e.jsx(ze,{className:"w-4 h-4"}),"Add ",n.length," Missing to Cart"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:g.map((u,f)=>{const y=r.some(_=>{var b,$;return _.name.toLowerCase().includes(((b=u.item)==null?void 0:b.toLowerCase())||(($=u.name)==null?void 0:$.toLowerCase())||"")});return e.jsxs("div",{className:P("flex items-center gap-3 p-3 rounded-lg border",y?"bg-emerald-500/5 border-emerald-500/20":"bg-destructive/5 border-destructive/20"),children:[e.jsx(De,{checked:v.has(f),onCheckedChange:_=>{const b=new Set(v);_?b.add(f):b.delete(f),N(b)}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:P("font-medium",v.has(f)&&"line-through opacity-50"),children:u.item||u.name||"Unknown"}),(u.quantity||u.amount)&&e.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:[u.quantity||u.amount," ",u.unit||""]})]}),e.jsx(S,{variant:y?"default":"destructive",className:"text-xs",children:y?"âœ“ Have":"âœ— Need"})]},f)})})]}),s.required_appliances&&s.required_appliances.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Required Appliances"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.required_appliances.map((u,f)=>e.jsx(S,{variant:"outline",className:"capitalize",children:u},f))})]}),e.jsx(rs,{recipeName:s.name}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsxs(x,{onClick:()=>h(!0),className:"flex-1 gap-2 text-lg py-6",size:"lg",children:[e.jsx(X,{className:"w-5 h-5"}),"Start Cooking"]}),e.jsxs(x,{variant:"outline",onClick:()=>l(!0),className:"gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Share"]}),e.jsxs(x,{variant:"destructive",onClick:T,className:"gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Delete"]})]})]})]}),i&&e.jsx(xe,{open:i,onClose:()=>l(!1),recipeId:s.id,recipeName:s.name,isPublic:!1,shareToken:null})]})},Ls=()=>{const s=be(),{recipes:m,isLoading:p,refresh:o}=Ie(),[t,h]=c.useState(null),[i,l]=c.useState("all"),v=Qe(),N=m.filter(d=>{const k=d.match_score||0;return i==="ready"?k>=80:i==="wishlist"?k<80:!0}),r=()=>{h(null),o()};return e.jsx(we,{onScan:()=>s("/"),children:e.jsx(Ye,{swipeProgress:v.progress,swipeDirection:v.direction,children:e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-7xl pb-16",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>s("/app"),className:"mr-2 rounded-full hover:bg-white/10",children:e.jsx(W,{className:"w-6 h-6"})}),e.jsxs("h1",{className:"text-4xl font-bold text-foreground flex items-center gap-3",children:[e.jsx(H,{className:"w-10 h-10 text-primary"}),"Recipe Book"]})]}),e.jsx("p",{className:"text-muted-foreground ml-14",children:"Your personalized recipe collection"})]}),e.jsxs(x,{onClick:()=>s("/"),variant:"outline",className:"gap-2",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Import Recipe"]})]}),e.jsxs(He,{value:i,onValueChange:d=>l(d),className:"mb-6",children:[e.jsxs(Oe,{className:"bg-card/50 backdrop-blur-sm border border-border/50",children:[e.jsxs(K,{value:"all",className:"gap-2",children:[e.jsx(Ke,{className:"w-4 h-4"}),"All Recipes (",m.length,")"]}),e.jsxs(K,{value:"ready",className:"gap-2",children:["âœ… Cook Now (",m.filter(d=>(d.match_score||0)>=80).length,")"]}),e.jsxs(K,{value:"wishlist",className:"gap-2",children:["ðŸ›’ Wishlist (",m.filter(d=>(d.match_score||0)<80).length,")"]})]}),p?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6",children:[1,2,3,4,5,6].map(d=>e.jsx("div",{className:"h-64 bg-card/30 rounded-xl animate-pulse"},d))}):e.jsx(Be,{value:i,className:"mt-6",children:N.length===0?e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-16",children:[e.jsx(H,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-lg text-muted-foreground mb-4",children:i==="ready"?"No recipes ready to cook yet":i==="wishlist"?"No wishlist recipes yet":"No recipes saved yet"}),e.jsx(x,{onClick:()=>s("/"),variant:"default",children:"Import Your First Recipe"})]}):e.jsx(I.div,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",initial:"hidden",animate:"show",variants:{hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.05}}},children:N.map(d=>e.jsx(es,{recipe:d,onClick:()=>h(d)},d.id))})})]}),t&&e.jsx(os,{recipe:t,open:!!t,onClose:()=>h(null),onRecipeDeleted:r})]})})})};export{Ls as default};

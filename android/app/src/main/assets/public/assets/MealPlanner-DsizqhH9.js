import{j as e}from"./ui-vendor-CRu_cuPE.js";import{r as f,u as K}from"./react-vendor-DwZQO67Z.js";import{d as G,aW as Q,aA as A,j as E,B as I,ae as X,O as R,ar as Z,s as S,D as W,e as z,f as $,g as B,aX as J,I as V,F as H,am as ee,ax as se,aY as T,aZ as L,aw as F,q as D,a as te,S as ae,l as re,m as ne,n as oe,aN as O,aq as ie,aQ as le,o as U,P as ce,L as P,X as de,aH as me,ap as he,at as Y,C as ue,aV as pe}from"./index-D4bhw5kJ.js";import{A as xe}from"./AppShell-DVt8-4f8.js";import{P as fe}from"./PageTransition-DTafOOMG.js";import{u as ge}from"./useSwipeNavigation-FVKdXjvo.js";import{C as ye}from"./card-q-j3zA9P.js";import{m as je}from"./animation-vendor-C-lCNj7M.js";import{W as ve}from"./wheat-e0e0sLVe.js";import{L as be}from"./leaf-DXJ1a3o-.js";import{C as we}from"./checkbox-CEYRQozO.js";import{C as Ne}from"./UniversalShell-B176IQVx.js";import{C as ke}from"./chevron-left-DnN1sqg3.js";import{e as Se}from"./endOfWeek-K737SY6W.js";import{a as Ce}from"./addWeeks-CNP7ZrMa.js";import"./chart-vendor-BDCxrQ3h.js";import"./supabase-vendor-BS1x--yE.js";import"./scan-rfUsMt4r.js";import"./tabs-C9GQepe1.js";import"./trending-down-D_vIl22O.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=G("Beef",[["circle",{cx:"12.5",cy:"8.5",r:"2.5",key:"9738u8"}],["path",{d:"M12.5 2a6.5 6.5 0 0 0-6.22 4.6c-1.1 3.13-.78 3.9-3.18 6.08A3 3 0 0 0 5 18c4 0 8.4-1.8 11.4-4.3A6.5 6.5 0 0 0 12.5 2Z",key:"o0f6za"}],["path",{d:"m18.5 6 2.19 4.5a6.48 6.48 0 0 1 .31 2 6.49 6.49 0 0 1-2.6 5.2C15.4 20.2 11 22 7 22a3 3 0 0 1-2.68-1.66L2.4 16.5",key:"k7p6i0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=G("Milk",[["path",{d:"M8 2h8",key:"1ssgc1"}],["path",{d:"M9 2v2.789a4 4 0 0 1-.672 2.219l-.656.984A4 4 0 0 0 7 10.212V20a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-9.789a4 4 0 0 0-.672-2.219l-.656-.984A4 4 0 0 1 15 4.788V2",key:"qtp12x"}],["path",{d:"M7 15a6.472 6.472 0 0 1 5 0 6.47 6.47 0 0 0 5 0",key:"ygeh44"}]]),q={"Gluten-Free Pasta Primavera":"https://images.unsplash.com/photo-1555949258-eb67b1ef0ceb?auto=format&fit=crop&w=800&q=80","Quinoa Salad with Avocado":"https://images.unsplash.com/photo-1512621776951-a57141f2eefd?auto=format&fit=crop&w=800&q=80","Grilled Chicken Breast":"https://images.unsplash.com/photo-1532550907401-a500c9a57435?auto=format&fit=crop&w=800&q=80","Steak with Asparagus":"https://images.unsplash.com/photo-1600891964092-4316c288032e?auto=format&fit=crop&w=800&q=80","Blueberry Pancakes":"https://images.unsplash.com/photo-1567620905732-2d1ec7ab7445?auto=format&fit=crop&w=800&q=80","Green Detox Smoothie":"https://images.unsplash.com/photo-1505252585461-04db1eb84625?auto=format&fit=crop&w=800&q=80","Salmon with Roasted Veggies":"https://images.unsplash.com/photo-1467003909585-2f8a7270028d?auto=format&fit=crop&w=800&q=80","Vegetable Stir Fry":"https://images.unsplash.com/photo-1527751171053-6f695077a054?auto=format&fit=crop&w=800&q=80"},Me=({date:c,meals:d,onAddMeal:m,onSwapMeal:j})=>{const n=Q(c),h=["Breakfast","Lunch","Dinner"],g=u=>d.find(o=>o.meal_type.toLowerCase()===u.toLowerCase()),v=u=>{const o=Object.values(q),b=u.id.charCodeAt(0)%o.length;return o[b]};return e.jsxs("div",{className:`space-y-3 ${n?"opacity-100":"opacity-90"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 px-1",children:[e.jsx("h3",{className:`font-bold text-lg ${n?"text-primary":"text-foreground"}`,children:A(c,"EEEE")}),e.jsx("span",{className:"text-muted-foreground text-sm",children:A(c,"MMM d")})]}),e.jsx("div",{className:"grid gap-3",children:h.map(u=>{var w,k;const o=g(u),b=o?v(o):null;return e.jsx(ye,{className:E("relative overflow-hidden border-0 transition-all duration-300",o?"h-32":"h-16 bg-secondary/10 hover:bg-secondary/20"),children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 bg-cover bg-center transition-transform duration-500 hover:scale-105",style:{backgroundImage:`url(${b})`}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent"}),e.jsxs("div",{className:"relative h-full p-4 flex flex-col justify-between z-10",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"text-[10px] font-bold text-white/90 uppercase tracking-wider bg-black/40 px-2 py-1 rounded-full backdrop-blur-md border border-white/10",children:u}),e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8 text-white hover:bg-white/20 rounded-full",onClick:()=>j(o),"data-testid":`swap-meal-button-${u.toLowerCase()}`,children:e.jsx(X,{className:"w-4 h-4"})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-white text-lg leading-tight line-clamp-2 shadow-sm",children:((w=o.recipes)==null?void 0:w.name)||"Unknown Recipe"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-white/80 text-xs font-medium",children:[e.jsx(R,{className:"w-3 h-3"}),e.jsx("span",{children:"25 min"}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[((k=o.recipes)==null?void 0:k.estimated_calories)||0," cal"]})]})]})]})]}):e.jsxs("div",{className:"h-full flex items-center justify-between px-4",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:u}),e.jsxs(I,{variant:"ghost",size:"sm",className:"gap-2 text-primary hover:text-primary hover:bg-primary/10",onClick:()=>m(c,u),children:[e.jsx(Z,{className:"w-4 h-4"}),"Add"]})]})},u)})})]})},De=({moods:c,selectedMood:d,onSelect:m,columns:j=4})=>e.jsx("div",{className:"grid gap-2",style:{gridTemplateColumns:`repeat(${j}, minmax(0, 1fr))`},children:c.map(n=>e.jsxs("button",{onClick:()=>m(d===n.value?"":n.value),className:E("flex flex-col items-center gap-2 p-4 rounded-xl border-2 transition-all","hover:scale-105 active:scale-95",d===n.value?"border-primary bg-primary/10":"border-border bg-card/50 hover:border-primary/50"),children:[e.jsx("span",{className:"text-3xl",children:n.emoji}),e.jsx("span",{className:E("text-xs font-serif font-medium",d===n.value?"text-primary":"text-muted-foreground"),children:n.label})]},n.value))}),Ee=[{emoji:"ðŸ¥—",label:"Light",value:"light"},{emoji:"ðŸ•",label:"Comfort",value:"comfort"},{emoji:"ðŸ’ª",label:"Protein",value:"protein"},{emoji:"ðŸŒ±",label:"Veggie",value:"veggie"}],Ae=({open:c,onClose:d,onSelect:m,mealType:j,isSubmitting:n=!1})=>{const[h,g]=f.useState([]),[v,u]=f.useState([]),[o,b]=f.useState(""),[w,k]=f.useState(null),[_,y]=f.useState(!0);f.useEffect(()=>{c&&i()},[c]),f.useEffect(()=>{let s=h;if(w&&(s=s.filter(t=>{const l=t.name.toLowerCase();switch(w){case"light":return(t.estimated_calories||0)<400;case"comfort":return l.includes("pasta")||l.includes("pizza")||l.includes("burger");case"protein":return(t.estimated_calories||0)>300&&l.includes("chicken");case"veggie":return l.includes("salad")||l.includes("vegetable");default:return!0}})),o.trim()!==""){const t=o.toLowerCase();s=s.filter(l=>l.name.toLowerCase().includes(t))}u(s)},[o,w,h]);const i=async()=>{y(!0);try{const{data:{user:s}}=await S.auth.getUser();if(!s)return;const{data:t}=await S.from("profiles").select("current_household_id").eq("id",s.id).single();if(!(t!=null&&t.current_household_id))return;const{data:l,error:a}=await S.from("recipes").select("id, name, estimated_calories, cooking_time, difficulty").eq("household_id",t.current_household_id).order("name",{ascending:!0});if(a)throw a;g(l||[]),u(l||[])}catch(s){console.error("Error fetching recipes:",s)}finally{y(!1)}},p=s=>{m(s)},r=s=>{if(q[s.name])return q[s.name];const t=Object.values(q),l=s.id.charCodeAt(0)%t.length;return t[l]};return e.jsx(W,{open:c,onOpenChange:d,children:e.jsxs(z,{className:"sm:max-w-[600px] max-h-[80vh]",children:[e.jsx($,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-primary"}),"Choose Recipe for ",j]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"What are you craving?"}),e.jsx(De,{moods:Ee,selectedMood:w,onSelect:k})]}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search recipes...",value:o,onChange:s=>b(s.target.value),className:"pl-10"})]}),e.jsx(H,{className:"h-[400px] pr-4",children:_?e.jsx("div",{className:"space-y-2",children:Array.from({length:5}).map((s,t)=>e.jsx("div",{className:"h-20 bg-card/30 rounded-lg animate-pulse"},t))}):v.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(R,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:o?"No recipes found":"No recipes saved yet"})]}):e.jsx("div",{className:"space-y-2",children:v.map(s=>e.jsxs(I,{variant:"outline",className:"w-full justify-start h-auto p-3",onClick:()=>p(s.id),disabled:n,children:[e.jsx("div",{className:"h-16 w-16 rounded-md bg-cover bg-center mr-4 shrink-0",style:{backgroundImage:`url(${r(s)})`}}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-foreground truncate",children:s.name}),n&&e.jsx(ee,{className:"w-4 h-4 animate-spin text-primary ml-2"})]}),e.jsxs("div",{className:"flex gap-3 mt-1 text-xs text-muted-foreground",children:[s.estimated_calories&&e.jsxs("span",{children:[s.estimated_calories," cal"]}),s.cooking_time&&e.jsxs("span",{children:[s.cooking_time," min"]}),s.difficulty&&e.jsx("span",{className:"capitalize",children:s.difficulty})]})]})]},s.id))})})]})})},Pe=({weekStart:c,mealPlans:d,onRefresh:m,loading:j,onWeekChange:n})=>{const[h,g]=f.useState(null),[v,u]=f.useState(!1),o=y=>d.filter(i=>F(L(i.planned_date),y)),b=(y,i)=>{g({date:y,mealType:i})},w=y=>{g({date:L(y.planned_date),mealType:y.meal_type})},k=async y=>{if(h){u(!0),console.log("Attempting to add meal:",{recipeId:y,slot:h});try{const{data:{user:i}}=await S.auth.getUser();if(!i){console.error("No user found"),D.error("You must be logged in to add meals");return}const{data:p}=await S.from("profiles").select("current_household_id").eq("id",i.id).single();if(!(p!=null&&p.current_household_id)){console.error("No household found for user"),D.error("No household found");return}const r=d.find(t=>F(L(t.planned_date),h.date)&&t.meal_type.toLowerCase()===h.mealType.toLowerCase());if(r){console.log("Deleting existing meal:",r.id);const{error:t}=await S.from("meal_plans").delete().eq("id",r.id);if(t)throw console.error("Error deleting existing meal:",t),t}console.log("Inserting new meal plan...");const{error:s}=await S.from("meal_plans").insert({user_id:i.id,household_id:p.current_household_id,recipe_id:y,planned_date:A(h.date,"yyyy-MM-dd"),meal_type:h.mealType.toLowerCase()});if(s)throw console.error("Error inserting meal plan:",s),s;console.log("Meal added successfully"),D.success(r?"Meal updated!":"Meal added to plan!"),g(null),m()}catch(i){console.error("Error in handleSelectRecipe:",i),D.error(`Failed to update meal plan: ${i.message||"Unknown error"}`)}finally{u(!1)}}},_=(y,i)=>{i.offset.x>100?(T.selection(),n("prev")):i.offset.x<-100&&(T.selection(),n("next"))};return j?e.jsx("div",{className:"space-y-4",children:Array.from({length:7}).map((y,i)=>e.jsx("div",{className:"h-48 rounded-xl animate-pulse bg-card/30"},i))}):e.jsxs(e.Fragment,{children:[e.jsx(je.div,{className:"space-y-6 pb-24",drag:"x",dragConstraints:{left:0,right:0},dragElastic:.2,onDragEnd:_,children:Array.from({length:7}).map((y,i)=>{const p=se(c,i);return e.jsx(Me,{date:p,meals:o(p),onAddMeal:b,onSwapMeal:w},i)})}),h&&e.jsx(Ae,{open:!!h,onClose:()=>g(null),onSelect:k,mealType:h.mealType,isSubmitting:v})]})},Le=c=>{const d=c.toLowerCase();return["milk","cheese","yogurt","butter","cream"].some(m=>d.includes(m))?"Dairy":["chicken","beef","pork","fish","meat","steak"].some(m=>d.includes(m))?"Meat & Seafood":["lettuce","tomato","onion","garlic","carrot","spinach","pepper","potato"].some(m=>d.includes(m))?"Produce":["flour","sugar","pasta","rice","bread","oil","spice","salt"].some(m=>d.includes(m))?"Pantry":"General"},qe=({category:c})=>{switch(c){case"Dairy":return e.jsx(Ie,{className:"w-4 h-4"});case"Meat & Seafood":return e.jsx(_e,{className:"w-4 h-4"});case"Produce":return e.jsx(be,{className:"w-4 h-4"});case"Pantry":return e.jsx(ve,{className:"w-4 h-4"});default:return e.jsx(ce,{className:"w-4 h-4"})}},Re=({open:c,onOpenChange:d,recipes:m})=>{const{toast:j}=te(),[n,h]=f.useState([]),[g,v]=f.useState(!1),[u,o]=f.useState([]);f.useEffect(()=>{c&&(b(),w())},[c,m]);const b=async()=>{try{const{data:{user:r}}=await S.auth.getUser();if(!r)return;const{data:s}=await S.from("profiles").select("current_household_id").eq("id",r.id).single();if(!(s!=null&&s.current_household_id))return;const{data:t,error:l}=await S.from("inventory").select("name").eq("household_id",s.current_household_id);if(l)throw l;o(t.map(a=>a.name.toLowerCase()))}catch(r){console.error("Error fetching inventory:",r)}},w=()=>{const r=new Map;m.forEach(s=>{s.ingredients.forEach(t=>{const l=t.item.toLowerCase(),a=t.quantity&&t.unit?`${t.quantity} ${t.unit}`:t.quantity||"1";if(r.has(l)){const x=r.get(l);x.recipes.push(s.name),x.quantity.includes("Ã—")?x.quantity=x.quantity.replace(/Ã— \d+/,`Ã— ${x.recipes.length}`):x.quantity=`${a} Ã— ${x.recipes.length}`}else r.set(l,{item:t.item,quantity:a,recipes:[s.name],inInventory:u.includes(l),category:Le(t.item)})})}),h(Array.from(r.values()))},k=async()=>{try{v(!0);const{data:{user:r}}=await S.auth.getUser();if(!r)return;const{data:s}=await S.from("profiles").select("current_household_id").eq("id",r.id).single();if(!(s!=null&&s.current_household_id)){j({title:"Error",description:"No household found",variant:"destructive"});return}const t=n.filter(a=>!a.inInventory).map(a=>({item_name:a.item,household_id:s.current_household_id,source:"meal_plan",priority:"normal",quantity:1}));if(t.length===0){j({title:"All Set!",description:"You already have all ingredients in your inventory"}),d(!1);return}const{error:l}=await S.from("shopping_list").insert(t);if(l)throw l;j({title:"Added to Shopping List",description:`${t.length} items added to your cart`}),d(!1)}catch(r){console.error("Error adding to shopping list:",r),j({title:"Error",description:"Failed to add items to shopping list",variant:"destructive"})}finally{v(!1)}},_=Array.from(new Set(n.map(r=>r.category))).sort(),y=n.length,i=n.filter(r=>r.inInventory).length,p=y-i;return e.jsx(ae,{open:c,onOpenChange:d,children:e.jsxs(re,{side:"bottom",className:"h-[90vh] rounded-t-[32px] bg-background/95 backdrop-blur-xl border-t border-white/10 p-0 flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-border/40",children:[e.jsxs(ne,{children:[e.jsxs(oe,{className:"flex items-center gap-2 text-2xl font-display",children:[e.jsx(O,{className:"w-6 h-6 text-primary"}),"Your Basket"]}),e.jsx(ie,{className:"text-base",children:"Review items before adding to your shopping list."})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsxs("div",{className:"flex-1 p-3 rounded-xl bg-secondary/20 border border-secondary/30 flex flex-col items-center",children:[e.jsx("span",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Needed"}),e.jsx("span",{className:"text-2xl font-bold text-foreground",children:p})]}),e.jsxs("div",{className:"flex-1 p-3 rounded-xl bg-green-500/10 border border-green-500/20 flex flex-col items-center",children:[e.jsx("span",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Have"}),e.jsx("span",{className:"text-2xl font-bold text-green-500",children:i})]})]})]}),e.jsx(H,{className:"flex-1 px-6",children:e.jsx("div",{className:"space-y-6 py-6",children:_.map(r=>{const s=n.filter(t=>t.category===r);return s.length===0?null:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-medium",children:[e.jsx(qe,{category:r}),r]}),e.jsx("div",{className:"space-y-2",children:s.map(t=>e.jsxs("div",{className:E("flex items-center justify-between p-3 rounded-xl border transition-all",t.inInventory?"bg-secondary/10 border-transparent opacity-60":"bg-card border-border/50 hover:border-primary/30"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:E("w-5 h-5 rounded-full border flex items-center justify-center",t.inInventory?"bg-green-500 border-green-500":"border-muted-foreground"),children:t.inInventory&&e.jsx(le,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:E("font-medium capitalize",t.inInventory&&"line-through"),children:t.item}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.quantity})]})]}),t.recipes.length>1&&e.jsxs(U,{variant:"secondary",className:"text-[10px] h-5",children:[t.recipes.length," recipes"]})]},t.item))})]},r)})})}),e.jsx("div",{className:"p-6 border-t border-border/40 bg-background/95 backdrop-blur-xl",children:e.jsxs(I,{className:"w-full h-12 text-lg font-bold rounded-xl gap-2 shadow-lg shadow-primary/20",onClick:k,disabled:g||p===0,children:[e.jsx(O,{className:"w-5 h-5"}),"Add ",p," Items to List"]})})]})})},Oe=["Italian","Mexican","Asian","Mediterranean","American","Indian","Thai","Japanese","Greek","French","Chinese","Korean"],Te=["Vegetarian","Vegan","Gluten-Free","Dairy-Free","Low-Carb","Keto","Paleo","Pescatarian"],Fe=({open:c,onClose:d,onGenerate:m,isGenerating:j=!1})=>{const[n,h]=f.useState([]),[g,v]=f.useState([]),[u,o]=f.useState(""),[b,w]=f.useState(60),[k,_]=f.useState([]),y=a=>{h(x=>x.includes(a)?x.filter(N=>N!==a):[...x,a])},i=a=>{_(x=>x.includes(a)?x.filter(N=>N!==a):[...x,a])},p=()=>{const a=u.trim();a&&!g.includes(a)&&(v(x=>[...x,a]),o(""))},r=a=>{v(x=>x.filter(N=>N!==a))},s=a=>{a.key==="Enter"&&(a.preventDefault(),p())},t=()=>{const a={cuisines:n.length>0?n:void 0,avoid_ingredients:g.length>0?g:void 0,cooking_time_max:b,dietary_preferences:k.length>0?k:void 0};m(a)},l=()=>{h([]),v([]),o(""),w(60),_([])};return e.jsx(W,{open:c,onOpenChange:d,children:e.jsxs(z,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx($,{children:e.jsx(B,{children:"Customize Your Meal Plan"})}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(P,{className:"text-base font-semibold",children:"Preferred Cuisines"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select the cuisines you'd like in your meal plan"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Oe.map(a=>e.jsx("div",{onClick:()=>y(a),className:E("p-3 rounded-lg border text-center cursor-pointer transition-all",n.includes(a)?"bg-primary/10 border-primary text-primary":"bg-card/40 border-border hover:bg-card/60"),children:a},a))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(P,{className:"text-base font-semibold",children:"Avoid Ingredients"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add ingredients to exclude from your meal plan"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{placeholder:"e.g., mushrooms, cilantro, olives",value:u,onChange:a=>o(a.target.value),onKeyDown:s}),e.jsx(I,{onClick:p,variant:"secondary",children:"Add"})]}),g.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(a=>e.jsxs(U,{variant:"outline",className:"gap-1",children:[a,e.jsx(de,{className:"w-3 h-3 cursor-pointer hover:text-destructive",onClick:()=>r(a)})]},a))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(P,{className:"text-base font-semibold",children:"Maximum Cooking Time"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Limit recipes to ",b," minutes or less"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(me,{value:[b],onValueChange:a=>w(a[0]),min:15,max:120,step:15,className:"flex-1"}),e.jsxs("div",{className:"w-20 text-center font-semibold text-foreground",children:[b," min"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(P,{className:"text-base font-semibold",children:"Dietary Preferences"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select any dietary restrictions or preferences"}),e.jsx("div",{className:"space-y-2",children:Te.map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{id:a,checked:k.includes(a),onCheckedChange:()=>i(a)}),e.jsx("label",{htmlFor:a,className:"text-sm font-medium cursor-pointer",children:a})]},a))})]})]}),e.jsxs(he,{className:"flex gap-2",children:[e.jsx(I,{variant:"ghost",onClick:l,children:"Reset"}),e.jsx(I,{variant:"outline",onClick:d,disabled:j,children:"Cancel"}),e.jsx(I,{onClick:t,disabled:j,children:j?"Generating...":"Generate Meal Plan"})]})]})})},Ge=({currentDate:c,onPrevWeek:d,onNextWeek:m,onToday:j,shoppingItemCount:n,onOpenShoppingList:h})=>{const g=Y(c,{weekStartsOn:1}),v=Se(c,{weekStartsOn:1});return new Date().toDateString(),new Date().toDateString(),e.jsx("div",{className:"sticky top-0 z-10 bg-background/80 backdrop-blur-md border-b border-border/40 pb-4 pt-2 mb-6",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-full text-primary",children:e.jsx(Ne,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold font-display",children:"Plan Your Meals"})]}),e.jsxs(I,{onClick:h,className:E("rounded-full transition-all duration-300",n>0?"bg-primary text-primary-foreground hover:bg-primary/90 shadow-lg shadow-primary/20":"bg-secondary text-secondary-foreground hover:bg-secondary/80"),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"font-bold",children:n}),e.jsx("span",{className:"ml-1 hidden sm:inline",children:"Items"})]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-secondary/30 p-1 rounded-xl",children:[e.jsx(I,{variant:"ghost",size:"icon",onClick:d,className:"h-8 w-8 rounded-lg hover:bg-background",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex flex-col items-center cursor-pointer",onClick:j,children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-widest",children:"Week of"}),e.jsxs("span",{className:"text-sm font-bold",children:[A(g,"MMM d")," - ",A(v,"MMM d")]})]}),e.jsx(I,{variant:"ghost",size:"icon",onClick:m,className:"h-8 w-8 rounded-lg hover:bg-background",children:e.jsx(ue,{className:"w-4 h-4"})})]})]})})},is=()=>{const c=K(),d=ge(),{mealPlans:m,recipes:j,isLoading:n,refresh:h}=pe(),[g,v]=f.useState(0),[u,o]=f.useState(!1),[b,w]=f.useState([]),[k,_]=f.useState(!1),[y,i]=f.useState(!1),p=Ce(Y(new Date,{weekStartsOn:1}),g),r=new Date(p);r.setDate(r.getDate()+7);const s=m.filter(N=>{const C=L(N.planned_date);return C>=p&&C<r}),t=s.length*5,l=async()=>{try{const N=s.filter(M=>M.recipe_id).map(M=>M.recipe_id);if(N.length===0){D.error("No meals planned for this week");return}const C=j.filter(M=>N.includes(M.id));w(C),o(!0)}catch(N){console.error("Error generating shopping preview:",N),D.error("Failed to generate shopping list")}},a=async N=>{i(!1),_(!0);try{const{data:C,error:M}=await S.functions.invoke("generate-meal-plan",{body:{week_start_date:p.toISOString().split("T")[0],preferences:N}});if(M)throw M;D.success(`Generated ${C.meals_created} meals and added ${C.shopping_items_added} items to shopping list!`),h()}catch(C){console.error("Error generating meal plan:",C),D.error("Failed to generate meal plan")}finally{_(!1)}},x=N=>{v(N==="prev"?C=>C-1:C=>C+1)};return e.jsx(xe,{onScan:()=>c("/"),children:e.jsx(fe,{swipeProgress:d.progress,swipeDirection:d.direction,children:e.jsxs("div",{className:"container mx-auto px-4 max-w-3xl pb-24 min-h-screen bg-background",children:[e.jsx(Ge,{currentDate:p,onPrevWeek:()=>x("prev"),onNextWeek:()=>x("next"),onToday:()=>v(0),shoppingItemCount:t,onOpenShoppingList:l}),e.jsx(Pe,{weekStart:p,mealPlans:s,onRefresh:h,loading:n,onWeekChange:x,currentWeekIndex:g}),e.jsx(Re,{open:u,onOpenChange:o,recipes:b}),e.jsx(Fe,{open:y,onClose:()=>i(!1),onGenerate:a,isGenerating:k})]})})})};export{is as default};

import{j as a}from"./ui-vendor-CRu_cuPE.js";import{u as y,r as v}from"./react-vendor-DwZQO67Z.js";import{b5 as x,s as t,q as o}from"./index-D4bhw5kJ.js";import"./chart-vendor-BDCxrQ3h.js";import"./supabase-vendor-BS1x--yE.js";import"./animation-vendor-C-lCNj7M.js";function _(){const i=y(),[u,r]=v.useState(!1),f=async m=>{r(!0);try{const{data:{user:e},error:b}=await t.auth.getUser();if(b||!e){o.error("Please sign in to save your face photo"),r(!1);return}const h=await(await fetch(m)).blob(),n=`${e.id}/face-${Date.now()}.jpg`,{data:j,error:l}=await t.storage.from("face-photos").upload(n,h,{contentType:"image/jpeg",upsert:!0});if(l){console.error("Upload error:",l),o.error("Failed to save face photo"),r(!1);return}const{data:{publicUrl:g}}=t.storage.from("face-photos").getPublicUrl(n),{data:s}=await t.from("profiles").select("beauty_profile").eq("id",e.id).single(),c=(s==null?void 0:s.beauty_profile)||{};c.face_photo_url=g;const{error:p}=await t.from("profiles").update({beauty_profile:c}).eq("id",e.id);if(p){console.error("Profile update error:",p),o.error("Failed to update profile"),r(!1);return}o.success("Face photo saved!"),i("/vanity")}catch(e){console.error("Face capture error:",e),o.error("Something went wrong")}finally{r(!1)}},d=()=>{i("/vanity")};return u?a.jsx("div",{className:"fixed inset-0 bg-black flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-4 border-white border-t-transparent"}),a.jsx("p",{className:"text-white mt-4",children:"Saving your face photo..."})]})}):a.jsx(x,{onClose:d,onCapture:f})}export{_ as default};

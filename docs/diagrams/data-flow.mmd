sequenceDiagram
    participant U as User
    participant F as Frontend
    participant RC as RealtimeContext
    participant SB as Supabase
    participant EF as Edge Functions
    participant AI as AI Services

    Note over U,AI: Authentication Flow
    U->>F: Login with email/password
    F->>SB: auth.signInWithPassword()
    SB-->>F: Session + User
    F->>SB: Fetch profile data
    SB-->>F: Profile with household_id
    F->>U: Redirect to /app

    Note over U,AI: Realtime Updates
    F->>RC: Subscribe to inventory changes
    RC->>SB: .channel().on('postgres_changes')
    SB-->>RC: Realtime event
    RC-->>F: Update local state
    F->>U: UI updates automatically

    Note over U,AI: Voice Interaction
    U->>F: Activate voice (Cmd+Shift+K)
    F->>AI: ElevenLabs useConversation
    U->>AI: "What's in my fridge?"
    AI->>F: clientTools.check_inventory()
    F->>SB: Query inventory table
    SB-->>F: Inventory items
    F-->>AI: sendContextualUpdate(inventory)
    AI-->>U: Voice response

    Note over U,AI: Scanner Flow
    U->>F: Open scanner
    F->>F: Capture image via webcam
    F->>EF: analyze-vision edge function
    EF->>AI: Google Gemini vision model
    AI-->>EF: Product identification
    EF->>EF: enrich-product (FatSecret API)
    EF-->>F: Product data + nutrition
    F->>SB: Insert into inventory
    SB->>RC: Broadcast change
    RC-->>F: All household members updated
